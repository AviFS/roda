<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html lang='en'>
  <head>
    <title>Roda::RodaPlugins::ErrorEmail</title>
    <meta content='text/html; charset=UTF-8' http-equiv='Content-Type'>
    <link href='../../../css/style.css' media='screen' rel='stylesheet' type='text/css'>
    <script type='text/javascript'>
      //<![CDATA[
        function popupCode(url) {
          window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
        }
        
        function toggleCode(id) {
          var code = document.getElementById(id)
        
          code.style.display = code.style.display != 'block' ? 'block' : 'none'
          return true
        }
        
        // Make codeblocks hidden by default
        document.writeln('<' + 'style type="text/css">.method .source pre { display: none }<\/style>')
      //]]>
    </script>
  </head>
  <body class='page'>
    <div class='class' id='wrapper'>
      <div class='header'>
        <h1 class='name'>
          <span class='type'>module</span>
          Roda::RodaPlugins::ErrorEmail
        </h1>
        <ol class='paths'>
          <li>
            <a target="docwin" href="../../../files/lib/roda/plugins/error_email_rb.html">lib/roda/plugins/error_email.rb</a>
          </li>
        </ol>
      </div>
      <div id='content'>
        <div id='text'>
          <div id='description'>
            
            <p>The error_email plugin adds an <code>error_email</code> instance method
            that send an email related to the exception.  This is most useful if you
            are also using the error_handler plugin:</p>
            
            <pre class="ruby"><span class="ruby-identifier">plugin</span> :<span class="ruby-identifier">error_email</span>, :<span class="ruby-identifier">to=</span><span class="ruby-operator">&gt;</span><span class="ruby-string">&#39;to@example.com&#39;</span>, :<span class="ruby-identifier">from=</span><span class="ruby-operator">&gt;</span><span class="ruby-string">&#39;from@example.com&#39;</span>&#x000A;<span class="ruby-identifier">plugin</span> :<span class="ruby-identifier">error_handler</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">e</span><span class="ruby-operator">|</span>&#x000A;  <span class="ruby-identifier">error_email</span>(<span class="ruby-identifier">e</span>)&#x000A;  <span class="ruby-string">&#39;Internal Server Error&#39;</span>&#x000A;<span class="ruby-keyword">end</span></pre>
            
            <p>Options:</p>
            <table class="rdoc-list note-list"><tbody><tr><td class='label'>:from </td><td>
            <p>The From address to use in the email (required)</p>
            </td></tr><tr><td class='label'>:headers </td><td>
            <p>A hash of additional headers to use in the email (default: empty hash)</p>
            </td></tr><tr><td class='label'>:host </td><td>
            <p>The SMTP server to use to send the email (default: localhost)</p>
            </td></tr><tr><td class='label'>:prefix </td><td>
            <p>A prefix to use in the email&#39;s subject line (default: no prefix)</p>
            </td></tr><tr><td class='label'>:to </td><td>
            <p>The To address to use in the email (required)</p>
            </td></tr></tbody></table>
            
            <p>The subject of the error email shows the exception class and message. The
            body of the error email shows the backtrace of the error and the request
            environment, as well the request params and session variables (if any).</p>
            
            <p>Note that emailing on every error as shown above is only appropriate for
            low traffic web applications.  For high traffic web applications, use an
            error reporting service instead of this plugin.</p>
          </div>
          <div id='method-list'>
            <h2>Methods</h2>
            <h3>Public Class</h3>
            <ol>
              <li><a target="docwin" href="#method-c-configure">configure</a></li>
            </ol>
          </div>
          <div id='context'>
          </div>
          <div id='class-list'>
            <h2>Classes and Modules</h2>
            <ol>
              <li><a target="docwin" href="ErrorEmail/InstanceMethods.html">Roda::RodaPlugins::ErrorEmail::InstanceMethods</a></li>
            </ol>
          </div>
          <div id='section'>
            <div id='constants-list'>
              <h2>Constants</h2>
              <div class='name-list'>
                <table summary='Constants'>
                  <tr class='top-aligned-row context-row'>
                    <td class='context-item-name'>DEFAULTS</td>
                    <td>=</td>
                    <td class='context-item-value'>
                      {
                      :headers=>{},
                      :host=>'localhost',
                      # :nocov:
                      :emailer=>lambda{|h| Net::SMTP.start(h[:host]){|s| s.send_message(h[:message], h[:from], h[:to])}},
                      # :nocov:
                      :default_headers=>lambda do |h, e|
                      {'From'=>h[:from], 'To'=>h[:to], 'Subject'=>"#{h[:prefix]}#{e.class}: #{e.message}"}
                      end,
                      :body=>lambda do |s, e|
                      format = lambda{|h| h.map{|k, v| "#{k.inspect} => #{v.inspect}"}.sort.join("\n")}
                      
                      message = String.new
                      message << <<END
                      Path: #{s.request.path}
                      
                      Backtrace:
                      
                      #{e.backtrace.join("\n")}
                      
                      ENV:
                      
                      #{format[s.env]}
                      END
                      unless s.request.params.empty?
                      message << <<END
                      
                      Params:
                      
                      #{format[s.request.params]}
                      END
                      end
                      
                      if s.env['rack.session']
                      message << <<END
                      
                      Session:
                      
                      #{format[s.session]}
                      END
                      end
                      
                      message
                      end
                      }
                    </td>
                    <td>&nbsp;</td>
                    <td class='context-item-desc'></td>
                  </tr>
                  <tr class='top-aligned-row context-row'>
                    <td class='context-item-name'>OPTS</td>
                    <td>=</td>
                    <td class='context-item-value'>{}.freeze</td>
                    <td>&nbsp;</td>
                    <td class='context-item-desc'></td>
                  </tr>
                </table>
              </div>
            </div>
            <div id='methods'>
              <h2>Public Class methods</h2>
              <div class='method public-class' id='method-method-c-configure'>
                <a name='method-c-configure'></a>
                <div class='synopsis'>
                  <span class='name'>configure</span>
                  <span class='arguments'>(app, opts=OPTS)</span>
                </div>
                <div class='description'>
                  
                  <p>Set default opts for plugin.  See <a href="ErrorEmail.html">ErrorEmail</a>
                  module RDoc for options.</p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('method-c-configure-source'); return false">
                    [show source]
                  </a>
                  <pre id='method-c-configure-source'><span class="ruby-comment"># File lib/roda/plugins/error_email.rb, line 81</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">configure</span>(<span class="ruby-identifier">app</span>, <span class="ruby-identifier">opts</span>=<span class="ruby-constant">OPTS</span>)&#x000A;  <span class="ruby-identifier">email_opts</span> = <span class="ruby-identifier">app</span>.<span class="ruby-identifier">opts</span>[<span class="ruby-value">:error_email</span>] <span class="ruby-operator">||=</span> <span class="ruby-constant">DEFAULTS</span>&#x000A;  <span class="ruby-identifier">email_opts</span> = <span class="ruby-identifier">email_opts</span>.<span class="ruby-identifier">merge</span>(<span class="ruby-identifier">opts</span>)&#x000A;  <span class="ruby-identifier">email_opts</span>[<span class="ruby-value">:headers</span>] = <span class="ruby-identifier">email_opts</span>[<span class="ruby-value">:headers</span>].<span class="ruby-identifier">dup</span>&#x000A;  <span class="ruby-keyword">unless</span> <span class="ruby-identifier">email_opts</span>[<span class="ruby-value">:to</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">email_opts</span>[<span class="ruby-value">:from</span>]&#x000A;    <span class="ruby-identifier">raise</span> <span class="ruby-constant">RodaError</span>, <span class="ruby-string">&quot;must provide :to and :from options to error_email plugin&quot;</span>&#x000A;  <span class="ruby-keyword">end</span>&#x000A;  <span class="ruby-identifier">app</span>.<span class="ruby-identifier">opts</span>[<span class="ruby-value">:error_email</span>] = <span class="ruby-identifier">email_opts</span>&#x000A;  <span class="ruby-identifier">app</span>.<span class="ruby-identifier">opts</span>[<span class="ruby-value">:error_email</span>][<span class="ruby-value">:headers</span>].<span class="ruby-identifier">freeze</span>&#x000A;  <span class="ruby-identifier">app</span>.<span class="ruby-identifier">opts</span>[<span class="ruby-value">:error_email</span>].<span class="ruby-identifier">freeze</span>&#x000A;<span class="ruby-keyword">end</span></pre>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div id='footer-push'></div>
    </div>
    <div id='footer'>
      <a target="docwin" href="http://github.com/mislav/hanna/tree/master"><strong>Hanna</strong> RDoc template</a>
    </div>
  </body>
</html>
