<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html lang='en'>
  <head>
    <title>Roda::RodaPlugins::TypecastParams::Params</title>
    <meta content='text/html; charset=UTF-8' http-equiv='Content-Type'>
    <link href='../../../../css/style.css' media='screen' rel='stylesheet' type='text/css'>
    <script type='text/javascript'>
      function popupCode(url) {
        window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
      }
      
      function toggleCode(id) {
        var code = document.getElementById(id)
      
        code.style.display = code.style.display != 'block' ? 'block' : 'none'
        return true
      }
      
      // Make codeblocks hidden by default
      document.writeln('<' + 'style type="text/css">.method .source pre { display: none }<\/style>')
    </script>
  </head>
  <body class='page'>
    <div class='class' id='wrapper'>
      <div class='header'>
        <h1 class='name'>
          <span class='type'>class</span>
          Roda::RodaPlugins::TypecastParams::Params
        </h1>
        <ol class='paths'>
          <li>
            <a href="../../../../files/lib/roda/plugins/typecast_params_rb.html">lib/roda/plugins/typecast_params.rb</a>
          </li>
        </ol>
        <div class='parent'>
          Superclass:
          <strong>Object</strong>
        </div>
      </div>
      <div id='content'>
        <div id='text'>
          <div id='description'>
            
            <p>Class handling conversion of submitted parameters to desired types.</p>
          </div>
          <div id='method-list'>
            <h2>Methods</h2>
            <h3>Public Class</h3>
            <ol>
              <li><a href="#method-c-handle_type">handle_type</a></li>
              <li><a href="#method-c-nest">nest</a></li>
              <li><a href="#method-c-new">new</a></li>
            </ol>
            <h3>Public Instance</h3>
            <ol>
              <li><a href="#method-i-5B-5D">[]</a></li>
              <li><a href="#method-i-array">array</a></li>
              <li><a href="#method-i-array-21">array!</a></li>
              <li><a href="#method-i-convert-21">convert!</a></li>
              <li><a href="#method-i-convert_each-21">convert_each!</a></li>
              <li><a href="#method-i-dig">dig</a></li>
              <li><a href="#method-i-dig-21">dig!</a></li>
              <li><a href="#method-i-fetch">fetch</a></li>
              <li><a href="#method-i-present-3F">present?</a></li>
            </ol>
            <h3>Protected Instance</h3>
            <ol>
              <li><a href="#method-i-nested_params">nested_params</a></li>
              <li><a href="#method-i-sub_capture">sub_capture</a></li>
              <li><a href="#method-i-subkey">subkey</a></li>
            </ol>
          </div>
          <div id='context'>
          </div>
          <div id='class-list'>
            <h2>Classes and Modules</h2>
            <ol>
              <li><a href="Params/Kernel.html">Roda::RodaPlugins::TypecastParams::Params::Kernel</a></li>
            </ol>
          </div>
          <div id='section'>
            <div id='methods'>
              <h2>Public Class methods</h2>
              <div class='method public-class' id='method-method-c-handle_type'>
                <a name='method-c-handle_type'></a>
                <div class='synopsis'>
                  <span class='name'>handle_type</span>
                  <span class='arguments'>(type, &block)</span>
                </div>
                <div class='description'>
                  
                  <p>Handle conversions for the given type using the given block. For a type
                  named <code>foo</code>, this will create the following methods:</p>
                  <ul><li>
                  <p>foo(key, default=nil)</p>
                  </li><li>
                  <p>foo!(key)</p>
                  </li><li>
                  <p>convert_foo(value) # private</p>
                  </li><li>
                  <p>_convert_array_foo(value) # private</p>
                  </li></ul>
                  
                  <p>This method is used to define all type conversions, even the built in ones.
                  It can be called in subclasses to setup subclass-specific types.</p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('method-c-handle_type-source'); return false">
                    [show source]
                  </a>
                  <pre id='method-c-handle_type-source'><span class="ruby-comment"># File lib/roda/plugins/typecast_params.rb, line 384</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">handle_type</span>(<span class="ruby-identifier">type</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)&#x000A;  <span class="ruby-identifier">convert_meth</span> = <span class="ruby-value">:&quot;convert_#{type}&quot;</span>&#x000A;  <span class="ruby-identifier">define_method</span>(<span class="ruby-identifier">convert_meth</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)&#x000A;&#x000A;  <span class="ruby-identifier">convert_array_meth</span> = <span class="ruby-value">:&quot;_convert_array_#{type}&quot;</span>&#x000A;  <span class="ruby-identifier">define_method</span>(<span class="ruby-identifier">convert_array_meth</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">v</span><span class="ruby-operator">|</span>&#x000A;    <span class="ruby-identifier">raise</span> <span class="ruby-constant">Error</span>, <span class="ruby-node">&quot;expected array but received #{v.inspect}&quot;</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">v</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Array</span>)&#x000A;    <span class="ruby-identifier">v</span>.<span class="ruby-identifier">map!</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">val</span><span class="ruby-operator">|</span> <span class="ruby-identifier">send</span>(<span class="ruby-identifier">convert_meth</span>, <span class="ruby-identifier">val</span>)}&#x000A;  <span class="ruby-keyword">end</span>&#x000A;&#x000A;  <span class="ruby-identifier">private</span> <span class="ruby-identifier">convert_meth</span>, <span class="ruby-identifier">convert_array_meth</span>&#x000A;&#x000A;  <span class="ruby-identifier">define_method</span>(<span class="ruby-identifier">type</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">key</span>, <span class="ruby-identifier">default</span>=<span class="ruby-keyword">nil</span><span class="ruby-operator">|</span>&#x000A;    <span class="ruby-identifier">process_arg</span>(<span class="ruby-identifier">convert_meth</span>, <span class="ruby-identifier">key</span>, <span class="ruby-identifier">default</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">require_hash!</span>&#x000A;  <span class="ruby-keyword">end</span>&#x000A;&#x000A;  <span class="ruby-identifier">define_method</span>(<span class="ruby-value">:&quot;#{type}!&quot;</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">key</span><span class="ruby-operator">|</span>&#x000A;    <span class="ruby-identifier">send</span>(<span class="ruby-identifier">type</span>, <span class="ruby-identifier">key</span>, <span class="ruby-constant">CHECK_NIL</span>)&#x000A;  <span class="ruby-keyword">end</span>&#x000A;<span class="ruby-keyword">end</span></pre>
                </div>
              </div>
              <div class='method public-class' id='method-method-c-nest'>
                <a name='method-c-nest'></a>
                <div class='synopsis'>
                  <span class='name'>nest</span>
                  <span class='arguments'>(obj, nesting)</span>
                </div>
                <div class='description'>
                  
                  <p>Create a new instance with the given object and nesting level.
                  <code>obj</code> should be an array or hash, and <code>nesting</code>
                  should be an array.  Designed for internal use, should not be called by
                  external code.</p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('method-c-nest-source'); return false">
                    [show source]
                  </a>
                  <pre id='method-c-nest-source'><span class="ruby-comment"># File lib/roda/plugins/typecast_params.rb, line 409</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">nest</span>(<span class="ruby-identifier">obj</span>, <span class="ruby-identifier">nesting</span>)&#x000A;  <span class="ruby-identifier">v</span> = <span class="ruby-identifier">allocate</span>&#x000A;  <span class="ruby-identifier">v</span>.<span class="ruby-identifier">instance_variable_set</span>(<span class="ruby-value">:@nesting</span>, <span class="ruby-identifier">nesting</span>)&#x000A;  <span class="ruby-identifier">v</span>.<span class="ruby-identifier">send</span>(<span class="ruby-value">:initialize</span>, <span class="ruby-identifier">obj</span>)&#x000A;  <span class="ruby-identifier">v</span>&#x000A;<span class="ruby-keyword">end</span></pre>
                </div>
              </div>
              <div class='method public-class' id='method-method-c-new'>
                <a name='method-c-new'></a>
                <div class='synopsis'>
                  <span class='name'>new</span>
                  <span class='arguments'>(obj)</span>
                </div>
                <div class='description'>
                  
                  <p>Set the object used for converting.  Conversion methods will convert
                  members of the passed object.</p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('method-c-new-source'); return false">
                    [show source]
                  </a>
                  <pre id='method-c-new-source'><span class="ruby-comment"># File lib/roda/plugins/typecast_params.rb, line 490</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-identifier">initialize</span>(<span class="ruby-identifier">obj</span>)&#x000A;  <span class="ruby-keyword">case</span> <span class="ruby-ivar">@obj</span> = <span class="ruby-identifier">obj</span>&#x000A;  <span class="ruby-keyword">when</span> <span class="ruby-constant">Hash</span>, <span class="ruby-constant">Array</span>&#x000A;    <span class="ruby-comment"># nothing</span>&#x000A;  <span class="ruby-keyword">else</span>&#x000A;    <span class="ruby-keyword">if</span> <span class="ruby-ivar">@nesting</span>&#x000A;      <span class="ruby-identifier">handle_error</span>(<span class="ruby-keyword">nil</span>, (<span class="ruby-ivar">@obj</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">?</span> <span class="ruby-value">:missing</span> <span class="ruby-operator">:</span> <span class="ruby-value">:invalid_type</span>), <span class="ruby-node">&quot;value of #{param_name(nil)} parameter not an array or hash: #{obj.inspect}&quot;</span>, <span class="ruby-keyword">true</span>)&#x000A;    <span class="ruby-keyword">else</span>&#x000A;      <span class="ruby-identifier">handle_error</span>(<span class="ruby-keyword">nil</span>, <span class="ruby-value">:invalid_type</span>, <span class="ruby-node">&quot;parameters given not an array or hash: #{obj.inspect}&quot;</span>, <span class="ruby-keyword">true</span>)&#x000A;    <span class="ruby-keyword">end</span>&#x000A;  <span class="ruby-keyword">end</span>&#x000A;<span class="ruby-keyword">end</span></pre>
                </div>
              </div>
              <h2>Public Instance methods</h2>
              <div class='method public-instance' id='method-method-i-5B-5D'>
                <a name='method-i-5B-5D'></a>
                <div class='synopsis'>
                  <span class='name'>[]</span>
                  <span class='arguments'>(key)</span>
                </div>
                <div class='description'>
                  
                  <p>Return a new <a href="Params.html">Params</a> instance for the given
                  <code>key</code>. The value of <code>key</code> should be an array if
                  <code>key</code> is an integer, or hash otherwise.</p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('method-i-5B-5D-source'); return false">
                    [show source]
                  </a>
                  <pre id='method-i-5B-5D-source'><span class="ruby-comment"># File lib/roda/plugins/typecast_params.rb, line 520</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-operator">[]</span>(<span class="ruby-identifier">key</span>)&#x000A;  <span class="ruby-ivar">@subs</span> <span class="ruby-operator">||=</span> {}&#x000A;  <span class="ruby-keyword">if</span> <span class="ruby-identifier">sub</span> = <span class="ruby-ivar">@subs</span>[<span class="ruby-identifier">key</span>]&#x000A;    <span class="ruby-keyword">return</span> <span class="ruby-identifier">sub</span>&#x000A;  <span class="ruby-keyword">end</span>&#x000A;&#x000A;  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@obj</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Array</span>)&#x000A;    <span class="ruby-keyword">unless</span> <span class="ruby-identifier">key</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Integer</span>)&#x000A;      <span class="ruby-identifier">handle_error</span>(<span class="ruby-identifier">key</span>, <span class="ruby-value">:invalid_type</span>, <span class="ruby-node">&quot;invalid use of non-integer key for accessing array: #{key.inspect}&quot;</span>, <span class="ruby-keyword">true</span>)&#x000A;    <span class="ruby-keyword">end</span>&#x000A;  <span class="ruby-keyword">else</span>&#x000A;    <span class="ruby-keyword">if</span> <span class="ruby-identifier">key</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Integer</span>)&#x000A;      <span class="ruby-identifier">handle_error</span>(<span class="ruby-identifier">key</span>, <span class="ruby-value">:invalid_type</span>, <span class="ruby-node">&quot;invalid use of integer key for accessing hash: #{key}&quot;</span>, <span class="ruby-keyword">true</span>)&#x000A;    <span class="ruby-keyword">end</span>&#x000A;  <span class="ruby-keyword">end</span>&#x000A;&#x000A;  <span class="ruby-identifier">v</span> = <span class="ruby-ivar">@obj</span>[<span class="ruby-identifier">key</span>]&#x000A;  <span class="ruby-identifier">v</span> = <span class="ruby-keyword">yield</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">v</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">block_given?</span>&#x000A;&#x000A;  <span class="ruby-keyword">begin</span>&#x000A;    <span class="ruby-identifier">sub</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">nest</span>(<span class="ruby-identifier">v</span>, <span class="ruby-constant">Array</span>(<span class="ruby-ivar">@nesting</span>) <span class="ruby-operator">+</span> [<span class="ruby-identifier">key</span>])&#x000A;  <span class="ruby-keyword">rescue</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">e</span>&#x000A;    <span class="ruby-identifier">handle_error</span>(<span class="ruby-identifier">key</span>, <span class="ruby-value">:invalid_type</span>, <span class="ruby-identifier">e</span>, <span class="ruby-keyword">true</span>)&#x000A;  <span class="ruby-keyword">end</span>&#x000A;&#x000A;  <span class="ruby-ivar">@subs</span>[<span class="ruby-identifier">key</span>] = <span class="ruby-identifier">sub</span>&#x000A;  <span class="ruby-identifier">sub</span>.<span class="ruby-identifier">sub_capture</span>(<span class="ruby-ivar">@capture</span>, <span class="ruby-ivar">@symbolize</span>)&#x000A;  <span class="ruby-identifier">sub</span>&#x000A;<span class="ruby-keyword">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-method-i-array'>
                <a name='method-i-array'></a>
                <div class='synopsis'>
                  <span class='name'>array</span>
                  <span class='arguments'>(type, key, default=nil)</span>
                </div>
                <div class='description'>
                  
                  <p>Convert the value of <code>key</code> to an array of values of the given
                  <code>type</code>. If <code>default</code> is given, any <code>nil</code>
                  values in the array are replaced with <code>default</code>.  If
                  <code>key</code> is an array then this returns an array of arrays, one for
                  each respective value of <code>key</code>. If there is no value for
                  <code>key</code>, nil is returned instead of an array.</p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('method-i-array-source'); return false">
                    [show source]
                  </a>
                  <pre id='method-i-array-source'><span class="ruby-comment"># File lib/roda/plugins/typecast_params.rb, line 634</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-identifier">array</span>(<span class="ruby-identifier">type</span>, <span class="ruby-identifier">key</span>, <span class="ruby-identifier">default</span>=<span class="ruby-keyword">nil</span>)&#x000A;  <span class="ruby-identifier">meth</span> = <span class="ruby-value">:&quot;_convert_array_#{type}&quot;</span>&#x000A;  <span class="ruby-identifier">raise</span> <span class="ruby-constant">ProgrammerError</span>, <span class="ruby-node">&quot;no typecast_params type registered for #{type.inspect}&quot;</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">respond_to?</span>(<span class="ruby-identifier">meth</span>, <span class="ruby-keyword">true</span>)&#x000A;  <span class="ruby-identifier">process_arg</span>(<span class="ruby-identifier">meth</span>, <span class="ruby-identifier">key</span>, <span class="ruby-identifier">default</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">require_hash!</span>&#x000A;<span class="ruby-keyword">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-method-i-array-21'>
                <a name='method-i-array-21'></a>
                <div class='synopsis'>
                  <span class='name'>array!</span>
                  <span class='arguments'>(type, key, default=nil)</span>
                </div>
                <div class='description'>
                  
                  <p>Call <code>array</code> with the <code>type</code>, <code>key</code>, and
                  <code>default</code>, but if the return value is nil or any value in the
                  returned array is <code>nil</code>, raise an <a
                  href="Error.html">Error</a>.</p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('method-i-array-21-source'); return false">
                    [show source]
                  </a>
                  <pre id='method-i-array-21-source'><span class="ruby-comment"># File lib/roda/plugins/typecast_params.rb, line 642</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-identifier">array!</span>(<span class="ruby-identifier">type</span>, <span class="ruby-identifier">key</span>, <span class="ruby-identifier">default</span>=<span class="ruby-keyword">nil</span>)&#x000A;  <span class="ruby-identifier">v</span> = <span class="ruby-identifier">array</span>(<span class="ruby-identifier">type</span>, <span class="ruby-identifier">key</span>, <span class="ruby-identifier">default</span>)&#x000A;&#x000A;  <span class="ruby-keyword">if</span> <span class="ruby-identifier">key</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Array</span>)&#x000A;    <span class="ruby-identifier">key</span>.<span class="ruby-identifier">zip</span>(<span class="ruby-identifier">v</span>).<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">key</span>, <span class="ruby-identifier">arr</span><span class="ruby-operator">|</span>&#x000A;      <span class="ruby-identifier">check_array!</span>(<span class="ruby-identifier">key</span>, <span class="ruby-identifier">arr</span>)&#x000A;    <span class="ruby-keyword">end</span>&#x000A;  <span class="ruby-keyword">else</span>&#x000A;    <span class="ruby-identifier">check_array!</span>(<span class="ruby-identifier">key</span>, <span class="ruby-identifier">v</span>)&#x000A;  <span class="ruby-keyword">end</span>&#x000A;&#x000A;  <span class="ruby-identifier">v</span>&#x000A;<span class="ruby-keyword">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-method-i-convert-21'>
                <a name='method-i-convert-21'></a>
                <div class='synopsis'>
                  <span class='name'>convert!</span>
                  <span class='arguments'>(keys=nil, opts=OPTS)</span>
                </div>
                <div class='description'>
                  
                  <p>Captures conversions inside the given block, and returns a hash of all
                  conversions, including conversions of subkeys.  <code>keys</code> should be
                  an array of subkeys to access, or nil to convert the current object. If
                  <code>keys</code> is given as a hash, it is used as the options hash.
                  Options:</p>
                  <table class="rdoc-list note-list"><tbody><tr><td class='label'>:symbolize </td><td>
                  <p>Convert any string keys in the resulting hash and for any conversions below</p>
                  </td></tr></tbody></table>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('method-i-convert-21-source'); return false">
                    [show source]
                  </a>
                  <pre id='method-i-convert-21-source'><span class="ruby-comment"># File lib/roda/plugins/typecast_params.rb, line 563</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-identifier">convert!</span>(<span class="ruby-identifier">keys</span>=<span class="ruby-keyword">nil</span>, <span class="ruby-identifier">opts</span>=<span class="ruby-constant">OPTS</span>)&#x000A;  <span class="ruby-keyword">if</span> <span class="ruby-identifier">keys</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Hash</span>)&#x000A;    <span class="ruby-identifier">opts</span> = <span class="ruby-identifier">keys</span>&#x000A;    <span class="ruby-identifier">keys</span> = <span class="ruby-keyword">nil</span>&#x000A;  <span class="ruby-keyword">end</span>&#x000A;&#x000A;  <span class="ruby-identifier">_capture!</span>(<span class="ruby-value">:nested_params</span>, <span class="ruby-identifier">opts</span>) <span class="ruby-keyword">do</span>&#x000A;    <span class="ruby-keyword">if</span> <span class="ruby-identifier">sub</span> = <span class="ruby-identifier">subkey</span>(<span class="ruby-constant">Array</span>(<span class="ruby-identifier">keys</span>).<span class="ruby-identifier">dup</span>, <span class="ruby-keyword">true</span>)&#x000A;      <span class="ruby-keyword">yield</span> <span class="ruby-identifier">sub</span>&#x000A;    <span class="ruby-keyword">end</span>&#x000A;  <span class="ruby-keyword">end</span>&#x000A;<span class="ruby-keyword">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-method-i-convert_each-21'>
                <a name='method-i-convert_each-21'></a>
                <div class='synopsis'>
                  <span class='name'>convert_each!</span>
                  <span class='arguments'>(opts=OPTS, &block)</span>
                </div>
                <div class='description'>
                  
                  <p>Runs convert! for each key specified by the :keys option.  If no :keys
                  option is given and the object is an array, runs convert! for all entries
                  in the array. Raises an <a href="Error.html">Error</a> if the current
                  object is not an array and :keys option is not specified. Passes any
                  options given to <a href="Params.html#method-i-convert-21">convert!</a>. 
                  Options:</p>
                  <table class="rdoc-list note-list"><tbody><tr><td class='label'>:keys </td><td>
                  <p>The keys to extract from the object</p>
                  </td></tr></tbody></table>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('method-i-convert_each-21-source'); return false">
                    [show source]
                  </a>
                  <pre id='method-i-convert_each-21-source'><span class="ruby-comment"># File lib/roda/plugins/typecast_params.rb, line 582</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-identifier">convert_each!</span>(<span class="ruby-identifier">opts</span>=<span class="ruby-constant">OPTS</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)&#x000A;  <span class="ruby-identifier">np</span> = <span class="ruby-operator">!</span><span class="ruby-ivar">@capture</span>&#x000A;&#x000A;  <span class="ruby-identifier">_capture!</span>(<span class="ruby-keyword">nil</span>, <span class="ruby-identifier">opts</span>) <span class="ruby-keyword">do</span>&#x000A;    <span class="ruby-keyword">unless</span> <span class="ruby-identifier">keys</span> = <span class="ruby-identifier">opts</span>[<span class="ruby-value">:keys</span>]&#x000A;      <span class="ruby-keyword">unless</span> <span class="ruby-ivar">@obj</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Array</span>)&#x000A;        <span class="ruby-identifier">handle_error</span>(<span class="ruby-keyword">nil</span>, <span class="ruby-value">:invalid_type</span>, <span class="ruby-string">&quot;convert_each! called on non-array&quot;</span>)&#x000A;        <span class="ruby-keyword">next</span> &#x000A;      <span class="ruby-keyword">end</span>&#x000A;      <span class="ruby-identifier">keys</span> = (<span class="ruby-value">0</span><span class="ruby-operator">...</span><span class="ruby-ivar">@obj</span>.<span class="ruby-identifier">length</span>)&#x000A;    <span class="ruby-keyword">end</span>&#x000A;&#x000A;    <span class="ruby-identifier">keys</span>.<span class="ruby-identifier">map</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">i</span><span class="ruby-operator">|</span>&#x000A;      <span class="ruby-keyword">begin</span>&#x000A;        <span class="ruby-keyword">if</span> <span class="ruby-identifier">v</span> = <span class="ruby-identifier">subkey</span>([<span class="ruby-identifier">i</span>], <span class="ruby-keyword">true</span>)&#x000A;          <span class="ruby-keyword">yield</span> <span class="ruby-identifier">v</span>&#x000A;          <span class="ruby-identifier">v</span>.<span class="ruby-identifier">nested_params</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">np</span> &#x000A;        <span class="ruby-keyword">end</span>&#x000A;      <span class="ruby-keyword">rescue</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">e</span>&#x000A;        <span class="ruby-identifier">handle_error</span>(<span class="ruby-identifier">i</span>, <span class="ruby-value">:invalid_type</span>, <span class="ruby-identifier">e</span>)&#x000A;      <span class="ruby-keyword">end</span>&#x000A;    <span class="ruby-keyword">end</span>&#x000A;  <span class="ruby-keyword">end</span>&#x000A;<span class="ruby-keyword">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-method-i-dig'>
                <a name='method-i-dig'></a>
                <div class='synopsis'>
                  <span class='name'>dig</span>
                  <span class='arguments'>(type, *nest, key)</span>
                </div>
                <div class='description'>
                  
                  <p>Convert values nested under the current obj.  Traverses the current object
                  using <code>nest</code>, then converts <code>key</code> on that object
                  using <code>type</code>:</p>
                  
                  <pre class="ruby"><span class="ruby-identifier">tp</span>.<span class="ruby-identifier">dig</span>(:<span class="ruby-identifier">pos_int</span>, <span class="ruby-string">&#39;foo&#39;</span>)               <span class="ruby-comment"># tp.pos_int(&#39;foo&#39;)</span>&#x000A;<span class="ruby-identifier">tp</span>.<span class="ruby-identifier">dig</span>(:<span class="ruby-identifier">pos_int</span>, <span class="ruby-string">&#39;foo&#39;</span>, <span class="ruby-string">&#39;bar&#39;</span>)        <span class="ruby-comment"># tp[&#39;foo&#39;].pos_int(&#39;bar&#39;)</span>&#x000A;<span class="ruby-identifier">tp</span>.<span class="ruby-identifier">dig</span>(:<span class="ruby-identifier">pos_int</span>, <span class="ruby-string">&#39;foo&#39;</span>, <span class="ruby-string">&#39;bar&#39;</span>, <span class="ruby-string">&#39;baz&#39;</span>) <span class="ruby-comment"># tp[&#39;foo&#39;][&#39;bar&#39;].pos_int(&#39;baz&#39;)</span></pre>
                  
                  <p>Returns nil if any of the values are not present or not the expected type.
                  If the nest path results in an object that is not an array or hash, then
                  raises an <a href="Error.html">Error</a>.</p>
                  
                  <p>You can use <code>dig</code> to get access to nested arrays by using
                  <code>:array</code> or <code>:array!</code> as the first argument and
                  providing the type in the second argument:</p>
                  
                  <pre class="ruby"><span class="ruby-identifier">tp</span>.<span class="ruby-identifier">dig</span>(:<span class="ruby-identifier">array</span>, :<span class="ruby-identifier">pos_int</span>, <span class="ruby-string">&#39;foo&#39;</span>, <span class="ruby-string">&#39;bar&#39;</span>, <span class="ruby-string">&#39;baz&#39;</span>)  <span class="ruby-comment"># tp[&#39;foo&#39;][&#39;bar&#39;].array(:int, &#39;baz&#39;)</span></pre>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('method-i-dig-source'); return false">
                    [show source]
                  </a>
                  <pre id='method-i-dig-source'><span class="ruby-comment"># File lib/roda/plugins/typecast_params.rb, line 621</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-identifier">dig</span>(<span class="ruby-identifier">type</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">nest</span>, <span class="ruby-identifier">key</span>)&#x000A;  <span class="ruby-identifier">_dig</span>(<span class="ruby-keyword">false</span>, <span class="ruby-identifier">type</span>, <span class="ruby-identifier">nest</span>, <span class="ruby-identifier">key</span>)&#x000A;<span class="ruby-keyword">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-method-i-dig-21'>
                <a name='method-i-dig-21'></a>
                <div class='synopsis'>
                  <span class='name'>dig!</span>
                  <span class='arguments'>(type, *nest, key)</span>
                </div>
                <div class='description'>
                  
                  <p>Similar to <code>dig</code>, but raises an <a href="Error.html">Error</a>
                  instead of returning <code>nil</code> if no value is found.</p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('method-i-dig-21-source'); return false">
                    [show source]
                  </a>
                  <pre id='method-i-dig-21-source'><span class="ruby-comment"># File lib/roda/plugins/typecast_params.rb, line 626</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-identifier">dig!</span>(<span class="ruby-identifier">type</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">nest</span>, <span class="ruby-identifier">key</span>)&#x000A;  <span class="ruby-identifier">_dig</span>(<span class="ruby-keyword">true</span>, <span class="ruby-identifier">type</span>, <span class="ruby-identifier">nest</span>, <span class="ruby-identifier">key</span>)&#x000A;<span class="ruby-keyword">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-method-i-fetch'>
                <a name='method-i-fetch'></a>
                <div class='synopsis'>
                  <span class='name'>fetch</span>
                  <span class='arguments'>(key)</span>
                </div>
                <div class='description'>
                  
                  <p>Return the nested value for key. If there is no nested_value for
                  <code>key</code>, calls the block to return the value, or returns nil if
                  there is no block given.</p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('method-i-fetch-source'); return false">
                    [show source]
                  </a>
                  <pre id='method-i-fetch-source'><span class="ruby-comment"># File lib/roda/plugins/typecast_params.rb, line 552</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-identifier">fetch</span>(<span class="ruby-identifier">key</span>)&#x000A;  <span class="ruby-identifier">send</span>(<span class="ruby-value">:[]</span>, <span class="ruby-identifier">key</span>){<span class="ruby-keyword">return</span>(<span class="ruby-keyword">yield</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">block_given?</span>)}&#x000A;<span class="ruby-keyword">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-method-i-present-3F'>
                <a name='method-i-present-3F'></a>
                <div class='synopsis'>
                  <span class='name'>present?</span>
                  <span class='arguments'>(key)</span>
                </div>
                <div class='description'>
                  
                  <p>If key is a String Return whether the key is present in the object,</p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('method-i-present-3F-source'); return false">
                    [show source]
                  </a>
                  <pre id='method-i-present-3F-source'><span class="ruby-comment"># File lib/roda/plugins/typecast_params.rb, line 504</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-identifier">present?</span>(<span class="ruby-identifier">key</span>)&#x000A;  <span class="ruby-keyword">case</span> <span class="ruby-identifier">key</span>&#x000A;  <span class="ruby-keyword">when</span> <span class="ruby-constant">String</span>&#x000A;    <span class="ruby-operator">!</span><span class="ruby-identifier">any</span>(<span class="ruby-identifier">key</span>).<span class="ruby-identifier">nil?</span>&#x000A;  <span class="ruby-keyword">when</span> <span class="ruby-constant">Array</span>&#x000A;    <span class="ruby-identifier">key</span>.<span class="ruby-identifier">all?</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">k</span><span class="ruby-operator">|</span>&#x000A;      <span class="ruby-identifier">raise</span> <span class="ruby-constant">ProgrammerError</span>, <span class="ruby-node">&quot;non-String element in array argument passed to present?: #{k.inspect}&quot;</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">k</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">String</span>)&#x000A;      <span class="ruby-operator">!</span><span class="ruby-identifier">any</span>(<span class="ruby-identifier">k</span>).<span class="ruby-identifier">nil?</span>&#x000A;    <span class="ruby-keyword">end</span>&#x000A;  <span class="ruby-keyword">else</span>&#x000A;    <span class="ruby-identifier">raise</span> <span class="ruby-constant">ProgrammerError</span>, <span class="ruby-node">&quot;unexpected argument passed to present?: #{key.inspect}&quot;</span>&#x000A;  <span class="ruby-keyword">end</span>&#x000A;<span class="ruby-keyword">end</span></pre>
                </div>
              </div>
              <h2>Protected Instance methods</h2>
              <div class='method protected-instance' id='method-method-i-nested_params'>
                <a name='method-i-nested_params'></a>
                <div class='synopsis'>
                  <span class='name'>nested_params</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='description'>
                  
                  <p>Recursively descendent into all known subkeys and get the converted params
                  from each.</p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('method-i-nested_params-source'); return false">
                    [show source]
                  </a>
                  <pre id='method-i-nested_params-source'><span class="ruby-comment"># File lib/roda/plugins/typecast_params.rb, line 659</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-identifier">nested_params</span>&#x000A;  <span class="ruby-identifier">params</span> = <span class="ruby-ivar">@params</span>&#x000A;&#x000A;  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@subs</span>&#x000A;    <span class="ruby-ivar">@subs</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">key</span>, <span class="ruby-identifier">v</span><span class="ruby-operator">|</span>&#x000A;      <span class="ruby-keyword">if</span> <span class="ruby-identifier">key</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">String</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">symbolize?</span>&#x000A;        <span class="ruby-identifier">key</span> = <span class="ruby-identifier">key</span>.<span class="ruby-identifier">to_sym</span>&#x000A;      <span class="ruby-keyword">end</span>&#x000A;      <span class="ruby-identifier">params</span>[<span class="ruby-identifier">key</span>] = <span class="ruby-identifier">v</span>.<span class="ruby-identifier">nested_params</span>&#x000A;    <span class="ruby-keyword">end</span>&#x000A;  <span class="ruby-keyword">end</span>&#x000A;  &#x000A;  <span class="ruby-identifier">params</span>&#x000A;<span class="ruby-keyword">end</span></pre>
                </div>
              </div>
              <div class='method protected-instance' id='method-method-i-sub_capture'>
                <a name='method-i-sub_capture'></a>
                <div class='synopsis'>
                  <span class='name'>sub_capture</span>
                  <span class='arguments'>(capture, symbolize)</span>
                </div>
                <div class='description'>
                  
                  <p>Inherit given capturing and symbolize setting from parent object.</p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('method-i-sub_capture-source'); return false">
                    [show source]
                  </a>
                  <pre id='method-i-sub_capture-source'><span class="ruby-comment"># File lib/roda/plugins/typecast_params.rb, line 713</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-identifier">sub_capture</span>(<span class="ruby-identifier">capture</span>, <span class="ruby-identifier">symbolize</span>)&#x000A;  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@capture</span> = <span class="ruby-identifier">capture</span>&#x000A;    <span class="ruby-ivar">@symbolize</span> = <span class="ruby-identifier">symbolize</span>&#x000A;    <span class="ruby-ivar">@params</span> = <span class="ruby-ivar">@obj</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">new</span>&#x000A;  <span class="ruby-keyword">end</span>&#x000A;<span class="ruby-keyword">end</span></pre>
                </div>
              </div>
              <div class='method protected-instance' id='method-method-i-subkey'>
                <a name='method-i-subkey'></a>
                <div class='synopsis'>
                  <span class='name'>subkey</span>
                  <span class='arguments'>(keys, do_raise)</span>
                </div>
                <div class='description'>
                  
                  <p>Recursive method to get subkeys.</p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('method-i-subkey-source'); return false">
                    [show source]
                  </a>
                  <pre id='method-i-subkey-source'><span class="ruby-comment"># File lib/roda/plugins/typecast_params.rb, line 675</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-identifier">subkey</span>(<span class="ruby-identifier">keys</span>, <span class="ruby-identifier">do_raise</span>)&#x000A;  <span class="ruby-keyword">unless</span> <span class="ruby-identifier">key</span> = <span class="ruby-identifier">keys</span>.<span class="ruby-identifier">shift</span>&#x000A;    <span class="ruby-keyword">return</span> <span class="ruby-keyword">self</span>&#x000A;  <span class="ruby-keyword">end</span>&#x000A;&#x000A;  <span class="ruby-identifier">reason</span> = <span class="ruby-value">:invalid_type</span>&#x000A;&#x000A;  <span class="ruby-keyword">case</span> <span class="ruby-identifier">key</span>&#x000A;  <span class="ruby-keyword">when</span> <span class="ruby-constant">String</span>&#x000A;    <span class="ruby-keyword">unless</span> <span class="ruby-ivar">@obj</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Hash</span>)&#x000A;      <span class="ruby-identifier">raise</span> <span class="ruby-constant">Error</span>, <span class="ruby-node">&quot;parameter #{param_name(nil)} is not a hash&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">do_raise</span>&#x000A;      <span class="ruby-keyword">return</span>&#x000A;    <span class="ruby-keyword">end</span>&#x000A;    <span class="ruby-identifier">present</span> = <span class="ruby-ivar">@obj</span>.<span class="ruby-identifier">has_key?</span>(<span class="ruby-identifier">key</span>)&#x000A;  <span class="ruby-keyword">when</span> <span class="ruby-constant">Integer</span>&#x000A;    <span class="ruby-keyword">unless</span> <span class="ruby-ivar">@obj</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Array</span>)&#x000A;      <span class="ruby-identifier">raise</span> <span class="ruby-constant">Error</span>, <span class="ruby-node">&quot;parameter #{param_name(nil)} is not an array&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">do_raise</span>&#x000A;      <span class="ruby-keyword">return</span>&#x000A;    <span class="ruby-keyword">end</span>&#x000A;    <span class="ruby-identifier">present</span> = <span class="ruby-identifier">key</span> <span class="ruby-operator">&lt;</span> <span class="ruby-ivar">@obj</span>.<span class="ruby-identifier">length</span>&#x000A;  <span class="ruby-keyword">else</span>&#x000A;    <span class="ruby-identifier">raise</span> <span class="ruby-constant">ProgrammerError</span>, <span class="ruby-node">&quot;invalid argument used to traverse parameters: #{key.inspect}&quot;</span>&#x000A;  <span class="ruby-keyword">end</span>&#x000A;&#x000A;  <span class="ruby-keyword">unless</span> <span class="ruby-identifier">present</span>&#x000A;    <span class="ruby-identifier">reason</span> = <span class="ruby-value">:missing</span>&#x000A;    <span class="ruby-identifier">raise</span> <span class="ruby-constant">Error</span>, <span class="ruby-node">&quot;parameter #{param_name(key)} is not present&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">do_raise</span>&#x000A;    <span class="ruby-keyword">return</span>&#x000A;  <span class="ruby-keyword">end</span>&#x000A;&#x000A;  <span class="ruby-keyword">if</span> <span class="ruby-identifier">v</span> = <span class="ruby-keyword">self</span>[<span class="ruby-identifier">key</span>]&#x000A;    <span class="ruby-identifier">v</span>.<span class="ruby-identifier">subkey</span>(<span class="ruby-identifier">keys</span>, <span class="ruby-identifier">do_raise</span>)&#x000A;  <span class="ruby-keyword">end</span>&#x000A;<span class="ruby-keyword">rescue</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">e</span>&#x000A;  <span class="ruby-identifier">handle_error</span>(<span class="ruby-identifier">key</span>, <span class="ruby-identifier">reason</span>, <span class="ruby-identifier">e</span>)&#x000A;<span class="ruby-keyword">end</span></pre>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div id='footer-push'></div>
    </div>
    <div id='footer'>
      <a href="https://github.com/rdoc/hanna-nouveau"><strong>Hanna Nouveau</strong> RDoc template</a>
    </div>
  </body>
</html>
