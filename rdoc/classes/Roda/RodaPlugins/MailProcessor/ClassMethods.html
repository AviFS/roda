<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html lang='en'>
<head>
<title>Roda::RodaPlugins::MailProcessor::ClassMethods</title>
<meta content='text/html; charset=UTF-8' http-equiv='Content-Type'>
<link href='../../../../css/style.css' media='screen' rel='stylesheet' type='text/css'>
<script type='text/javascript'>
  function popupCode(url) {
    window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
  }
  
  function toggleCode(id) {
    var code = document.getElementById(id)
  
    code.style.display = code.style.display != 'block' ? 'block' : 'none'
    return true
  }
  
  // Make codeblocks hidden by default
  document.writeln('<' + 'style type="text/css">.method .source pre { display: none }<\/style>')
</script>
</head>
<body class='page'>
<div class='class' id='wrapper'>
<div class='header'>
<h1 class='name'><span class='type'>module</span>
Roda::RodaPlugins::MailProcessor::ClassMethods
</h1>
<ol class='paths'>
<li>
<a href="../../../../files/lib/roda/plugins/mail_processor_rb.html">lib/roda/plugins/mail_processor.rb</a>
</li>
</ol>
</div>
<div id='content'>
<div id='text'>
<div id='description'></div>
<div id='method-list'>
<h2>Methods</h2>
<h3>Public Instance</h3>
<ol>
<li><a href="#method-i-freeze">freeze</a></li>
<li><a href="#method-i-process_mail">process_mail</a></li>
<li><a href="#method-i-process_mailbox">process_mailbox</a></li>
<li><a href="#method-i-rcpt">rcpt</a></li>
</ol>
</div>
<div id='context'>
</div>
<div id='section'>
<div id='methods'>
<h2>Public Instance methods</h2>
<div class='method public-instance' id='method-method-i-freeze'>
<a name='method-i-freeze'></a>
<div class='synopsis'>
<span class='name'>freeze</span>
<span class='arguments'>()</span>

</div>
<div class='description'>

<p>Freeze the rcpt routes if they are present.</p>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-freeze-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-freeze-source'>    <span class="ruby-comment"># File lib/roda/plugins/mail_processor.rb</span>&#x000A;<span class="line-num">289</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">freeze</span>&#x000A;<span class="line-num">290</span>   <span class="ruby-keyword">if</span> <span class="ruby-identifier">string_routes</span> = <span class="ruby-identifier">opts</span>[<span class="ruby-value">:mail_processor_string_routes</span>].<span class="ruby-identifier">freeze</span>&#x000A;<span class="line-num">291</span>     <span class="ruby-identifier">string_routes</span>.<span class="ruby-identifier">freeze</span>&#x000A;<span class="line-num">292</span>     <span class="ruby-identifier">opts</span>[<span class="ruby-value">:mail_processor_regexp_routes</span>].<span class="ruby-identifier">freeze</span>&#x000A;<span class="line-num">293</span>   <span class="ruby-keyword">end</span>&#x000A;<span class="line-num">294</span>   <span class="ruby-keyword">super</span>&#x000A;<span class="line-num">295</span> <span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method public-instance' id='method-method-i-process_mail'>
<a name='method-i-process_mail'></a>
<div class='synopsis'>
<span class='name'>process_mail</span>
<span class='arguments'>(mail)</span>

</div>
<div class='description'>

<p>Process the given Mail instance, calling the appropriate hooks depending on whether the mail was handled during processing.</p>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-process_mail-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-process_mail-source'>    <span class="ruby-comment"># File lib/roda/plugins/mail_processor.rb</span>&#x000A;<span class="line-num">299</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">process_mail</span>(<span class="ruby-identifier">mail</span>)&#x000A;<span class="line-num">300</span>   <span class="ruby-identifier">scope</span> = <span class="ruby-identifier">new</span>(<span class="ruby-string">&quot;PATH_INFO&quot;</span><span class="ruby-operator">=&gt;</span><span class="ruby-string">&#39;&#39;</span>, <span class="ruby-string">&#39;SCRIPT_NAME&#39;</span><span class="ruby-operator">=&gt;</span><span class="ruby-string">&#39;&#39;</span>, <span class="ruby-string">&quot;REQUEST_METHOD&quot;</span><span class="ruby-operator">=&gt;</span><span class="ruby-string">&quot;PROCESSMAIL&quot;</span>, <span class="ruby-string">&#39;rack.input&#39;</span><span class="ruby-operator">=&gt;</span><span class="ruby-constant">StringIO</span>.<span class="ruby-identifier">new</span>, <span class="ruby-string">&#39;roda.mail&#39;</span><span class="ruby-operator">=&gt;</span><span class="ruby-identifier">mail</span>)&#x000A;<span class="line-num">301</span> &#x000A;<span class="line-num">302</span>   <span class="ruby-keyword">begin</span>&#x000A;<span class="line-num">303</span>     <span class="ruby-keyword">begin</span>&#x000A;<span class="line-num">304</span>       <span class="ruby-identifier">scope</span>.<span class="ruby-identifier">process_mail</span>&#x000A;<span class="line-num">305</span>     <span class="ruby-keyword">rescue</span> <span class="ruby-constant">UnhandledMail</span>&#x000A;<span class="line-num">306</span>       <span class="ruby-identifier">scope</span>.<span class="ruby-identifier">unhandled_mail_hook</span>&#x000A;<span class="line-num">307</span>     <span class="ruby-keyword">else</span>&#x000A;<span class="line-num">308</span>       <span class="ruby-identifier">scope</span>.<span class="ruby-identifier">handled_mail_hook</span>&#x000A;<span class="line-num">309</span>     <span class="ruby-keyword">end</span>&#x000A;<span class="line-num">310</span>   <span class="ruby-keyword">ensure</span>&#x000A;<span class="line-num">311</span>     <span class="ruby-identifier">scope</span>.<span class="ruby-identifier">after_mail_hook</span>&#x000A;<span class="line-num">312</span>   <span class="ruby-keyword">end</span>&#x000A;<span class="line-num">313</span> <span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method public-instance' id='method-method-i-process_mailbox'>
<a name='method-i-process_mailbox'></a>
<div class='synopsis'>
<span class='name'>process_mailbox</span>
<span class='arguments'>(opts=OPTS)</span>

</div>
<div class='description'>

<p>Process all mail in the given mailbox.  If the <code>:retriever</code> option is given, should be an object supporting the Mail retriever API, otherwise uses the default Mail retriever_method.  This deletes retrieved mail from the mailbox after processing, so that when called multiple times it does not reprocess the same mail.  If mail should be archived and not deleted, the <code>after_mail</code> method should be used to perform the archiving of the mail.</p>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-process_mailbox-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-process_mailbox-source'>    <span class="ruby-comment"># File lib/roda/plugins/mail_processor.rb</span>&#x000A;<span class="line-num">321</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">process_mailbox</span>(<span class="ruby-identifier">opts</span>=<span class="ruby-constant">OPTS</span>)&#x000A;<span class="line-num">322</span>   (<span class="ruby-identifier">opts</span>[<span class="ruby-value">:retriever</span>] <span class="ruby-operator">||</span> <span class="ruby-constant">Mail</span>).<span class="ruby-identifier">find_and_delete</span>(<span class="ruby-identifier">opts</span>.<span class="ruby-identifier">dup</span>){<span class="ruby-operator">|</span><span class="ruby-identifier">m</span><span class="ruby-operator">|</span> <span class="ruby-identifier">process_mail</span>(<span class="ruby-identifier">m</span>)}&#x000A;<span class="line-num">323</span>   <span class="ruby-keyword">nil</span>&#x000A;<span class="line-num">324</span> <span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method public-instance' id='method-method-i-rcpt'>
<a name='method-i-rcpt'></a>
<div class='synopsis'>
<span class='name'>rcpt</span>
<span class='arguments'>(*addresses, &block)</span>

</div>
<div class='description'>

<p>Setup a routing tree for the given recipient addresses, which can be strings or regexps. Any messages matching the given recipient address will use these routing trees instead of the normal routing tree.</p>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-rcpt-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-rcpt-source'>    <span class="ruby-comment"># File lib/roda/plugins/mail_processor.rb</span>&#x000A;<span class="line-num">329</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">rcpt</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">addresses</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)&#x000A;<span class="line-num">330</span>   <span class="ruby-identifier">opts</span>[<span class="ruby-value">:mail_processor_string_routes</span>] <span class="ruby-operator">||=</span> {}&#x000A;<span class="line-num">331</span>   <span class="ruby-identifier">opts</span>[<span class="ruby-value">:mail_processor_regexp_routes</span>] <span class="ruby-operator">||=</span> {}&#x000A;<span class="line-num">332</span>   <span class="ruby-identifier">string_meth</span> = <span class="ruby-keyword">nil</span>&#x000A;<span class="line-num">333</span>   <span class="ruby-identifier">regexp_meth</span> = <span class="ruby-keyword">nil</span>&#x000A;<span class="line-num">334</span>   <span class="ruby-identifier">addresses</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">address</span><span class="ruby-operator">|</span>&#x000A;<span class="line-num">335</span>     <span class="ruby-identifier">key</span> = <span class="ruby-keyword">case</span> <span class="ruby-identifier">address</span>&#x000A;<span class="line-num">336</span>     <span class="ruby-keyword">when</span> <span class="ruby-constant">String</span>&#x000A;<span class="line-num">337</span>       <span class="ruby-keyword">unless</span> <span class="ruby-identifier">string_meth</span>&#x000A;<span class="line-num">338</span>         <span class="ruby-identifier">string_meth</span> = <span class="ruby-identifier">define_roda_method</span>(<span class="ruby-node">&quot;mail_processor_string_route_#{address}&quot;</span>, <span class="ruby-value">1</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">convert_route_block</span>(<span class="ruby-identifier">block</span>))&#x000A;<span class="line-num">339</span>       <span class="ruby-keyword">end</span>&#x000A;<span class="line-num">340</span>       <span class="ruby-identifier">opts</span>[<span class="ruby-value">:mail_processor_string_routes</span>][<span class="ruby-identifier">address</span>] = <span class="ruby-identifier">string_meth</span> &#x000A;<span class="line-num">341</span>     <span class="ruby-keyword">when</span> <span class="ruby-constant">Regexp</span>&#x000A;<span class="line-num">342</span>       <span class="ruby-keyword">unless</span> <span class="ruby-identifier">regexp_meth</span>&#x000A;<span class="line-num">343</span>         <span class="ruby-identifier">regexp_meth</span> = <span class="ruby-identifier">define_roda_method</span>(<span class="ruby-node">&quot;mail_processor_regexp_route_#{address}&quot;</span>, <span class="ruby-value">:any</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">convert_route_block</span>(<span class="ruby-identifier">block</span>))&#x000A;<span class="line-num">344</span>       <span class="ruby-keyword">end</span>&#x000A;<span class="line-num">345</span>       <span class="ruby-identifier">opts</span>[<span class="ruby-value">:mail_processor_regexp_routes</span>][<span class="ruby-identifier">address</span>] = <span class="ruby-identifier">regexp_meth</span>&#x000A;<span class="line-num">346</span>     <span class="ruby-keyword">else</span>&#x000A;<span class="line-num">347</span>       <span class="ruby-identifier">raise</span> <span class="ruby-constant">RodaError</span>, <span class="ruby-string">&quot;invalid address format passed to rcpt, should be Array or String&quot;</span>&#x000A;<span class="line-num">348</span>     <span class="ruby-keyword">end</span>&#x000A;<span class="line-num">349</span>   <span class="ruby-keyword">end</span>&#x000A;<span class="line-num">350</span>   <span class="ruby-keyword">nil</span>&#x000A;<span class="line-num">351</span> <span class="ruby-keyword">end</span></pre>
</div>
</div>
</div>
</div>

</div>
</div>

<div id='footer-push'></div>
</div>
<div id='footer'>
<a href="https://github.com/rdoc/hanna-nouveau"><strong>Hanna Nouveau</strong> RDoc template</a>
</div>
</body>
</html>
