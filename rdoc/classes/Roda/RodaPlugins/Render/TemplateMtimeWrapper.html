<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html lang='en'>
<head>
<title>Roda::RodaPlugins::Render::TemplateMtimeWrapper</title>
<meta name='viewport' content='width=device-width, initial-scale=1'>
<meta content='text/html; charset=UTF-8' http-equiv='Content-Type'>
<link href='../../../../css/style.css' media='screen' rel='stylesheet' type='text/css'>
<script type='text/javascript'>
  function popupCode(url) {
    window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
  }
  
  function toggleCode(id) {
    var code = document.getElementById(id)
  
    code.style.display = code.style.display != 'block' ? 'block' : 'none'
    return true
  }
  
  // Make codeblocks hidden by default
  document.writeln('<' + 'style type="text/css">.method .source pre { display: none }<\/style>')
</script>
</head>
<body class='page'>
<div class='class' id='wrapper'>
<div class='header'>
<h1 class='name'><span class='type'>class</span>
Roda::RodaPlugins::Render::TemplateMtimeWrapper
</h1>
<ol class='paths'>
<li>
<a href="../../../../files/lib/roda/plugins/render_rb.html">lib/roda/plugins/render.rb</a>
</li>
</ol>
<div class='parent'>
Superclass:
<strong>Object</strong>
</div>
</div>
<div id='content'>
<div id='text'>
<div id='description'>
<p>Wrapper object for the Tilt template, that checks the modified time of the template file, and rebuilds the template if the template file has been modified.  This is an internal class and the API is subject to change at any time.</p>
</div>
<div id='method-list'>
<h2>Methods</h2>
<h3>Public Class</h3>
<ol>
<li><a href="#method-c-new">new</a></li>
</ol>
<h3>Public Instance</h3>
<ol>
<li><a href="#method-i-compiled_method">compiled_method</a></li>
<li><a href="#method-i-compiled_method_lambda">compiled_method_lambda</a></li>
<li><a href="#method-i-define_compiled_method">define_compiled_method</a></li>
<li><a href="#method-i-define_compiled_method_cache_value">define_compiled_method_cache_value</a></li>
<li><a href="#method-i-fixed_locals-3F">fixed_locals?</a></li>
<li><a href="#method-i-if_modified">if_modified</a></li>
<li><a href="#method-i-render">render</a></li>
<li><a href="#method-i-template_last_modified">template_last_modified</a></li>
</ol>
</div>
<div id='context'>
</div>
<div id='section'>
<div id='methods'>
<h2>Public Class methods</h2>
<div class='method public-class' id='method-method-c-new'>
<a name='method-c-new'></a>
<div class='synopsis'>
<span class='name'>new</span><span class='arguments'>(roda_class, opts, template_opts)</span>

</div>
<div class='description'>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-c-new-source&#39;); return false'>
[show source]
</a>
<pre id='method-c-new-source'>    <span class="ruby-comment"># File lib/roda/plugins/render.rb</span>
<span class="line-num">403</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">initialize</span>(<span class="ruby-identifier">roda_class</span>, <span class="ruby-identifier">opts</span>, <span class="ruby-identifier">template_opts</span>)
<span class="line-num">404</span>   <span class="ruby-ivar">@roda_class</span> = <span class="ruby-identifier">roda_class</span>
<span class="line-num">405</span>   <span class="ruby-ivar">@opts</span> = <span class="ruby-identifier">opts</span>
<span class="line-num">406</span>   <span class="ruby-ivar">@template_opts</span> = <span class="ruby-identifier">template_opts</span>
<span class="line-num">407</span>   <span class="ruby-identifier">reset_template</span>
<span class="line-num">408</span> 
<span class="line-num">409</span>   <span class="ruby-ivar">@path</span> = <span class="ruby-identifier">opts</span>[<span class="ruby-value">:path</span>]
<span class="line-num">410</span>   <span class="ruby-identifier">deps</span> = <span class="ruby-identifier">opts</span>[<span class="ruby-value">:dependencies</span>]
<span class="line-num">411</span>   <span class="ruby-ivar">@dependencies</span> = ([<span class="ruby-ivar">@path</span>] <span class="ruby-operator">+</span> <span class="ruby-constant">Array</span>(<span class="ruby-identifier">deps</span>)) <span class="ruby-keyword">if</span> <span class="ruby-identifier">deps</span>
<span class="line-num">412</span>   <span class="ruby-ivar">@mtime</span> = <span class="ruby-identifier">template_last_modified</span>
<span class="line-num">413</span> <span class="ruby-keyword">end</span></pre>
</div>
</div>
<h2>Public Instance methods</h2>
<div class='method public-instance' id='method-method-i-compiled_method'>
<a name='method-i-compiled_method'></a>
<div class='synopsis'>
<span class='name'>compiled_method</span><span class='arguments'>(locals_keys=EMPTY_ARRAY, roda_class=nil)</span>

</div>
<div class='description'>

<p>Return the compiled method for the current template object.</p>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-compiled_method-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-compiled_method-source'>    <span class="ruby-comment"># File lib/roda/plugins/render.rb</span>
<span class="line-num">490</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">compiled_method</span>(<span class="ruby-identifier">locals_keys</span>=<span class="ruby-constant">EMPTY_ARRAY</span>, <span class="ruby-identifier">roda_class</span>=<span class="ruby-keyword">nil</span>)
<span class="line-num">491</span>   <span class="ruby-constant">Render</span>.<span class="ruby-identifier">tilt_template_compiled_method</span>(<span class="ruby-ivar">@template</span>, <span class="ruby-identifier">locals_keys</span>, <span class="ruby-identifier">roda_class</span>)
<span class="line-num">492</span> <span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method public-instance' id='method-method-i-compiled_method_lambda'>
<a name='method-i-compiled_method_lambda'></a>
<div class='synopsis'>
<span class='name'>compiled_method_lambda</span><span class='arguments'>(roda_class, method_name, locals_keys=EMPTY_ARRAY)</span>

</div>
<div class='description'>

<p>Return the lambda used to define the compiled template method.  This is separated into its own method so the lambda does not capture any unnecessary local variables</p>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-compiled_method_lambda-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-compiled_method_lambda-source'>    <span class="ruby-comment"># File lib/roda/plugins/render.rb</span>
<span class="line-num">497</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">compiled_method_lambda</span>(<span class="ruby-identifier">roda_class</span>, <span class="ruby-identifier">method_name</span>, <span class="ruby-identifier">locals_keys</span>=<span class="ruby-constant">EMPTY_ARRAY</span>)
<span class="line-num">498</span>   <span class="ruby-identifier">mod</span> = <span class="ruby-identifier">roda_class</span><span class="ruby-operator">::</span><span class="ruby-constant">RodaCompiledTemplates</span>
<span class="line-num">499</span>   <span class="ruby-identifier">template</span> = <span class="ruby-keyword">self</span>
<span class="line-num">500</span>   <span class="ruby-identifier">lambda</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">locals</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span><span class="ruby-operator">|</span>
<span class="line-num">501</span>     <span class="ruby-identifier">template</span>.<span class="ruby-identifier">if_modified</span> <span class="ruby-keyword">do</span>
<span class="line-num">502</span>       <span class="ruby-identifier">mod</span>.<span class="ruby-identifier">send</span>(<span class="ruby-value">:define_method</span>, <span class="ruby-identifier">method_name</span>, <span class="ruby-constant">Render</span>.<span class="ruby-identifier">tilt_template_compiled_method</span>(<span class="ruby-identifier">template</span>, <span class="ruby-identifier">locals_keys</span>, <span class="ruby-identifier">roda_class</span>))
<span class="line-num">503</span>       <span class="ruby-identifier">mod</span>.<span class="ruby-identifier">send</span>(<span class="ruby-value">:private</span>, <span class="ruby-identifier">method_name</span>)
<span class="line-num">504</span>     <span class="ruby-keyword">end</span>
<span class="line-num">505</span> 
<span class="line-num">506</span>     <span class="ruby-identifier">_call_optimized_template_method</span>([<span class="ruby-identifier">method_name</span>, <span class="ruby-constant">Render</span>.<span class="ruby-identifier">tilt_template_fixed_locals?</span>(<span class="ruby-identifier">template</span>)], <span class="ruby-identifier">locals</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
<span class="line-num">507</span>   <span class="ruby-keyword">end</span>
<span class="line-num">508</span> <span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method public-instance' id='method-method-i-define_compiled_method'>
<a name='method-i-define_compiled_method'></a>
<div class='synopsis'>
<span class='name'>define_compiled_method</span><span class='arguments'>(roda_class, method_name, locals_keys=EMPTY_ARRAY)</span>

</div>
<div class='description'>

<p>Compile a method in the given module with the given name that will call the compiled template method, updating the compiled template method</p>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-define_compiled_method-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-define_compiled_method-source'>    <span class="ruby-comment"># File lib/roda/plugins/render.rb</span>
<span class="line-num">462</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">define_compiled_method</span>(<span class="ruby-identifier">roda_class</span>, <span class="ruby-identifier">method_name</span>, <span class="ruby-identifier">locals_keys</span>=<span class="ruby-constant">EMPTY_ARRAY</span>)
<span class="line-num">463</span>   <span class="ruby-identifier">mod</span> = <span class="ruby-identifier">roda_class</span><span class="ruby-operator">::</span><span class="ruby-constant">RodaCompiledTemplates</span>
<span class="line-num">464</span>   <span class="ruby-identifier">internal_method_name</span> = <span class="ruby-value">:&quot;_#{method_name}&quot;</span>
<span class="line-num">465</span>   <span class="ruby-keyword">begin</span>
<span class="line-num">466</span>     <span class="ruby-identifier">mod</span>.<span class="ruby-identifier">send</span>(<span class="ruby-value">:define_method</span>, <span class="ruby-identifier">internal_method_name</span>, <span class="ruby-identifier">compiled_method</span>(<span class="ruby-identifier">locals_keys</span>, <span class="ruby-identifier">roda_class</span>))
<span class="line-num">467</span>   <span class="ruby-keyword">rescue</span> <span class="ruby-operator">::</span><span class="ruby-constant">NotImplementedError</span>
<span class="line-num">468</span>     <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span>
<span class="line-num">469</span>   <span class="ruby-keyword">end</span>
<span class="line-num">470</span> 
<span class="line-num">471</span>   <span class="ruby-identifier">mod</span>.<span class="ruby-identifier">send</span>(<span class="ruby-value">:private</span>, <span class="ruby-identifier">internal_method_name</span>)
<span class="line-num">472</span>   <span class="ruby-identifier">mod</span>.<span class="ruby-identifier">send</span>(<span class="ruby-value">:define_method</span>, <span class="ruby-identifier">method_name</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">compiled_method_lambda</span>(<span class="ruby-identifier">roda_class</span>, <span class="ruby-identifier">internal_method_name</span>, <span class="ruby-identifier">locals_keys</span>))
<span class="line-num">473</span>   <span class="ruby-identifier">mod</span>.<span class="ruby-identifier">send</span>(<span class="ruby-value">:private</span>, <span class="ruby-identifier">method_name</span>)
<span class="line-num">474</span> 
<span class="line-num">475</span>   <span class="ruby-identifier">method_name</span>
<span class="line-num">476</span> <span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method public-instance' id='method-method-i-define_compiled_method_cache_value'>
<a name='method-i-define_compiled_method_cache_value'></a>
<div class='synopsis'>
<span class='name'>define_compiled_method_cache_value</span><span class='arguments'>(roda_class, method_name, locals_keys=EMPTY_ARRAY)</span>

</div>
<div class='description'>

<p>Returns an appropriate value for the template method cache.</p>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-define_compiled_method_cache_value-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-define_compiled_method_cache_value-source'>    <span class="ruby-comment"># File lib/roda/plugins/render.rb</span>
<span class="line-num">479</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">define_compiled_method_cache_value</span>(<span class="ruby-identifier">roda_class</span>, <span class="ruby-identifier">method_name</span>, <span class="ruby-identifier">locals_keys</span>=<span class="ruby-constant">EMPTY_ARRAY</span>)
<span class="line-num">480</span>   <span class="ruby-keyword">if</span> <span class="ruby-identifier">compiled_method</span> = <span class="ruby-identifier">define_compiled_method</span>(<span class="ruby-identifier">roda_class</span>, <span class="ruby-identifier">method_name</span>, <span class="ruby-identifier">locals_keys</span>)
<span class="line-num">481</span>     [<span class="ruby-identifier">compiled_method</span>, <span class="ruby-keyword">false</span>].<span class="ruby-identifier">freeze</span>
<span class="line-num">482</span>   <span class="ruby-keyword">else</span>
<span class="line-num">483</span>     <span class="ruby-identifier">compiled_method</span>
<span class="line-num">484</span>   <span class="ruby-keyword">end</span>
<span class="line-num">485</span> <span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method public-instance' id='method-method-i-fixed_locals-3F'>
<a name='method-i-fixed_locals-3F'></a>
<div class='synopsis'>
<span class='name'>fixed_locals?</span><span class='arguments'>()</span>

</div>
<div class='description'>

<p>Whether the underlying template uses fixed locals.</p>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-fixed_locals-3F-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-fixed_locals-3F-source'>    <span class="ruby-comment"># File lib/roda/plugins/render.rb</span>
<span class="line-num">456</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">fixed_locals?</span>
<span class="line-num">457</span>   <span class="ruby-constant">Render</span>.<span class="ruby-identifier">tilt_template_fixed_locals?</span>(<span class="ruby-ivar">@template</span>)
<span class="line-num">458</span> <span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method public-instance' id='method-method-i-if_modified'>
<a name='method-i-if_modified'></a>
<div class='synopsis'>
<span class='name'>if_modified</span><span class='arguments'>()</span>

</div>
<div class='description'>

<p>If the template file has been updated, return true and update the template object and the modification time. Other return false.</p>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-if_modified-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-if_modified-source'>    <span class="ruby-comment"># File lib/roda/plugins/render.rb</span>
<span class="line-num">440</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">if_modified</span>
<span class="line-num">441</span>   <span class="ruby-keyword">begin</span>
<span class="line-num">442</span>     <span class="ruby-identifier">mtime</span> = <span class="ruby-identifier">template_last_modified</span>
<span class="line-num">443</span>   <span class="ruby-keyword">rescue</span>
<span class="line-num">444</span>     <span class="ruby-comment"># ignore errors</span>
<span class="line-num">445</span>   <span class="ruby-keyword">else</span>
<span class="line-num">446</span>     <span class="ruby-keyword">if</span> <span class="ruby-identifier">mtime</span> <span class="ruby-operator">!=</span> <span class="ruby-ivar">@mtime</span>
<span class="line-num">447</span>       <span class="ruby-identifier">reset_template</span>
<span class="line-num">448</span>       <span class="ruby-keyword">yield</span>
<span class="line-num">449</span>       <span class="ruby-ivar">@mtime</span> = <span class="ruby-identifier">mtime</span>
<span class="line-num">450</span>     <span class="ruby-keyword">end</span>
<span class="line-num">451</span>   <span class="ruby-keyword">end</span>
<span class="line-num">452</span> <span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method public-instance' id='method-method-i-render'>
<a name='method-i-render'></a>
<div class='synopsis'>
<span class='name'>render</span><span class='arguments'>(*args, &block)</span>

</div>
<div class='description'>

<p>If the template file exists and the modification time has changed, rebuild the template file, then call render on it.</p>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-render-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-render-source'>    <span class="ruby-comment"># File lib/roda/plugins/render.rb</span>
<span class="line-num">417</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">render</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">args</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
<span class="line-num">418</span>   <span class="ruby-identifier">res</span> = <span class="ruby-keyword">nil</span>
<span class="line-num">419</span>   <span class="ruby-identifier">modified</span> = <span class="ruby-keyword">false</span>
<span class="line-num">420</span>   <span class="ruby-identifier">if_modified</span> <span class="ruby-keyword">do</span>
<span class="line-num">421</span>     <span class="ruby-identifier">res</span> = <span class="ruby-ivar">@template</span>.<span class="ruby-identifier">render</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">args</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
<span class="line-num">422</span>     <span class="ruby-identifier">modified</span> = <span class="ruby-keyword">true</span>
<span class="line-num">423</span>   <span class="ruby-keyword">end</span>
<span class="line-num">424</span>   <span class="ruby-identifier">modified</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">res</span> <span class="ruby-operator">:</span> <span class="ruby-ivar">@template</span>.<span class="ruby-identifier">render</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">args</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
<span class="line-num">425</span> <span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method public-instance' id='method-method-i-template_last_modified'>
<a name='method-i-template_last_modified'></a>
<div class='synopsis'>
<span class='name'>template_last_modified</span><span class='arguments'>()</span>

</div>
<div class='description'>

<p>Return when the template was last modified.  If the template depends on any other files, check the modification times of all dependencies and return the maximum.</p>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-template_last_modified-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-template_last_modified-source'>    <span class="ruby-comment"># File lib/roda/plugins/render.rb</span>
<span class="line-num">430</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">template_last_modified</span>
<span class="line-num">431</span>   <span class="ruby-keyword">if</span> <span class="ruby-identifier">deps</span> = <span class="ruby-ivar">@dependencies</span>
<span class="line-num">432</span>     <span class="ruby-identifier">deps</span>.<span class="ruby-identifier">map</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">f</span><span class="ruby-operator">|</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">mtime</span>(<span class="ruby-identifier">f</span>)}.<span class="ruby-identifier">max</span>
<span class="line-num">433</span>   <span class="ruby-keyword">else</span>
<span class="line-num">434</span>     <span class="ruby-constant">File</span>.<span class="ruby-identifier">mtime</span>(<span class="ruby-ivar">@path</span>)
<span class="line-num">435</span>   <span class="ruby-keyword">end</span>
<span class="line-num">436</span> <span class="ruby-keyword">end</span></pre>
</div>
</div>
</div>
</div>

</div>
</div>

<div id='footer-push'></div>
</div>
<div id='footer'>
<a href="https://github.com/jeremyevans/hanna"><strong>Hanna</strong> RDoc template</a>
</div>
</body>
</html>
