<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html lang='en'>
<head>
<title>Roda::RodaPlugins::MultiPublic</title>
<meta name='viewport' content='width=device-width, initial-scale=1'>
<meta content='text/html; charset=UTF-8' http-equiv='Content-Type'>
<link href='../../../css/style.css' media='screen' rel='stylesheet' type='text/css'>
<script type='text/javascript'>
  function popupCode(url) {
    window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
  }
  
  function toggleCode(id) {
    var code = document.getElementById(id)
  
    code.style.display = code.style.display != 'block' ? 'block' : 'none'
    return true
  }
  
  // Make codeblocks hidden by default
  document.writeln('<' + 'style type="text/css">.method .source pre { display: none }<\/style>')
</script>
</head>
<body class='page'>
<div class='class' id='wrapper'>
<div class='header'>
<h1 class='name'><span class='type'>module</span>
Roda::RodaPlugins::MultiPublic
</h1>
<ol class='paths'>
<li>
<a href="../../../files/lib/roda/plugins/multi_public_rb.html">lib/roda/plugins/multi_public.rb</a>
</li>
</ol>
</div>
<div id='content'>
<div id='text'>
<div id='description'>
<p>The multi_public plugin adds an <code>r.multi_public</code> method that accepts an argument specifying a directory from which to serve static files.  It is similar to the public plugin, but allows for multiple separate directories.</p>

<p>Hereâ€™s an example of using the multi_public plugin to serve 3 different types of files from 3 different directories:</p>

<pre class="ruby"><span class="ruby-identifier">plugin</span> <span class="ruby-value">:multi_public</span>,
  <span class="ruby-value">img:</span>  <span class="ruby-string">&#39;static/images&#39;</span>,
  <span class="ruby-value">font:</span> <span class="ruby-string">&#39;assets/fonts&#39;</span>,
  <span class="ruby-value">form:</span> <span class="ruby-string">&#39;static/forms/pdfs&#39;</span>

<span class="ruby-identifier">r</span>.<span class="ruby-identifier">route</span> <span class="ruby-keyword">do</span>
  <span class="ruby-identifier">r</span>.<span class="ruby-identifier">on</span> <span class="ruby-string">&quot;images&quot;</span> <span class="ruby-keyword">do</span>
    <span class="ruby-identifier">r</span>.<span class="ruby-identifier">multi_public</span>(<span class="ruby-value">:img</span>)
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">r</span>.<span class="ruby-identifier">on</span> <span class="ruby-string">&quot;fonts&quot;</span> <span class="ruby-keyword">do</span>
    <span class="ruby-identifier">r</span>.<span class="ruby-identifier">multi_public</span>(<span class="ruby-value">:font</span>)
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">r</span>.<span class="ruby-identifier">on</span> <span class="ruby-string">&quot;forms&quot;</span> <span class="ruby-keyword">do</span>
    <span class="ruby-identifier">r</span>.<span class="ruby-identifier">multi_public</span>(<span class="ruby-value">:form</span>)
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span>
</pre>

<p>It is possible to simplify the routing tree for this using string keys and an array matcher:</p>

<pre class="ruby"><span class="ruby-identifier">plugin</span> <span class="ruby-value">:multi_public</span>,
  <span class="ruby-string">&#39;images&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-string">&#39;static/images&#39;</span>,
  <span class="ruby-string">&#39;fonts&#39;</span>  <span class="ruby-operator">=&gt;</span> <span class="ruby-string">&#39;assets/fonts&#39;</span>,
  <span class="ruby-string">&#39;forms&#39;</span>  <span class="ruby-operator">=&gt;</span> <span class="ruby-string">&#39;static/forms/pdfs&#39;</span>

<span class="ruby-identifier">r</span>.<span class="ruby-identifier">route</span> <span class="ruby-keyword">do</span>
  <span class="ruby-identifier">r</span>.<span class="ruby-identifier">on</span> <span class="ruby-node">%w&quot;images fonts forms&quot;</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">dir</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">r</span>.<span class="ruby-identifier">multi_public</span>(<span class="ruby-identifier">dir</span>)
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span>
</pre>

<p>You can provide custom headers and default mime type for each directory using an array of three elements as the value, with the first element being the path, the second being the custom headers, and the third being the default mime type:</p>

<pre class="ruby"><span class="ruby-identifier">plugin</span> <span class="ruby-value">:multi_public</span>,
  <span class="ruby-string">&#39;images&#39;</span> <span class="ruby-operator">=&gt;</span> [<span class="ruby-string">&#39;static/images&#39;</span>, {<span class="ruby-string">&#39;Cache-Control&#39;</span><span class="ruby-operator">=&gt;</span><span class="ruby-string">&#39;max-age=86400&#39;</span>}, <span class="ruby-keyword">nil</span>],
  <span class="ruby-string">&#39;fonts&#39;</span>  <span class="ruby-operator">=&gt;</span> [<span class="ruby-string">&#39;assets/fonts&#39;</span>, {<span class="ruby-string">&#39;Cache-Control&#39;</span><span class="ruby-operator">=&gt;</span><span class="ruby-string">&#39;max-age=31536000&#39;</span>}, <span class="ruby-string">&#39;font/ttf&#39;</span>],
  <span class="ruby-string">&#39;forms&#39;</span>  <span class="ruby-operator">=&gt;</span> [<span class="ruby-string">&#39;static/forms/pdfs&#39;</span>, <span class="ruby-keyword">nil</span>, <span class="ruby-string">&#39;application/pdf&#39;</span>]

<span class="ruby-identifier">r</span>.<span class="ruby-identifier">route</span> <span class="ruby-keyword">do</span>
  <span class="ruby-identifier">r</span>.<span class="ruby-identifier">on</span> <span class="ruby-node">%w&quot;images fonts forms&quot;</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">dir</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">r</span>.<span class="ruby-identifier">multi_public</span>(<span class="ruby-identifier">dir</span>)
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span>
</pre>
</div>
<div id='method-list'>
<h2>Methods</h2>
<h3>Public Class</h3>
<ol>
<li><a href="#method-c-configure">configure</a></li>
<li><a href="#method-c-load_dependencies">load_dependencies</a></li>
</ol>
</div>
<div id='context'>
</div>
<div id='class-list'>
<h2>Classes and Modules</h2>
<ol>
<li><a href="MultiPublic/RequestMethods.html">Roda::RodaPlugins::MultiPublic::RequestMethods</a></li>
</ol>
</div>
<div id='section'>
<div id='constants-list'>
<h2>Constants</h2>
<div class='name-list'>
<table summary='Constants'>
<tr class='top-aligned-row context-row'>
<td class='context-item-name'>RACK_FILES</td>
<td>=</td>
<td class='context-item-value'>defined?(Rack::Files) ? Rack::Files : Rack::File</td>
<td>&nbsp;</td>
<td class='context-item-desc'></td>
</tr>
</table>
</div>
</div>
<div id='methods'>
<h2>Public Class methods</h2>
<div class='method public-class' id='method-method-c-configure'>
<a name='method-c-configure'></a>
<div class='synopsis'>
<span class='name'>configure</span><span class='arguments'>(app, directories, _=OPTS)</span>

</div>
<div class='description'>

<p>Use the given directories to setup servers.  Any opts are passed to the public plugin.</p>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-c-configure-source&#39;); return false'>
[show source]
</a>
<pre id='method-c-configure-source'>   <span class="ruby-comment"># File lib/roda/plugins/multi_public.rb</span>
<span class="line-num">74</span> <span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier ruby-title">configure</span>(<span class="ruby-identifier">app</span>, <span class="ruby-identifier">directories</span>, <span class="ruby-identifier">_</span>=<span class="ruby-constant">OPTS</span>)
<span class="line-num">75</span>   <span class="ruby-identifier">roots</span> = <span class="ruby-identifier">app</span>.<span class="ruby-identifier">opts</span>[<span class="ruby-value">:multi_public_servers</span>] = (<span class="ruby-identifier">app</span>.<span class="ruby-identifier">opts</span>[<span class="ruby-value">:multi_public_servers</span>] <span class="ruby-operator">||</span> {}).<span class="ruby-identifier">dup</span>
<span class="line-num">76</span>   <span class="ruby-identifier">directories</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">key</span>, <span class="ruby-identifier">path</span><span class="ruby-operator">|</span>
<span class="line-num">77</span>     <span class="ruby-identifier">path</span>, <span class="ruby-identifier">headers</span>, <span class="ruby-identifier">mime</span> = <span class="ruby-identifier">path</span>
<span class="line-num">78</span>     <span class="ruby-identifier">roots</span>[<span class="ruby-identifier">key</span>] = <span class="ruby-constant">RACK_FILES</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">app</span>.<span class="ruby-identifier">expand_path</span>(<span class="ruby-identifier">path</span>), <span class="ruby-identifier">headers</span><span class="ruby-operator">||</span>{}, <span class="ruby-identifier">mime</span><span class="ruby-operator">||</span><span class="ruby-string">&#39;text/plain&#39;</span>)
<span class="line-num">79</span>   <span class="ruby-keyword">end</span>
<span class="line-num">80</span>   <span class="ruby-identifier">roots</span>.<span class="ruby-identifier">freeze</span>
<span class="line-num">81</span> <span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method public-class' id='method-method-c-load_dependencies'>
<a name='method-c-load_dependencies'></a>
<div class='synopsis'>
<span class='name'>load_dependencies</span><span class='arguments'>(app, _, opts=OPTS)</span>

</div>
<div class='description'>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-c-load_dependencies-source&#39;); return false'>
[show source]
</a>
<pre id='method-c-load_dependencies-source'>   <span class="ruby-comment"># File lib/roda/plugins/multi_public.rb</span>
<span class="line-num">69</span> <span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier ruby-title">load_dependencies</span>(<span class="ruby-identifier">app</span>, <span class="ruby-identifier">_</span>, <span class="ruby-identifier">opts</span>=<span class="ruby-constant">OPTS</span>)
<span class="line-num">70</span>   <span class="ruby-identifier">app</span>.<span class="ruby-identifier">plugin</span>(<span class="ruby-value">:public</span>, <span class="ruby-identifier">opts</span>)
<span class="line-num">71</span> <span class="ruby-keyword">end</span></pre>
</div>
</div>
</div>
</div>

</div>
</div>

<div id='footer-push'></div>
</div>
<div id='footer'>
<a href="https://github.com/jeremyevans/hanna-nouveau"><strong>Hanna Nouveau</strong> RDoc template</a>
</div>
</body>
</html>
