<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html lang='en'>
<head>
<title>Roda::RodaPlugins::Render</title>
<meta content='text/html; charset=UTF-8' http-equiv='Content-Type'>
<link href='../../../css/style.css' media='screen' rel='stylesheet' type='text/css'>
<script type='text/javascript'>
  function popupCode(url) {
    window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
  }
  
  function toggleCode(id) {
    var code = document.getElementById(id)
  
    code.style.display = code.style.display != 'block' ? 'block' : 'none'
    return true
  }
  
  // Make codeblocks hidden by default
  document.writeln('<' + 'style type="text/css">.method .source pre { display: none }<\/style>')
</script>
</head>
<body class='page'>
<div class='class' id='wrapper'>
<div class='header'>
<h1 class='name'><span class='type'>module</span>
Roda::RodaPlugins::Render
</h1>
<ol class='paths'>
<li>
<a href="../../../files/lib/roda/plugins/render_rb.html">lib/roda/plugins/render.rb</a>
</li>
<li class='other'>
<a href="../../../files/lib/roda/plugins/render_each_rb.html">lib/roda/plugins/render_each.rb</a>
</li>
<li class='other'>
<a href="../../../files/lib/roda/plugins/render_locals_rb.html">lib/roda/plugins/render_locals.rb</a>
</li>
<li class='other'>
<a href="../../../files/lib/roda/plugins/view_options_rb.html">lib/roda/plugins/view_options.rb</a>
</li>
<li>
<a class='show' href='#' onclick='this.parentNode.parentNode.className += &quot; expanded&quot;; this.parentNode.removeChild(this); return false'>show all</a>
</li>
</ol>
</div>
<div id='content'>
<div id='text'>
<div id='description'>
<p>The render plugin adds support for template rendering using the tilt library.  Two methods are provided for template rendering, <code>view</code> (which uses the layout) and <code>render</code> (which does not).</p>

<pre class="ruby"><span class="ruby-identifier">plugin</span> <span class="ruby-value">:render</span>&#x000A;&#x000A;<span class="ruby-identifier">route</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">r</span><span class="ruby-operator">|</span>&#x000A;  <span class="ruby-identifier">r</span>.<span class="ruby-identifier">is</span> <span class="ruby-string">&#39;foo&#39;</span> <span class="ruby-keyword">do</span>&#x000A;    <span class="ruby-identifier">view</span>(<span class="ruby-string">&#39;foo&#39;</span>) <span class="ruby-comment"># renders views/foo.erb inside views/layout.erb</span>&#x000A;  <span class="ruby-keyword">end</span>&#x000A;&#x000A;  <span class="ruby-identifier">r</span>.<span class="ruby-identifier">is</span> <span class="ruby-string">&#39;bar&#39;</span> <span class="ruby-keyword">do</span>&#x000A;    <span class="ruby-identifier">render</span>(<span class="ruby-string">&#39;bar&#39;</span>) <span class="ruby-comment"># renders views/bar.erb</span>&#x000A;  <span class="ruby-keyword">end</span>&#x000A;<span class="ruby-keyword">end</span></pre>

<p>The <code>render</code> and <code>view</code> methods just return strings, they do not have side effects (unless the templates themselves have side effects). As <a href="../../Roda.html"><code>Roda</code></a> uses the routing block return value as the body of the response, in most cases you will call these methods as the last expression in a routing block to have the response body be the result of the template rendering.</p>

<p>Because <code>render</code> and <code>view</code> just return strings, you can call them inside templates (i.e. for subtemplates/partials), or multiple times in the same route and combine the results together:</p>

<pre class="ruby"><span class="ruby-identifier">route</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">r</span><span class="ruby-operator">|</span>&#x000A;  <span class="ruby-identifier">r</span>.<span class="ruby-identifier">is</span> <span class="ruby-string">&#39;foo-bars&#39;</span> <span class="ruby-keyword">do</span>&#x000A;    <span class="ruby-ivar">@bars</span> = <span class="ruby-constant">Bar</span>.<span class="ruby-identifier">where</span>(<span class="ruby-value">:foo</span>).<span class="ruby-identifier">map</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">b</span><span class="ruby-operator">|</span> <span class="ruby-identifier">render</span>(<span class="ruby-value">:bar</span>, <span class="ruby-value">locals:</span> {<span class="ruby-value">bar:</span> <span class="ruby-identifier">b</span>})}.<span class="ruby-identifier">join</span>&#x000A;    <span class="ruby-identifier">view</span>(<span class="ruby-string">&#39;foo&#39;</span>)&#x000A;  <span class="ruby-keyword">end</span>&#x000A;<span class="ruby-keyword">end</span></pre>

<p>You can provide options to the plugin method:</p>

<pre class="ruby"><span class="ruby-identifier">plugin</span> <span class="ruby-value">:render</span>, <span class="ruby-value">engine:</span> <span class="ruby-string">&#39;haml&#39;</span>, <span class="ruby-value">views:</span> <span class="ruby-string">&#39;admin_views&#39;</span></pre>

<h1 id="module-Roda::RodaPlugins::Render-label-Plugin+Options">Plugin Options<span><a href="#module-Roda::RodaPlugins::Render-label-Plugin+Options">&para;</a> <a href="#top">&uarr;</a></span></h1>

<p>The following plugin options are supported:</p>
<table class="rdoc-list note-list"><tbody><tr><td class='label'>:allowed_paths </td><td>
<p>Set the template paths to allow.  Attempts to render paths outside of this directory will raise an error.  Defaults to the <code>:views</code> directory.</p>
</td></tr><tr><td class='label'>:cache </td><td>
<p>nil/false to explicitly disable premanent template caching.  By default, permanent template caching is disabled by default if RACK_ENV is development.  When permanent template caching is disabled, for templates with paths in the file system, the modification time of the file will be checked on every render, and if it has changed, a new template will be created for the current content of the file.</p>
</td></tr><tr><td class='label'>:cache_class </td><td>
<p>A class to use as the template cache instead of the default.</p>
</td></tr><tr><td class='label'>:check_paths </td><td>
<p>Can be set to false to turn off template path checking.</p>
</td></tr><tr><td class='label'>:engine </td><td>
<p>The tilt engine to use for rendering, also the default file extension for templates, defaults to &#39;erb&#39;.</p>
</td></tr><tr><td class='label'>:escape </td><td>
<p>Use Erubi as the ERB template engine, and enable escaping by default, which makes <code>&lt;%= %&gt;</code> escape output and  <code>&lt;%== %&gt;</code> not escape output. If given, sets the <code>:escape=&gt;true</code> option for all template engines, which can break some non-ERB template engines.  You can use a string or array of strings as the value for this option to only set the <code>:escape=&gt;true</code> option for those specific template engines.</p>
</td></tr><tr><td class='label'>:layout </td><td>
<p>The base name of the layout file, defaults to &#39;layout&#39;.  This can be provided as a hash with the :template or :inline options.</p>
</td></tr><tr><td class='label'>:layout_opts </td><td>
<p>The options to use when rendering the layout, if different from the default options.</p>
</td></tr><tr><td class='label'>:template_opts </td><td>
<p>The tilt options used when rendering all templates. defaults to: <code>{outvar: &#39;@_out_buf&#39;, default_encoding: Encoding.default_external}</code>.</p>
</td></tr><tr><td class='label'>:engine_opts </td><td>
<p>The tilt options to use per template engine.  Keys are engine strings, values are hashes of template options.</p>
</td></tr><tr><td class='label'>:views </td><td>
<p>The directory holding the view files, defaults to the &#39;views&#39; subdirectory of the application&#39;s :root option (the process&#39;s working directory by default).</p>
</td></tr></tbody></table>

<h1 id="module-Roda::RodaPlugins::Render-label-Render-2FView+Method+Options">Render/View Method Options<span><a href="#module-Roda::RodaPlugins::Render-label-Render-2FView+Method+Options">&para;</a> <a href="#top">&uarr;</a></span></h1>

<p>Most of these options can be overridden at runtime by passing options to the <code>view</code> or <code>render</code> methods:</p>

<pre class="ruby"><span class="ruby-identifier">view</span>(<span class="ruby-string">&#39;foo&#39;</span>, <span class="ruby-value">engine:</span> <span class="ruby-string">&#39;html.erb&#39;</span>)&#x000A;<span class="ruby-identifier">render</span>(<span class="ruby-string">&#39;foo&#39;</span>, <span class="ruby-value">views:</span> <span class="ruby-string">&#39;admin_views&#39;</span>)</pre>

<p>There are additional options to <code>view</code> and <code>render</code> that are available at runtime:</p>
<table class="rdoc-list note-list"><tbody><tr><td class='label'>:cache </td><td>
<p>Set to false to not cache this template, even when caching is on by default.  Set to true to force caching for this template, even when the default is to not permantently cache (e.g. when using the :template_block option).</p>
</td></tr><tr><td class='label'>:cache_key </td><td>
<p>Explicitly set the hash key to use when caching.</p>
</td></tr><tr><td class='label'>:content </td><td>
<p>Only respected by <code>view</code>, provides the content to render inside the layout, instead of rendering a template to get the content.</p>
</td></tr><tr><td class='label'>:inline </td><td>
<p>Use the value given as the template code, instead of looking for template code in a file.</p>
</td></tr><tr><td class='label'>:locals </td><td>
<p>Hash of local variables to make available inside the template.</p>
</td></tr><tr><td class='label'>:path </td><td>
<p>Use the value given as the full pathname for the file, instead of using the :views and :engine option in combination with the template name.</p>
</td></tr><tr><td class='label'>:scope </td><td>
<p>The object in which context to evaluate the template.  By default, this is the <a href="../../Roda.html"><code>Roda</code></a> instance.</p>
</td></tr><tr><td class='label'>:template </td><td>
<p>Provides the name of the template to use.  This allows you pass a single options hash to the render/view method, while still allowing you to specify the template name.</p>
</td></tr><tr><td class='label'>:template_block </td><td>
<p><a href="Pass.html"><code>Pass</code></a> this block when creating the underlying template, ignored when using :inline.  Disables caching of the template by default.</p>
</td></tr><tr><td class='label'>:template_class </td><td>
<p>Provides the template class to use, inside of using Tilt or <code>Tilt[:engine]</code>.</p>
</td></tr></tbody></table>

<p>Here&#39;s an example of using these options:</p>

<pre class="ruby"><span class="ruby-identifier">view</span>(<span class="ruby-value">inline:</span> <span class="ruby-string">&#39;&lt;%= @foo %&gt;&#39;</span>)&#x000A;<span class="ruby-identifier">render</span>(<span class="ruby-value">path:</span> <span class="ruby-string">&#39;/path/to/template.erb&#39;</span>)</pre>

<p>If you pass a hash as the first argument to <code>view</code> or <code>render</code>, it should have either <code>:template</code>, <code>:inline</code>, <code>:path</code>, or <code>:content</code> (for <code>view</code>) as one of the keys.</p>

<h1 id="module-Roda::RodaPlugins::Render-label-Speeding+Up+Template+Rendering">Speeding Up Template Rendering<span><a href="#module-Roda::RodaPlugins::Render-label-Speeding+Up+Template+Rendering">&para;</a> <a href="#top">&uarr;</a></span></h1>

<p>The render/view method calls are optimized for usage with a single symbol/string argument specifying the template name.  So for fastest rendering, pass only a symbol/string to render/view.  Next best optimized are template calls with a single :locals option.  Use of other options disables the compiled template method optimizations and can be significantly slower.</p>

<p>If you must pass a hash to render/view, either as a second argument or as the only argument, you can speed things up by specifying a <code>:cache_key</code> option in the hash, making sure the <code>:cache_key</code> is unique to the template you are rendering.</p>
</div>
<div id='method-list'>
<h2>Methods</h2>
<h3>Public Class</h3>
<ol>
<li><a href="#method-c-configure">configure</a></li>
<li><a href="#method-c-tilt_template_compiled_method">tilt_template_compiled_method</a></li>
</ol>
</div>
<div id='context'>
</div>
<div id='class-list'>
<h2>Classes and Modules</h2>
<ol>
<li><a href="Render/ClassMethods.html">Roda::RodaPlugins::Render::ClassMethods</a></li>
<li><a href="Render/InstanceMethods.html">Roda::RodaPlugins::Render::InstanceMethods</a></li>
<li><a href="Render/TemplateMtimeWrapper.html">Roda::RodaPlugins::Render::TemplateMtimeWrapper</a></li>
</ol>
</div>
<div id='section'>
<div id='constants-list'>
<h2>Constants</h2>
<div class='name-list'>
<table summary='Constants'>
<tr class='top-aligned-row context-row'>
<td class='context-item-name'>COMPILED_METHOD_SUPPORT</td>
<td>=</td>
<td class='context-item-value'>RUBY_VERSION >= '2.3' && tilt_compiled_method_support</td>
<td>&nbsp;</td>
<td class='context-item-desc'></td>
</tr>
<tr class='top-aligned-row context-row'>
<td class='context-item-name'>NO_CACHE</td>
<td>=</td>
<td class='context-item-value'>{:cache=>false}.freeze</td>
<td>&nbsp;</td>
<td class='context-item-desc'></td>
</tr>
</table>
</div>
</div>
<div id='methods'>
<h2>Public Class methods</h2>
<div class='method public-class' id='method-method-c-configure'>
<a name='method-c-configure'></a>
<div class='synopsis'>
<span class='name'>configure</span>
<span class='arguments'>(app, opts=OPTS)</span>

</div>
<div class='description'>

<p>Setup default rendering options.  See <a href="Render.html"><code>Render</code></a> for details.</p>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-c-configure-source&#39;); return false'>
[show source]
</a>
<pre id='method-c-configure-source'>    <span class="ruby-comment"># File lib/roda/plugins/render.rb</span>&#x000A;<span class="line-num">152</span> <span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier ruby-title">configure</span>(<span class="ruby-identifier">app</span>, <span class="ruby-identifier">opts</span>=<span class="ruby-constant">OPTS</span>)&#x000A;<span class="line-num">153</span>   <span class="ruby-keyword">if</span> <span class="ruby-identifier">app</span>.<span class="ruby-identifier">opts</span>[<span class="ruby-value">:render</span>]&#x000A;<span class="line-num">154</span>     <span class="ruby-identifier">orig_cache</span> = <span class="ruby-identifier">app</span>.<span class="ruby-identifier">opts</span>[<span class="ruby-value">:render</span>][<span class="ruby-value">:cache</span>]&#x000A;<span class="line-num">155</span>     <span class="ruby-identifier">orig_method_cache</span> = <span class="ruby-identifier">app</span>.<span class="ruby-identifier">opts</span>[<span class="ruby-value">:render</span>][<span class="ruby-value">:template_method_cache</span>]&#x000A;<span class="line-num">156</span>     <span class="ruby-identifier">opts</span> = <span class="ruby-identifier">app</span>.<span class="ruby-identifier">opts</span>[<span class="ruby-value">:render</span>][<span class="ruby-value">:orig_opts</span>].<span class="ruby-identifier">merge</span>(<span class="ruby-identifier">opts</span>)&#x000A;<span class="line-num">157</span>   <span class="ruby-keyword">end</span>&#x000A;<span class="line-num">158</span>   <span class="ruby-identifier">app</span>.<span class="ruby-identifier">opts</span>[<span class="ruby-value">:render</span>] = <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">dup</span>&#x000A;<span class="line-num">159</span>   <span class="ruby-identifier">app</span>.<span class="ruby-identifier">opts</span>[<span class="ruby-value">:render</span>][<span class="ruby-value">:orig_opts</span>] = <span class="ruby-identifier">opts</span>&#x000A;<span class="line-num">160</span> &#x000A;<span class="line-num">161</span>   <span class="ruby-identifier">opts</span> = <span class="ruby-identifier">app</span>.<span class="ruby-identifier">opts</span>[<span class="ruby-value">:render</span>]&#x000A;<span class="line-num">162</span>   <span class="ruby-identifier">opts</span>[<span class="ruby-value">:engine</span>] = (<span class="ruby-identifier">opts</span>[<span class="ruby-value">:engine</span>] <span class="ruby-operator">||</span> <span class="ruby-string">&quot;erb&quot;</span>).<span class="ruby-identifier">dup</span>.<span class="ruby-identifier">freeze</span>&#x000A;<span class="line-num">163</span>   <span class="ruby-identifier">opts</span>[<span class="ruby-value">:views</span>] = <span class="ruby-identifier">app</span>.<span class="ruby-identifier">expand_path</span>(<span class="ruby-identifier">opts</span>[<span class="ruby-value">:views</span>]<span class="ruby-operator">||</span><span class="ruby-string">&quot;views&quot;</span>).<span class="ruby-identifier">freeze</span>&#x000A;<span class="line-num">164</span>   <span class="ruby-identifier">opts</span>[<span class="ruby-value">:allowed_paths</span>] <span class="ruby-operator">||=</span> [<span class="ruby-identifier">opts</span>[<span class="ruby-value">:views</span>]].<span class="ruby-identifier">freeze</span>&#x000A;<span class="line-num">165</span>   <span class="ruby-identifier">opts</span>[<span class="ruby-value">:allowed_paths</span>] = <span class="ruby-identifier">opts</span>[<span class="ruby-value">:allowed_paths</span>].<span class="ruby-identifier">map</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">f</span><span class="ruby-operator">|</span> <span class="ruby-identifier">app</span>.<span class="ruby-identifier">expand_path</span>(<span class="ruby-identifier">f</span>, <span class="ruby-keyword">nil</span>)}.<span class="ruby-identifier">uniq</span>.<span class="ruby-identifier">freeze</span>&#x000A;<span class="line-num">166</span>   <span class="ruby-identifier">opts</span>[<span class="ruby-value">:check_paths</span>] = <span class="ruby-keyword">true</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">has_key?</span>(<span class="ruby-value">:check_paths</span>)&#x000A;<span class="line-num">167</span> &#x000A;<span class="line-num">168</span>   <span class="ruby-keyword">unless</span> <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">has_key?</span>(<span class="ruby-value">:check_template_mtime</span>)&#x000A;<span class="line-num">169</span>     <span class="ruby-identifier">opts</span>[<span class="ruby-value">:check_template_mtime</span>] = <span class="ruby-keyword">if</span> <span class="ruby-identifier">opts</span>[<span class="ruby-value">:cache</span>] <span class="ruby-operator">==</span> <span class="ruby-keyword">false</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">opts</span>[<span class="ruby-value">:explicit_cache</span>]&#x000A;<span class="line-num">170</span>       <span class="ruby-keyword">true</span>&#x000A;<span class="line-num">171</span>     <span class="ruby-keyword">else</span>&#x000A;<span class="line-num">172</span>       <span class="ruby-constant">ENV</span>[<span class="ruby-string">&#39;RACK_ENV&#39;</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&#39;development&#39;</span>&#x000A;<span class="line-num">173</span>     <span class="ruby-keyword">end</span>&#x000A;<span class="line-num">174</span>   <span class="ruby-keyword">end</span>&#x000A;<span class="line-num">175</span> &#x000A;<span class="line-num">176</span>   <span class="ruby-keyword">begin</span>&#x000A;<span class="line-num">177</span>     <span class="ruby-identifier">app</span>.<span class="ruby-identifier">const_get</span>(<span class="ruby-value">:RodaCompiledTemplates</span>, <span class="ruby-keyword">false</span>)&#x000A;<span class="line-num">178</span>   <span class="ruby-keyword">rescue</span> <span class="ruby-constant">NameError</span>&#x000A;<span class="line-num">179</span>     <span class="ruby-identifier">compiled_templates_module</span> = <span class="ruby-constant">Module</span>.<span class="ruby-identifier">new</span>&#x000A;<span class="line-num">180</span>     <span class="ruby-identifier">app</span>.<span class="ruby-identifier">send</span>(<span class="ruby-value">:include</span>, <span class="ruby-identifier">compiled_templates_module</span>)&#x000A;<span class="line-num">181</span>     <span class="ruby-identifier">app</span>.<span class="ruby-identifier">const_set</span>(<span class="ruby-value">:RodaCompiledTemplates</span>, <span class="ruby-identifier">compiled_templates_module</span>)&#x000A;<span class="line-num">182</span>   <span class="ruby-keyword">end</span>&#x000A;<span class="line-num">183</span>   <span class="ruby-identifier">opts</span>[<span class="ruby-value">:template_method_cache</span>] = <span class="ruby-identifier">orig_method_cache</span> <span class="ruby-operator">||</span> (<span class="ruby-identifier">opts</span>[<span class="ruby-value">:cache_class</span>] <span class="ruby-operator">||</span> <span class="ruby-constant">RodaCache</span>).<span class="ruby-identifier">new</span>&#x000A;<span class="line-num">184</span>   <span class="ruby-identifier">opts</span>[<span class="ruby-value">:cache</span>] = <span class="ruby-identifier">orig_cache</span> <span class="ruby-operator">||</span> (<span class="ruby-identifier">opts</span>[<span class="ruby-value">:cache_class</span>] <span class="ruby-operator">||</span> <span class="ruby-constant">RodaCache</span>).<span class="ruby-identifier">new</span>&#x000A;<span class="line-num">185</span> &#x000A;<span class="line-num">186</span>   <span class="ruby-identifier">opts</span>[<span class="ruby-value">:layout_opts</span>] = (<span class="ruby-identifier">opts</span>[<span class="ruby-value">:layout_opts</span>] <span class="ruby-operator">||</span> {}).<span class="ruby-identifier">dup</span>&#x000A;<span class="line-num">187</span>   <span class="ruby-identifier">opts</span>[<span class="ruby-value">:layout_opts</span>][<span class="ruby-value">:_is_layout</span>] = <span class="ruby-keyword">true</span>&#x000A;<span class="line-num">188</span>   <span class="ruby-keyword">if</span> <span class="ruby-identifier">opts</span>[<span class="ruby-value">:layout_opts</span>][<span class="ruby-value">:views</span>]&#x000A;<span class="line-num">189</span>     <span class="ruby-identifier">opts</span>[<span class="ruby-value">:layout_opts</span>][<span class="ruby-value">:views</span>] = <span class="ruby-identifier">app</span>.<span class="ruby-identifier">expand_path</span>(<span class="ruby-identifier">opts</span>[<span class="ruby-value">:layout_opts</span>][<span class="ruby-value">:views</span>]).<span class="ruby-identifier">freeze</span>&#x000A;<span class="line-num">190</span>   <span class="ruby-keyword">end</span>&#x000A;<span class="line-num">191</span> &#x000A;<span class="line-num">192</span>   <span class="ruby-keyword">if</span> <span class="ruby-identifier">layout</span> = <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">fetch</span>(<span class="ruby-value">:layout</span>, <span class="ruby-keyword">true</span>)&#x000A;<span class="line-num">193</span>     <span class="ruby-identifier">opts</span>[<span class="ruby-value">:layout</span>] = <span class="ruby-keyword">true</span>&#x000A;<span class="line-num">194</span> &#x000A;<span class="line-num">195</span>     <span class="ruby-keyword">case</span> <span class="ruby-identifier">layout</span>&#x000A;<span class="line-num">196</span>     <span class="ruby-keyword">when</span> <span class="ruby-constant">Hash</span>&#x000A;<span class="line-num">197</span>       <span class="ruby-identifier">opts</span>[<span class="ruby-value">:layout_opts</span>].<span class="ruby-identifier">merge!</span>(<span class="ruby-identifier">layout</span>)&#x000A;<span class="line-num">198</span>     <span class="ruby-keyword">when</span> <span class="ruby-keyword">true</span>&#x000A;<span class="line-num">199</span>       <span class="ruby-identifier">opts</span>[<span class="ruby-value">:layout_opts</span>][<span class="ruby-value">:template</span>] <span class="ruby-operator">||=</span> <span class="ruby-string">&#39;layout&#39;</span>&#x000A;<span class="line-num">200</span>     <span class="ruby-keyword">else</span>&#x000A;<span class="line-num">201</span>       <span class="ruby-identifier">opts</span>[<span class="ruby-value">:layout_opts</span>][<span class="ruby-value">:template</span>] = <span class="ruby-identifier">layout</span>&#x000A;<span class="line-num">202</span>     <span class="ruby-keyword">end</span>&#x000A;<span class="line-num">203</span> &#x000A;<span class="line-num">204</span>     <span class="ruby-identifier">opts</span>[<span class="ruby-value">:optimize_layout</span>] = (<span class="ruby-identifier">opts</span>[<span class="ruby-value">:layout_opts</span>][<span class="ruby-value">:template</span>] <span class="ruby-keyword">if</span> <span class="ruby-identifier">opts</span>[<span class="ruby-value">:layout_opts</span>].<span class="ruby-identifier">keys</span>.<span class="ruby-identifier">sort</span> <span class="ruby-operator">==</span> [<span class="ruby-value">:_is_layout</span>, <span class="ruby-value">:template</span>])&#x000A;<span class="line-num">205</span>   <span class="ruby-keyword">end</span>&#x000A;<span class="line-num">206</span>   <span class="ruby-identifier">opts</span>[<span class="ruby-value">:layout_opts</span>].<span class="ruby-identifier">freeze</span>&#x000A;<span class="line-num">207</span> &#x000A;<span class="line-num">208</span>   <span class="ruby-identifier">template_opts</span> = <span class="ruby-identifier">opts</span>[<span class="ruby-value">:template_opts</span>] = (<span class="ruby-identifier">opts</span>[<span class="ruby-value">:template_opts</span>] <span class="ruby-operator">||</span> {}).<span class="ruby-identifier">dup</span>&#x000A;<span class="line-num">209</span>   <span class="ruby-identifier">template_opts</span>[<span class="ruby-value">:outvar</span>] <span class="ruby-operator">||=</span> <span class="ruby-string">&#39;@_out_buf&#39;</span>&#x000A;<span class="line-num">210</span>   <span class="ruby-keyword">unless</span> <span class="ruby-identifier">template_opts</span>.<span class="ruby-identifier">has_key?</span>(<span class="ruby-value">:default_encoding</span>)&#x000A;<span class="line-num">211</span>     <span class="ruby-identifier">template_opts</span>[<span class="ruby-value">:default_encoding</span>] = <span class="ruby-constant">Encoding</span>.<span class="ruby-identifier">default_external</span>&#x000A;<span class="line-num">212</span>   <span class="ruby-keyword">end</span>&#x000A;<span class="line-num">213</span> &#x000A;<span class="line-num">214</span>   <span class="ruby-identifier">engine_opts</span> = <span class="ruby-identifier">opts</span>[<span class="ruby-value">:engine_opts</span>] = (<span class="ruby-identifier">opts</span>[<span class="ruby-value">:engine_opts</span>] <span class="ruby-operator">||</span> {}).<span class="ruby-identifier">dup</span>&#x000A;<span class="line-num">215</span>   <span class="ruby-identifier">engine_opts</span>.<span class="ruby-identifier">to_a</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">k</span>,<span class="ruby-identifier">v</span><span class="ruby-operator">|</span>&#x000A;<span class="line-num">216</span>     <span class="ruby-identifier">engine_opts</span>[<span class="ruby-identifier">k</span>] = <span class="ruby-identifier">v</span>.<span class="ruby-identifier">dup</span>.<span class="ruby-identifier">freeze</span>&#x000A;<span class="line-num">217</span>   <span class="ruby-keyword">end</span>&#x000A;<span class="line-num">218</span> &#x000A;<span class="line-num">219</span>   <span class="ruby-keyword">if</span> <span class="ruby-identifier">escape</span> = <span class="ruby-identifier">opts</span>[<span class="ruby-value">:escape</span>]&#x000A;<span class="line-num">220</span>     <span class="ruby-identifier">require</span> <span class="ruby-string">&#39;tilt/erubi&#39;</span>&#x000A;<span class="line-num">221</span> &#x000A;<span class="line-num">222</span>     <span class="ruby-keyword">case</span> <span class="ruby-identifier">escape</span>&#x000A;<span class="line-num">223</span>     <span class="ruby-keyword">when</span> <span class="ruby-constant">String</span>, <span class="ruby-constant">Array</span>&#x000A;<span class="line-num">224</span>       <span class="ruby-constant">Array</span>(<span class="ruby-identifier">escape</span>).<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">engine</span><span class="ruby-operator">|</span>&#x000A;<span class="line-num">225</span>         <span class="ruby-identifier">engine_opts</span>[<span class="ruby-identifier">engine</span>] = (<span class="ruby-identifier">engine_opts</span>[<span class="ruby-identifier">engine</span>] <span class="ruby-operator">||</span> {}).<span class="ruby-identifier">merge</span>(<span class="ruby-value">:escape</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-keyword">true</span>).<span class="ruby-identifier">freeze</span>&#x000A;<span class="line-num">226</span>       <span class="ruby-keyword">end</span>&#x000A;<span class="line-num">227</span>     <span class="ruby-keyword">else</span>&#x000A;<span class="line-num">228</span>       <span class="ruby-identifier">template_opts</span>[<span class="ruby-value">:escape</span>] = <span class="ruby-keyword">true</span>&#x000A;<span class="line-num">229</span>     <span class="ruby-keyword">end</span>&#x000A;<span class="line-num">230</span>   <span class="ruby-keyword">end</span>&#x000A;<span class="line-num">231</span> &#x000A;<span class="line-num">232</span>   <span class="ruby-identifier">template_opts</span>.<span class="ruby-identifier">freeze</span>&#x000A;<span class="line-num">233</span>   <span class="ruby-identifier">engine_opts</span>.<span class="ruby-identifier">freeze</span>&#x000A;<span class="line-num">234</span>   <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">freeze</span>&#x000A;<span class="line-num">235</span> <span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method public-class' id='method-method-c-tilt_template_compiled_method'>
<a name='method-c-tilt_template_compiled_method'></a>
<div class='synopsis'>
<span class='name'>tilt_template_compiled_method</span>
<span class='arguments'>(template, locals_keys, scope_class)</span>

</div>
<div class='description'>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-c-tilt_template_compiled_method-source&#39;); return false'>
[show source]
</a>
<pre id='method-c-tilt_template_compiled_method-source'>    <span class="ruby-comment"># File lib/roda/plugins/render.rb</span>&#x000A;<span class="line-num">142</span> <span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier ruby-title">tilt_template_compiled_method</span>(<span class="ruby-identifier">template</span>, <span class="ruby-identifier">locals_keys</span>, <span class="ruby-identifier">scope_class</span>)&#x000A;<span class="line-num">143</span>   <span class="ruby-identifier">template</span>.<span class="ruby-identifier">send</span>(<span class="ruby-value">:compiled_method</span>, <span class="ruby-identifier">locals_keys</span>, <span class="ruby-identifier">scope_class</span>)&#x000A;<span class="line-num">144</span> <span class="ruby-keyword">end</span></pre>
</div>
</div>
</div>
</div>

</div>
</div>

<div id='footer-push'></div>
</div>
<div id='footer'>
<a href="https://github.com/rdoc/hanna-nouveau"><strong>Hanna Nouveau</strong> RDoc template</a>
</div>
</body>
</html>
