<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html lang='en'>
  <head>
    <title>Roda::RodaPlugins::Render</title>
    <meta content='text/html; charset=UTF-8' http-equiv='Content-Type'>
    <link href='../../../css/style.css' media='screen' rel='stylesheet' type='text/css'>
    <script type='text/javascript'>
      //<![CDATA[
        function popupCode(url) {
          window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
        }
        
        function toggleCode(id) {
          var code = document.getElementById(id)
        
          code.style.display = code.style.display != 'block' ? 'block' : 'none'
          return true
        }
        
        // Make codeblocks hidden by default
        document.writeln('<' + 'style type="text/css">.method .source pre { display: none }<\/style>')
      //]]>
    </script>
  </head>
  <body class='page'>
    <div class='class' id='wrapper'>
      <div class='header'>
        <h1 class='name'>
          <span class='type'>module</span>
          Roda::RodaPlugins::Render
        </h1>
        <ol class='paths'>
          <li>
            <a target="docwin" href="../../../files/lib/roda/plugins/render_rb.html">lib/roda/plugins/render.rb</a>
          </li>
        </ol>
      </div>
      <div id='content'>
        <div id='text'>
          <div id='description'>
            
            <p>The render plugin adds support for template rendering using the tilt
            library.  Two methods are provided for template rendering,
            <code>view</code> (which uses the layout) and <code>render</code> (which
            does not).</p>
            
            <pre class="ruby"><span class="ruby-identifier">plugin</span> :<span class="ruby-identifier">render</span>&#x000A;&#x000A;<span class="ruby-identifier">route</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">r</span><span class="ruby-operator">|</span>&#x000A;  <span class="ruby-identifier">r</span>.<span class="ruby-identifier">is</span> <span class="ruby-string">&#39;foo&#39;</span> <span class="ruby-keyword">do</span>&#x000A;    <span class="ruby-identifier">view</span>(<span class="ruby-string">&#39;foo&#39;</span>) <span class="ruby-comment"># renders views/foo.erb inside views/layout.erb</span>&#x000A;  <span class="ruby-keyword">end</span>&#x000A;&#x000A;  <span class="ruby-identifier">r</span>.<span class="ruby-identifier">is</span> <span class="ruby-string">&#39;bar&#39;</span> <span class="ruby-keyword">do</span>&#x000A;    <span class="ruby-identifier">render</span>(<span class="ruby-string">&#39;bar&#39;</span>) <span class="ruby-comment"># renders views/bar.erb</span>&#x000A;  <span class="ruby-keyword">end</span>&#x000A;<span class="ruby-keyword">end</span></pre>
            
            <p>You can provide options to the plugin method:</p>
            
            <pre class="ruby"><span class="ruby-identifier">plugin</span> :<span class="ruby-identifier">render</span>, :<span class="ruby-identifier">engine=</span><span class="ruby-operator">&gt;</span><span class="ruby-string">&#39;haml&#39;</span>, :<span class="ruby-identifier">views=</span><span class="ruby-operator">&gt;</span><span class="ruby-string">&#39;admin_views&#39;</span></pre>
            
            <h1 id="module-Roda::RodaPlugins::Render-label-Plugin+Options">Plugin Options<span><a href="#module-Roda::RodaPlugins::Render-label-Plugin+Options">&para;</a> <a href="#top">&uarr;</a></span></h1>
            
            <p>The following plugin options are supported:</p>
            <table class="rdoc-list note-list"><tbody><tr><td class='label'>:cache </td><td>
            <p>nil/false to not cache templates (useful for development), defaults to true
            unless RACK_ENV is development to automatically use the default template
            cache.</p>
            </td></tr><tr><td class='label'>:cache_class </td><td>
            <p>A class to use as the template cache instead of the default.</p>
            </td></tr><tr><td class='label'>:engine </td><td>
            <p>The tilt engine to use for rendering, also the default file extension for
            templates, defaults to &#39;erb&#39;.</p>
            </td></tr><tr><td class='label'>:escape </td><td>
            <p>Use Roda&#39;s Erubis escaping support, which makes <code>&lt;%=&#x000A;%&gt;</code> escape output, <code>&lt;%== %&gt;</code> not escape output,
            and handles postfix conditions inside <code>&lt;%= %&gt;</code> tags.</p>
            </td></tr><tr><td class='label'>:escape_safe_classes </td><td>
            <p>String subclasses that should not be HTML escaped when used in <code>&lt;%=&#x000A;%&gt;</code> tags, when :escape is used. Can be an array for multiple
            classes.</p>
            </td></tr><tr><td class='label'>:escaper </td><td>
            <p>Object used for escaping output of <code>&lt;%= %&gt;</code>, when :escape
            is used, overriding the default.  If given, object should respond to
            <code>escape_xml</code> with a single argument and return an output string.</p>
            </td></tr><tr><td class='label'>:layout </td><td>
            <p>The base name of the layout file, defaults to &#39;layout&#39;.</p>
            </td></tr><tr><td class='label'>:layout_opts </td><td>
            <p>The options to use when rendering the layout, if different from the default
            options.</p>
            </td></tr><tr><td class='label'>:template_opts </td><td>
            <p>The tilt options used when rendering all templates. defaults to:
            <code>{:outvar=&gt;&#39;@_out_buf&#39;,&#x000A;:default_encoding=&gt;Encoding.default_external}</code>.</p>
            </td></tr><tr><td class='label'>:engine_opts </td><td>
            <p>The tilt options to use per template engine.  Keys are engine strings,
            values are hashes of template options.</p>
            </td></tr><tr><td class='label'>:views </td><td>
            <p>The directory holding the view files, defaults to the &#39;views&#39;
            subdirectory of the application&#39;s :root option (the process&#39;s
            working directory by default).</p>
            </td></tr></tbody></table>
            
            <h1 id="module-Roda::RodaPlugins::Render-label-Render-2FView+Method+Options">Render/View Method Options<span><a href="#module-Roda::RodaPlugins::Render-label-Render-2FView+Method+Options">&para;</a> <a href="#top">&uarr;</a></span></h1>
            
            <p>Most of these options can be overridden at runtime by passing options to
            the <code>view</code> or <code>render</code> methods:</p>
            
            <pre class="ruby"><span class="ruby-identifier">view</span>(<span class="ruby-string">&#39;foo&#39;</span>, :<span class="ruby-identifier">engine=</span><span class="ruby-operator">&gt;</span><span class="ruby-string">&#39;html.erb&#39;</span>)&#x000A;<span class="ruby-identifier">render</span>(<span class="ruby-string">&#39;foo&#39;</span>, :<span class="ruby-identifier">views=</span><span class="ruby-operator">&gt;</span><span class="ruby-string">&#39;admin_views&#39;</span>)</pre>
            
            <p>There are additional options to <code>view</code> and <code>render</code>
            that are available at runtime:</p>
            <table class="rdoc-list note-list"><tbody><tr><td class='label'>:cache </td><td>
            <p>Set to false to not cache this template, even when caching is on by
            default.  Set to true to force caching for this template, even when the
            default is to not cache (e.g. when using the :template_block option).</p>
            </td></tr><tr><td class='label'>:cache_key </td><td>
            <p>Explicitly set the hash key to use when caching.</p>
            </td></tr><tr><td class='label'>:content </td><td>
            <p>Only respected by <code>view</code>, provides the content to render inside
            the layout, instead of rendering a template to get the content.</p>
            </td></tr><tr><td class='label'>:inline </td><td>
            <p>Use the value given as the template code, instead of looking for template
            code in a file.</p>
            </td></tr><tr><td class='label'>:locals </td><td>
            <p>Hash of local variables to make available inside the template.</p>
            </td></tr><tr><td class='label'>:path </td><td>
            <p>Use the value given as the full pathname for the file, instead of using the
            :views and :engine option in combination with the template name.</p>
            </td></tr><tr><td class='label'>:scope </td><td>
            <p>The object in which context to evaluate the template.  By default, this is
            the <a href="../../Roda.html">Roda</a> instance.</p>
            </td></tr><tr><td class='label'>:template </td><td>
            <p>Provides the name of the template to use.  This allows you pass a single
            options hash to the render/view method, while still allowing you to specify
            the template name.</p>
            </td></tr><tr><td class='label'>:template_block </td><td>
            <p><a href="Pass.html">Pass</a> this block when creating the underlying
            template, ignored when using :inline.  Disables caching of the template by
            default.</p>
            </td></tr><tr><td class='label'>:template_class </td><td>
            <p>Provides the template class to use, inside of using Tilt or
            <code>Tilt[:engine]</code>.</p>
            </td></tr></tbody></table>
            
            <p>Here&#39;s how those options are used:</p>
            
            <pre class="ruby"><span class="ruby-identifier">view</span>(:<span class="ruby-identifier">inline=</span><span class="ruby-operator">&gt;</span><span class="ruby-string">&#39;&lt;%= @foo %&gt;&#39;</span>)&#x000A;<span class="ruby-identifier">render</span>(:<span class="ruby-identifier">path=</span><span class="ruby-operator">&gt;</span><span class="ruby-string">&#39;/path/to/template.erb&#39;</span>)</pre>
            
            <p>If you pass a hash as the first argument to <code>view</code> or
            <code>render</code>, it should have either <code>:template</code>,
            <code>:inline</code>, <code>:path</code>, or <code>:content</code> (for
            <code>view</code>) as one of the keys.</p>
            
            <h1 id="module-Roda::RodaPlugins::Render-label-Speeding+Up+Template+Rendering">Speeding Up Template Rendering<span><a href="#module-Roda::RodaPlugins::Render-label-Speeding+Up+Template+Rendering">&para;</a> <a href="#top">&uarr;</a></span></h1>
            
            <p>By default, determining the cache key to use for the template can be a lot
            of work.  If you specify the <code>:cache_key</code> option, you can save
            <a href="../../Roda.html">Roda</a> from having to do that work, which will
            make your application faster.  However, if you do this, you need to make
            sure you choose a correct key.</p>
            
            <p>If your application uses a unique template per path, in that the same path
            never uses more than one template, you can use the
            <code>view_options</code> plugin and do:</p>
            
            <pre class="ruby"><span class="ruby-identifier">set_view_options</span> :<span class="ruby-identifier">cache_key=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">r</span>.<span class="ruby-identifier">path_info</span></pre>
            
            <p>at the top of your route block.  You can even do this if you do have paths
            that use more than one template, as long as you specify
            <code>:cache_key</code> specifically when rendering in those paths.</p>
            
            <p>If you use a single layout in your application, you can also make layout
            rendering faster by specifying <code>:cache_key</code> inside the
            <code>:layout_opts</code> plugin option.</p>
          </div>
          <div id='method-list'>
            <h2>Methods</h2>
            <h3>Public Class</h3>
            <ol>
              <li><a target="docwin" href="#method-c-configure">configure</a></li>
              <li><a target="docwin" href="#method-c-load_dependencies">load_dependencies</a></li>
            </ol>
          </div>
          <div id='context'>
          </div>
          <div id='class-list'>
            <h2>Classes and Modules</h2>
            <ol>
              <li><a target="docwin" href="Render/ClassMethods.html">Roda::RodaPlugins::Render::ClassMethods</a></li>
              <li><a target="docwin" href="Render/InstanceMethods.html">Roda::RodaPlugins::Render::InstanceMethods</a></li>
            </ol>
          </div>
          <div id='section'>
            <div id='constants-list'>
              <h2>Constants</h2>
              <div class='name-list'>
                <table summary='Constants'>
                  <tr class='top-aligned-row context-row'>
                    <td class='context-item-name'>OPTS</td>
                    <td>=</td>
                    <td class='context-item-value'>{}.freeze</td>
                    <td>&nbsp;</td>
                    <td class='context-item-desc'></td>
                  </tr>
                </table>
              </div>
            </div>
            <div id='methods'>
              <h2>Public Class methods</h2>
              <div class='method public-class' id='method-method-c-configure'>
                <a name='method-c-configure'></a>
                <div class='synopsis'>
                  <span class='name'>configure</span>
                  <span class='arguments'>(app, opts=OPTS)</span>
                </div>
                <div class='description'>
                  
                  <p>Setup default rendering options.  See <a href="Render.html">Render</a> for
                  details.</p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('method-c-configure-source'); return false">
                    [show source]
                  </a>
                  <pre id='method-c-configure-source'><span class="ruby-comment"># File lib/roda/plugins/render.rb, line 130</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">configure</span>(<span class="ruby-identifier">app</span>, <span class="ruby-identifier">opts</span>=<span class="ruby-constant">OPTS</span>)&#x000A;  <span class="ruby-keyword">if</span> <span class="ruby-identifier">app</span>.<span class="ruby-identifier">opts</span>[<span class="ruby-value">:render</span>]&#x000A;    <span class="ruby-identifier">opts</span> = <span class="ruby-identifier">app</span>.<span class="ruby-identifier">opts</span>[<span class="ruby-value">:render</span>][<span class="ruby-value">:orig_opts</span>].<span class="ruby-identifier">merge</span>(<span class="ruby-identifier">opts</span>)&#x000A;  <span class="ruby-keyword">end</span>&#x000A;  <span class="ruby-identifier">app</span>.<span class="ruby-identifier">opts</span>[<span class="ruby-value">:render</span>] = <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">dup</span>&#x000A;  <span class="ruby-identifier">app</span>.<span class="ruby-identifier">opts</span>[<span class="ruby-value">:render</span>][<span class="ruby-value">:orig_opts</span>] = <span class="ruby-identifier">opts</span>&#x000A;&#x000A;  <span class="ruby-identifier">opts</span> = <span class="ruby-identifier">app</span>.<span class="ruby-identifier">opts</span>[<span class="ruby-value">:render</span>]&#x000A;  <span class="ruby-identifier">opts</span>[<span class="ruby-value">:engine</span>] = (<span class="ruby-identifier">opts</span>[<span class="ruby-value">:engine</span>] <span class="ruby-operator">||</span> <span class="ruby-identifier">opts</span>[<span class="ruby-value">:ext</span>] <span class="ruby-operator">||</span> <span class="ruby-string">&quot;erb&quot;</span>).<span class="ruby-identifier">dup</span>.<span class="ruby-identifier">freeze</span>&#x000A;  <span class="ruby-identifier">opts</span>[<span class="ruby-value">:views</span>] = <span class="ruby-constant">File</span>.<span class="ruby-identifier">expand_path</span>(<span class="ruby-identifier">opts</span>[<span class="ruby-value">:views</span>]<span class="ruby-operator">||</span><span class="ruby-string">&quot;views&quot;</span>, <span class="ruby-identifier">app</span>.<span class="ruby-identifier">opts</span>[<span class="ruby-value">:root</span>]).<span class="ruby-identifier">freeze</span>&#x000A;&#x000A;  <span class="ruby-keyword">if</span> <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">fetch</span>(<span class="ruby-value">:cache</span>, <span class="ruby-constant">ENV</span>[<span class="ruby-string">&#39;RACK_ENV&#39;</span>] <span class="ruby-operator">!=</span> <span class="ruby-string">&#39;development&#39;</span>)&#x000A;    <span class="ruby-keyword">if</span> <span class="ruby-identifier">cache_class</span> = <span class="ruby-identifier">opts</span>[<span class="ruby-value">:cache_class</span>]&#x000A;      <span class="ruby-identifier">opts</span>[<span class="ruby-value">:cache</span>] = <span class="ruby-identifier">cache_class</span>.<span class="ruby-identifier">new</span>&#x000A;    <span class="ruby-keyword">else</span>&#x000A;      <span class="ruby-identifier">opts</span>[<span class="ruby-value">:cache</span>] = <span class="ruby-identifier">app</span>.<span class="ruby-identifier">thread_safe_cache</span>&#x000A;    <span class="ruby-keyword">end</span>&#x000A;  <span class="ruby-keyword">end</span>&#x000A;&#x000A;  <span class="ruby-identifier">opts</span>[<span class="ruby-value">:layout_opts</span>] = (<span class="ruby-identifier">opts</span>[<span class="ruby-value">:layout_opts</span>] <span class="ruby-operator">||</span> {}).<span class="ruby-identifier">dup</span>&#x000A;  <span class="ruby-identifier">opts</span>[<span class="ruby-value">:layout_opts</span>][<span class="ruby-value">:_is_layout</span>] = <span class="ruby-keyword">true</span>&#x000A;  <span class="ruby-keyword">if</span> <span class="ruby-identifier">layout</span> = <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">fetch</span>(<span class="ruby-value">:layout</span>, <span class="ruby-keyword">true</span>)&#x000A;    <span class="ruby-identifier">opts</span>[<span class="ruby-value">:layout</span>] = <span class="ruby-keyword">true</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">has_key?</span>(<span class="ruby-value">:layout</span>)&#x000A;&#x000A;    <span class="ruby-keyword">case</span> <span class="ruby-identifier">layout</span>&#x000A;    <span class="ruby-keyword">when</span> <span class="ruby-constant">Hash</span>&#x000A;      <span class="ruby-identifier">opts</span>[<span class="ruby-value">:layout_opts</span>].<span class="ruby-identifier">merge!</span>(<span class="ruby-identifier">layout</span>)&#x000A;    <span class="ruby-keyword">when</span> <span class="ruby-keyword">true</span>&#x000A;      <span class="ruby-identifier">opts</span>[<span class="ruby-value">:layout_opts</span>][<span class="ruby-value">:template</span>] <span class="ruby-operator">||=</span> <span class="ruby-string">&#39;layout&#39;</span>&#x000A;    <span class="ruby-keyword">else</span>&#x000A;      <span class="ruby-identifier">opts</span>[<span class="ruby-value">:layout_opts</span>][<span class="ruby-value">:template</span>] = <span class="ruby-identifier">layout</span>&#x000A;    <span class="ruby-keyword">end</span>&#x000A;  <span class="ruby-keyword">end</span>&#x000A;  <span class="ruby-identifier">opts</span>[<span class="ruby-value">:layout_opts</span>].<span class="ruby-identifier">freeze</span>&#x000A;&#x000A;  <span class="ruby-identifier">template_opts</span> = <span class="ruby-identifier">opts</span>[<span class="ruby-value">:template_opts</span>] = (<span class="ruby-identifier">opts</span>[<span class="ruby-value">:template_opts</span>] <span class="ruby-operator">||</span> {}).<span class="ruby-identifier">dup</span>&#x000A;  <span class="ruby-identifier">template_opts</span>[<span class="ruby-value">:outvar</span>] <span class="ruby-operator">||=</span> <span class="ruby-string">&#39;@_out_buf&#39;</span>&#x000A;  <span class="ruby-keyword">if</span> <span class="ruby-constant">RUBY_VERSION</span> <span class="ruby-operator">&gt;=</span> <span class="ruby-string">&quot;1.9&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">template_opts</span>.<span class="ruby-identifier">has_key?</span>(<span class="ruby-value">:default_encoding</span>)&#x000A;    <span class="ruby-identifier">template_opts</span>[<span class="ruby-value">:default_encoding</span>] = <span class="ruby-constant">Encoding</span>.<span class="ruby-identifier">default_external</span>&#x000A;  <span class="ruby-keyword">end</span>&#x000A;  <span class="ruby-keyword">if</span> <span class="ruby-identifier">opts</span>[<span class="ruby-value">:escape</span>]&#x000A;    <span class="ruby-identifier">template_opts</span>[<span class="ruby-value">:engine_class</span>] = <span class="ruby-constant">ErubisEscaping</span><span class="ruby-operator">::</span><span class="ruby-constant">Eruby</span>&#x000A;&#x000A;    <span class="ruby-identifier">opts</span>[<span class="ruby-value">:escaper</span>] <span class="ruby-operator">||=</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">opts</span>[<span class="ruby-value">:escape_safe_classes</span>]&#x000A;      <span class="ruby-constant">ErubisEscaping</span><span class="ruby-operator">::</span><span class="ruby-constant">UnsafeClassEscaper</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">opts</span>[<span class="ruby-value">:escape_safe_classes</span>])&#x000A;    <span class="ruby-keyword">else</span>&#x000A;      <span class="ruby-operator">::</span><span class="ruby-constant">Erubis</span><span class="ruby-operator">::</span><span class="ruby-constant">XmlHelper</span>&#x000A;    <span class="ruby-keyword">end</span>&#x000A;  <span class="ruby-keyword">end</span>&#x000A;  <span class="ruby-identifier">template_opts</span>.<span class="ruby-identifier">freeze</span>&#x000A;&#x000A;  <span class="ruby-identifier">engine_opts</span> = <span class="ruby-identifier">opts</span>[<span class="ruby-value">:engine_opts</span>] = (<span class="ruby-identifier">opts</span>[<span class="ruby-value">:engine_opts</span>] <span class="ruby-operator">||</span> {}).<span class="ruby-identifier">dup</span>&#x000A;  <span class="ruby-identifier">engine_opts</span>.<span class="ruby-identifier">to_a</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">k</span>,<span class="ruby-identifier">v</span><span class="ruby-operator">|</span>&#x000A;    <span class="ruby-identifier">engine_opts</span>[<span class="ruby-identifier">k</span>] = <span class="ruby-identifier">v</span>.<span class="ruby-identifier">dup</span>.<span class="ruby-identifier">freeze</span>&#x000A;  <span class="ruby-keyword">end</span>&#x000A;  <span class="ruby-identifier">engine_opts</span>.<span class="ruby-identifier">freeze</span>&#x000A;&#x000A;  <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">freeze</span>&#x000A;<span class="ruby-keyword">end</span></pre>
                </div>
              </div>
              <div class='method public-class' id='method-method-c-load_dependencies'>
                <a name='method-c-load_dependencies'></a>
                <div class='synopsis'>
                  <span class='name'>load_dependencies</span>
                  <span class='arguments'>(app, opts=OPTS)</span>
                </div>
                <div class='description'>
                  
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('method-c-load_dependencies-source'); return false">
                    [show source]
                  </a>
                  <pre id='method-c-load_dependencies-source'><span class="ruby-comment"># File lib/roda/plugins/render.rb, line 123</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">load_dependencies</span>(<span class="ruby-identifier">app</span>, <span class="ruby-identifier">opts</span>=<span class="ruby-constant">OPTS</span>)&#x000A;  <span class="ruby-keyword">if</span> <span class="ruby-identifier">opts</span>[<span class="ruby-value">:escape</span>]&#x000A;    <span class="ruby-identifier">app</span>.<span class="ruby-identifier">plugin</span> <span class="ruby-value">:_erubis_escaping</span>&#x000A;  <span class="ruby-keyword">end</span>&#x000A;<span class="ruby-keyword">end</span></pre>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div id='footer-push'></div>
    </div>
    <div id='footer'>
      <a target="docwin" href="http://github.com/mislav/hanna/tree/master"><strong>Hanna</strong> RDoc template</a>
    </div>
  </body>
</html>
