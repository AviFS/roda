<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html lang='en'>
<head>
<title>Roda::RodaPlugins::Render</title>
<meta name='viewport' content='width=device-width, initial-scale=1'>
<meta content='text/html; charset=UTF-8' http-equiv='Content-Type'>
<link href='../../../css/style.css' media='screen' rel='stylesheet' type='text/css'>
<script type='text/javascript'>
  function popupCode(url) {
    window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
  }
  
  function toggleCode(id) {
    var code = document.getElementById(id)
  
    code.style.display = code.style.display != 'block' ? 'block' : 'none'
    return true
  }
  
  // Make codeblocks hidden by default
  document.writeln('<' + 'style type="text/css">.method .source pre { display: none }<\/style>')
</script>
</head>
<body class='page'>
<div class='class' id='wrapper'>
<div class='header'>
<h1 class='name'><span class='type'>module</span>
Roda::RodaPlugins::Render
</h1>
<ol class='paths'>
<li>
<a href="../../../files/lib/roda/plugins/render_rb.html">lib/roda/plugins/render.rb</a>
</li>
<li class='other'>
<a href="../../../files/lib/roda/plugins/render_each_rb.html">lib/roda/plugins/render_each.rb</a>
</li>
<li class='other'>
<a href="../../../files/lib/roda/plugins/render_locals_rb.html">lib/roda/plugins/render_locals.rb</a>
</li>
<li class='other'>
<a href="../../../files/lib/roda/plugins/view_options_rb.html">lib/roda/plugins/view_options.rb</a>
</li>
<li>
<a class='show' href='#' onclick='this.parentNode.parentNode.className += &quot; expanded&quot;; this.parentNode.removeChild(this); return false'>show all</a>
</li>
</ol>
</div>
<div id='content'>
<div id='text'>
<div id='description'>
<p>The render plugin adds support for template rendering using the tilt library.  Two methods are provided for template rendering, <code>view</code> (which uses the layout) and <code>render</code> (which does not).</p>

<pre class="ruby"><span class="ruby-identifier">plugin</span> <span class="ruby-value">:render</span>

<span class="ruby-identifier">route</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">r</span><span class="ruby-operator">|</span>
  <span class="ruby-identifier">r</span>.<span class="ruby-identifier">is</span> <span class="ruby-string">&#39;foo&#39;</span> <span class="ruby-keyword">do</span>
    <span class="ruby-identifier">view</span>(<span class="ruby-string">&#39;foo&#39;</span>) <span class="ruby-comment"># renders views/foo.erb inside views/layout.erb</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">r</span>.<span class="ruby-identifier">is</span> <span class="ruby-string">&#39;bar&#39;</span> <span class="ruby-keyword">do</span>
    <span class="ruby-identifier">render</span>(<span class="ruby-string">&#39;bar&#39;</span>) <span class="ruby-comment"># renders views/bar.erb</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span>
</pre>

<p>The <code>render</code> and <code>view</code> methods just return strings, they do not have side effects (unless the templates themselves have side effects). As <a href="../../Roda.html"><code>Roda</code></a> uses the routing block return value as the body of the response, in most cases you will call these methods as the last expression in a routing block to have the response body be the result of the template rendering.</p>

<p>Because <code>render</code> and <code>view</code> just return strings, you can call them inside templates (i.e. for subtemplates/partials), or multiple times in the same route and combine the results together:</p>

<pre class="ruby"><span class="ruby-identifier">route</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">r</span><span class="ruby-operator">|</span>
  <span class="ruby-identifier">r</span>.<span class="ruby-identifier">is</span> <span class="ruby-string">&#39;foo-bars&#39;</span> <span class="ruby-keyword">do</span>
    <span class="ruby-ivar">@bars</span> = <span class="ruby-constant">Bar</span>.<span class="ruby-identifier">where</span>(<span class="ruby-value">:foo</span>).<span class="ruby-identifier">map</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">b</span><span class="ruby-operator">|</span> <span class="ruby-identifier">render</span>(<span class="ruby-value">:bar</span>, <span class="ruby-value">locals:</span> {<span class="ruby-value">bar:</span> <span class="ruby-identifier">b</span>})}.<span class="ruby-identifier">join</span>
    <span class="ruby-identifier">view</span>(<span class="ruby-string">&#39;foo&#39;</span>)
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span>
</pre>

<p>You can provide options to the plugin method:</p>

<pre class="ruby"><span class="ruby-identifier">plugin</span> <span class="ruby-value">:render</span>, <span class="ruby-value">engine:</span> <span class="ruby-string">&#39;haml&#39;</span>, <span class="ruby-value">views:</span> <span class="ruby-string">&#39;admin_views&#39;</span>
</pre>

<h1 id="module-Roda::RodaPlugins::Render-label-Plugin+Options">Plugin Options<span><a href="#module-Roda::RodaPlugins::Render-label-Plugin+Options">&para;</a> <a href="#top">&uarr;</a></span></h1>

<p>The following plugin options are supported:</p>
<table class="rdoc-list note-list"><tbody><tr><td class='label'>:allowed_paths </td><td>
<p>Set the template paths to allow.  Attempts to render paths outside of these paths will raise an error.  Defaults to the <code>:views</code> directory.</p>
</td></tr><tr><td class='label'>:cache </td><td>
<p>nil/false to explicitly disable permanent template caching.  By default, permanent template caching is disabled by default if RACK_ENV is development.  When permanent template caching is disabled, for templates with paths in the file system, the modification time of the file will be checked on every render, and if it has changed, a new template will be created for the current content of the file.</p>
</td></tr><tr><td class='label'>:cache_class </td><td>
<p>A class to use as the template cache instead of the default.</p>
</td></tr><tr><td class='label'>:check_paths </td><td>
<p>Can be set to false to turn off template path checking.</p>
</td></tr><tr><td class='label'>:engine </td><td>
<p>The tilt engine to use for rendering, also the default file extension for templates, defaults to ‘erb’.</p>
</td></tr><tr><td class='label'>:escape </td><td>
<p>Use Erubi as the ERB template engine, and enable escaping by default, which makes <code>&lt;%= %&gt;</code> escape output and  <code>&lt;%== %&gt;</code> not escape output. If given, sets the <code>escape: true</code> option for all template engines, which can break some non-ERB template engines.  You can use a string or array of strings as the value for this option to only set the <code>escape: true</code> option for those specific template engines.</p>
</td></tr><tr><td class='label'>:layout </td><td>
<p>The base name of the layout file, defaults to ‘layout’.  This can be provided as a hash with the :template or :inline options.</p>
</td></tr><tr><td class='label'>:layout_opts </td><td>
<p>The options to use when rendering the layout, if different from the default options.</p>
</td></tr><tr><td class='label'>:template_opts </td><td>
<p>The tilt options used when rendering all templates. defaults to: _out_buf’, default_encoding: Encoding.default_external} at <code>{outvar: '</code>.</p>
</td></tr><tr><td class='label'>:engine_opts </td><td>
<p>The tilt options to use per template engine.  Keys are engine strings, values are hashes of template options.</p>
</td></tr><tr><td class='label'>:views </td><td>
<p>The directory holding the view files, defaults to the ‘views’ subdirectory of the application’s :root option (the process’s working directory by default).</p>
</td></tr></tbody></table>

<h1 id="module-Roda::RodaPlugins::Render-label-Render-2FView+Method+Options">Render/View Method Options<span><a href="#module-Roda::RodaPlugins::Render-label-Render-2FView+Method+Options">&para;</a> <a href="#top">&uarr;</a></span></h1>

<p>Most of these options can be overridden at runtime by passing options to the <code>view</code> or <code>render</code> methods:</p>

<pre class="ruby"><span class="ruby-identifier">view</span>(<span class="ruby-string">&#39;foo&#39;</span>, <span class="ruby-value">engine:</span> <span class="ruby-string">&#39;html.erb&#39;</span>)
<span class="ruby-identifier">render</span>(<span class="ruby-string">&#39;foo&#39;</span>, <span class="ruby-value">views:</span> <span class="ruby-string">&#39;admin_views&#39;</span>)
</pre>

<p>There are additional options to <code>view</code> and <code>render</code> that are available at runtime:</p>
<table class="rdoc-list note-list"><tbody><tr><td class='label'>:cache </td><td>
<p>Set to false to not cache this template, even when caching is on by default.  Set to true to force caching for this template, even when the default is to not permantently cache (e.g. when using the :template_block option).</p>
</td></tr><tr><td class='label'>:cache_key </td><td>
<p>Explicitly set the hash key to use when caching.</p>
</td></tr><tr><td class='label'>:content </td><td>
<p>Only respected by <code>view</code>, provides the content to render inside the layout, instead of rendering a template to get the content.</p>
</td></tr><tr><td class='label'>:inline </td><td>
<p>Use the value given as the template code, instead of looking for template code in a file.</p>
</td></tr><tr><td class='label'>:locals </td><td>
<p>Hash of local variables to make available inside the template.</p>
</td></tr><tr><td class='label'>:path </td><td>
<p>Use the value given as the full pathname for the file, instead of using the :views and :engine option in combination with the template name.</p>
</td></tr><tr><td class='label'>:scope </td><td>
<p>The object in which context to evaluate the template.  By default, this is the <a href="../../Roda.html"><code>Roda</code></a> instance.</p>
</td></tr><tr><td class='label'>:template </td><td>
<p>Provides the name of the template to use.  This allows you pass a single options hash to the render/view method, while still allowing you to specify the template name.</p>
</td></tr><tr><td class='label'>:template_block </td><td>
<p><a href="Pass.html"><code>Pass</code></a> this block when creating the underlying template, ignored when using :inline.  Disables caching of the template by default.</p>
</td></tr><tr><td class='label'>:template_class </td><td>
<p>Provides the template class to use, instead of using Tilt or <code>Tilt[:engine]</code>.</p>
</td></tr></tbody></table>

<p>Here’s an example of using these options:</p>

<pre class="ruby"><span class="ruby-identifier">view</span>(<span class="ruby-value">inline:</span> <span class="ruby-string">&#39;&lt;%= @foo %&gt;&#39;</span>)
<span class="ruby-identifier">render</span>(<span class="ruby-value">path:</span> <span class="ruby-string">&#39;/path/to/template.erb&#39;</span>)
</pre>

<p>If you pass a hash as the first argument to <code>view</code> or <code>render</code>, it should have either <code>:template</code>, <code>:inline</code>, <code>:path</code>, or <code>:content</code> (for <code>view</code>) as one of the keys.</p>

<h1 id="module-Roda::RodaPlugins::Render-label-Fixed+Locals+in+Templates">Fixed Locals in Templates<span><a href="#module-Roda::RodaPlugins::Render-label-Fixed+Locals+in+Templates">&para;</a> <a href="#top">&uarr;</a></span></h1>

<p>By default, you can pass any local variables to any templates.  A separate template method is compiled for each combination of locals.  This causes multiple issues:</p>
<ul><li>
<p>It is inefficient, especially for large templates that are called with many combinations of locals.</p>
</li><li>
<p>It hides issues if unused local variable names are passed to the template</p>
</li><li>
<p>It does not support default values for local variables</p>
</li><li>
<p>It does not support required local variables</p>
</li><li>
<p>It does not support cases where you want to pass values via a keyword splat</p>
</li><li>
<p>It does not support named blocks</p>
</li></ul>

<p>If you are using Tilt 2.6+, you can used fixed locals in templates, by passing the appropriate options in :template_opts.  For example, if you are using ERB templates, the recommended way to use the render plugin is to use the <code>:extract_fixed_locals</code> and <code>:default_fixed_locals</code> template options:</p>

<pre class="ruby"><span class="ruby-identifier">plugin</span> <span class="ruby-value">:render</span>, <span class="ruby-value">template_opts:</span> {<span class="ruby-value">extract_fixed_locals:</span> <span class="ruby-keyword">true</span>, <span class="ruby-value">default_fixed_locals:</span> <span class="ruby-string">&#39;()&#39;</span>}
</pre>

<p>This will default templates to not allowing any local variables to be passed. If the template requires local variables, you can specify them using a magic comment in the template, such as:</p>

<pre>&lt;%# locals(required_local:, optional_local: nil) %&gt;</pre>

<p>The magic comment is used as method parameters when defining the compiled template method.</p>

<p>For better debugging of issues with invalid keywords being passed to templates that have not been updated to support fixed locals, it can be helpful to set <code>:default_fixed_locals</code> to use a single optional keyword argument <code>&#39;(_no_kw: nil)&#39;</code>.  This makes the error message show which keywords were passed, instead of showing that the takes no arguments (if you use <code>&#39;()&#39;</code>), or that no keywords are accepted (if you pass <code>(**nil)</code>).</p>

<p>See Tilt’s documentation for more information regarding fixed locals.</p>

<h1 id="module-Roda::RodaPlugins::Render-label-Speeding+Up+Template+Rendering">Speeding Up Template Rendering<span><a href="#module-Roda::RodaPlugins::Render-label-Speeding+Up+Template+Rendering">&para;</a> <a href="#top">&uarr;</a></span></h1>

<p>The render/view method calls are optimized for usage with a single symbol/string argument specifying the template name.  So for fastest rendering, pass only a symbol/string to render/view.  Next best optimized are template calls with a single :locals option.  Use of other options disables the compiled template method optimizations and can be significantly slower.</p>

<p>If you must pass a hash to render/view, either as a second argument or as the only argument, you can speed things up by specifying a <code>:cache_key</code> option in the hash, making sure the <code>:cache_key</code> is unique to the template you are rendering.</p>

<h1 id="module-Roda::RodaPlugins::Render-label-Recommended+template_opts">Recommended <code>template_opts</code><span><a href="#module-Roda::RodaPlugins::Render-label-Recommended+template_opts">&para;</a> <a href="#top">&uarr;</a></span></h1>

<p>Here are the recommended values of :template_opts for new applications (a couple are Erubi-specific and can be ignored if you are using other templates engines):</p>

<pre class="ruby"><span class="ruby-identifier">plugin</span> <span class="ruby-value">:render</span>, <span class="ruby-value">template_opts:</span> {
    <span class="ruby-value">scope_class:</span> <span class="ruby-keyword">self</span>,          <span class="ruby-comment"># Always uses current class as scope class for compiled templates</span>
    <span class="ruby-value">freeze:</span> <span class="ruby-keyword">true</span>,               <span class="ruby-comment"># Freeze string literals in templates</span>
    <span class="ruby-value">extract_fixed_locals:</span> <span class="ruby-keyword">true</span>, <span class="ruby-comment"># Support fixed locals in templates</span>
    <span class="ruby-value">default_fixed_locals:</span> <span class="ruby-string">&#39;()&#39;</span>, <span class="ruby-comment"># Default to templates not supporting local variables</span>
    <span class="ruby-value">escape:</span> <span class="ruby-keyword">true</span>,               <span class="ruby-comment"># For Erubi templates, escapes &lt;%= by default (use &lt;%== for unescaped</span>
    <span class="ruby-value">chain_appends:</span> <span class="ruby-keyword">true</span>,        <span class="ruby-comment"># For Erubi templates, improves performance</span>
    <span class="ruby-value">skip_compiled_encoding_detection:</span> <span class="ruby-keyword">true</span>, <span class="ruby-comment"># Unless you need encodings explicitly specified</span>
  }
</pre>

<h1 id="module-Roda::RodaPlugins::Render-label-Accepting+Template+Blocks+in+Methods">Accepting Template Blocks in Methods<span><a href="#module-Roda::RodaPlugins::Render-label-Accepting+Template+Blocks+in+Methods">&para;</a> <a href="#top">&uarr;</a></span></h1>

<p>If you are used to Rails, you may be surprised that this type of template code doesn’t work in Roda:</p>

<pre>&lt;%= some_method do %&gt;
  Some HTML
&lt;% end %&gt;</pre>

<p>The reason this doesn’t work is that this is not valid ERB syntax, it is Rails syntax, and requires attempting to parse the <code>some_method do</code> Ruby code with a regular expression.  Since <a href="../../Roda.html"><code>Roda</code></a> uses ERB syntax, it does not support this.</p>

<p>In general, these methods are used to wrap the content of the block and inject the content into the output. To get similar behavior with <a href="../../Roda.html"><code>Roda</code></a>, you have a few different options you can use.</p>

<h2 id="module-Roda::RodaPlugins::Render-label-Use+Erubi-3A-3ACaptureBlockEngine">Use Erubi::CaptureBlockEngine<span><a href="#module-Roda::RodaPlugins::Render-label-Use+Erubi-3A-3ACaptureBlockEngine">&para;</a> <a href="#top">&uarr;</a></span></h2>

<p><a href="../../Roda.html"><code>Roda</code></a> defaults to using Erubi for erb template rendering.  Erubi 1.13.0+ includes support for an erb variant that supports blocks in <code>&lt;%=</code> and <code>&lt;%==</code> tags.  To use it:</p>

<pre class="ruby"><span class="ruby-identifier">require</span> <span class="ruby-string">&#39;erubi/capture_block&#39;</span>
<span class="ruby-identifier">plugin</span> <span class="ruby-value">:render</span>, <span class="ruby-value">template_opts:</span> {<span class="ruby-value">engine_class:</span> <span class="ruby-constant">Erubi</span><span class="ruby-operator">::</span><span class="ruby-constant">CaptureBlockEngine</span>}
</pre>

<p>See the Erubi documentation for how to capture data inside the block.  Make sure the method call (<code>some_method</code> in the example) returns the output you want added to the rendered body.</p>

<h2 id="module-Roda::RodaPlugins::Render-label-Directly+Inject+Template+Output">Directly Inject Template Output<span><a href="#module-Roda::RodaPlugins::Render-label-Directly+Inject+Template+Output">&para;</a> <a href="#top">&uarr;</a></span></h2>

<p>You can switch from a <code>&lt;%=</code> tag to using a <code>&lt;%</code> tag:</p>

<pre>&lt;% some_method do %&gt;
  Some HTML
&lt;% end %&gt;</pre>

<p>While this would output <code>Some HTML</code> into the template, it would not be able to inject content before or after the block.  However, you can use the inject_erb_plugin to handle the injection:</p>

<pre class="ruby"><span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">some_method</span>
  <span class="ruby-identifier">inject_erb</span> <span class="ruby-string">&quot;content before block&quot;</span>
  <span class="ruby-keyword">yield</span>
  <span class="ruby-identifier">inject_erb</span> <span class="ruby-string">&quot;content after block&quot;</span>
<span class="ruby-keyword">end</span>
</pre>

<p>If you need to modify the captured block before injecting it, you can use the capture_erb plugin to capture content from the template block, and modify that content, then use inject_erb to inject it into the template output:</p>

<pre class="ruby"><span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">some_method</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
  <span class="ruby-identifier">inject_erb</span> <span class="ruby-string">&quot;content before block&quot;</span>
  <span class="ruby-identifier">inject_erb</span> <span class="ruby-identifier">capture_erb</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>).<span class="ruby-identifier">upcase</span>
  <span class="ruby-identifier">inject_erb</span> <span class="ruby-string">&quot;content after block&quot;</span>
<span class="ruby-keyword">end</span>
</pre>

<p>This is the recommended approach for handling this type of method, if you want to keep the template block in the same template.</p>

<h2 id="module-Roda::RodaPlugins::Render-label-Separate+Block+Output+Into+Separate+Template">Separate Block Output Into Separate Template<span><a href="#module-Roda::RodaPlugins::Render-label-Separate+Block+Output+Into+Separate+Template">&para;</a> <a href="#top">&uarr;</a></span></h2>

<p>By moving the <code>Some HTML</code> into a separate template, you can render that template inside the block:</p>

<pre>&lt;%= some_method{render(&#39;template_name&#39;)} %&gt;</pre>

<p>It’s also possible to use an inline template:</p>

<pre>&lt;%= some_method do render(:inline=&gt;&lt;&lt;-END)
  Some HTML
  END
end %&gt;</pre>

<p>This approach is useful if it makes sense to separate the template block into its own template. You lose the ability to use local variable from outside the template block inside the template block with this approach.</p>

<h2 id="module-Roda::RodaPlugins::Render-label-Separate+Header+and+Footer">Separate Header and Footer<span><a href="#module-Roda::RodaPlugins::Render-label-Separate+Header+and+Footer">&para;</a> <a href="#top">&uarr;</a></span></h2>

<p>You can define two separate methods, one that outputs the content before the block, and one that outputs the content after the block, and use those instead of a single call:</p>

<pre>&lt;%= some_method_before %&gt;
  Some HTML
&lt;%= some_method_after %&gt;</pre>

<p>This is the simplest option to setup, but it is fairly tedious to use.</p>
</div>
<div id='method-list'>
<h2>Methods</h2>
<h3>Public Class</h3>
<ol>
<li><a href="#method-c-configure">configure</a></li>
<li><a href="#method-c-tilt_template_compiled_method">tilt_template_compiled_method</a></li>
<li><a href="#method-c-tilt_template_fixed_locals-3F">tilt_template_fixed_locals?</a></li>
</ol>
</div>
<div id='context'>
</div>
<div id='class-list'>
<h2>Classes and Modules</h2>
<ol>
<li><a href="Render/ClassMethods.html">Roda::RodaPlugins::Render::ClassMethods</a></li>
<li><a href="Render/InstanceMethods.html">Roda::RodaPlugins::Render::InstanceMethods</a></li>
<li><a href="Render/TemplateMtimeWrapper.html">Roda::RodaPlugins::Render::TemplateMtimeWrapper</a></li>
</ol>
</div>
<div id='section'>
<div id='constants-list'>
<h2>Constants</h2>
<div class='name-list'>
<table summary='Constants'>
<tr class='top-aligned-row context-row'>
<td class='context-item-name'>COMPILED_METHOD_SUPPORT</td>
<td>=</td>
<td class='context-item-value'>RUBY_VERSION >= '2.3' && tilt_compiled_method_support && ENV['RODA_RENDER_COMPILED_METHOD_SUPPORT'] != 'no'</td>
<td>&nbsp;</td>
<td class='context-item-desc'></td>
</tr>
<tr class='top-aligned-row context-row'>
<td class='context-item-name'>FIXED_LOCALS_COMPILED_METHOD_SUPPORT</td>
<td>=</td>
<td class='context-item-value'>COMPILED_METHOD_SUPPORT && Tilt::Template.method_defined?(:fixed_locals?)</td>
<td>&nbsp;</td>
<td class='context-item-desc'></td>
</tr>
<tr class='top-aligned-row context-row'>
<td class='context-item-name'>NO_CACHE</td>
<td>=</td>
<td class='context-item-value'>{:cache=>false}.freeze</td>
<td>&nbsp;</td>
<td class='context-item-desc'></td>
</tr>
</table>
</div>
</div>
<div id='methods'>
<h2>Public Class methods</h2>
<div class='method public-class' id='method-method-c-configure'>
<a name='method-c-configure'></a>
<div class='synopsis'>
<span class='name'>configure</span><span class='arguments'>(app, opts=OPTS)</span>

</div>
<div class='description'>

<p>Setup default rendering options.  See <a href="Render.html"><code>Render</code></a> for details.</p>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-c-configure-source&#39;); return false'>
[show source]
</a>
<pre id='method-c-configure-source'>    <span class="ruby-comment"># File lib/roda/plugins/render.rb</span>
<span class="line-num">312</span> <span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier ruby-title">configure</span>(<span class="ruby-identifier">app</span>, <span class="ruby-identifier">opts</span>=<span class="ruby-constant">OPTS</span>)
<span class="line-num">313</span>   <span class="ruby-keyword">if</span> <span class="ruby-identifier">app</span>.<span class="ruby-identifier">opts</span>[<span class="ruby-value">:render</span>]
<span class="line-num">314</span>     <span class="ruby-identifier">orig_cache</span> = <span class="ruby-identifier">app</span>.<span class="ruby-identifier">opts</span>[<span class="ruby-value">:render</span>][<span class="ruby-value">:cache</span>]
<span class="line-num">315</span>     <span class="ruby-identifier">orig_method_cache</span> = <span class="ruby-identifier">app</span>.<span class="ruby-identifier">opts</span>[<span class="ruby-value">:render</span>][<span class="ruby-value">:template_method_cache</span>]
<span class="line-num">316</span>     <span class="ruby-identifier">opts</span> = <span class="ruby-identifier">app</span>.<span class="ruby-identifier">opts</span>[<span class="ruby-value">:render</span>][<span class="ruby-value">:orig_opts</span>].<span class="ruby-identifier">merge</span>(<span class="ruby-identifier">opts</span>)
<span class="line-num">317</span>   <span class="ruby-keyword">end</span>
<span class="line-num">318</span>   <span class="ruby-identifier">app</span>.<span class="ruby-identifier">opts</span>[<span class="ruby-value">:render</span>] = <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">dup</span>
<span class="line-num">319</span>   <span class="ruby-identifier">app</span>.<span class="ruby-identifier">opts</span>[<span class="ruby-value">:render</span>][<span class="ruby-value">:orig_opts</span>] = <span class="ruby-identifier">opts</span>
<span class="line-num">320</span> 
<span class="line-num">321</span>   <span class="ruby-identifier">opts</span> = <span class="ruby-identifier">app</span>.<span class="ruby-identifier">opts</span>[<span class="ruby-value">:render</span>]
<span class="line-num">322</span>   <span class="ruby-identifier">opts</span>[<span class="ruby-value">:engine</span>] = (<span class="ruby-identifier">opts</span>[<span class="ruby-value">:engine</span>] <span class="ruby-operator">||</span> <span class="ruby-string">&quot;erb&quot;</span>).<span class="ruby-identifier">dup</span>.<span class="ruby-identifier">freeze</span>
<span class="line-num">323</span>   <span class="ruby-identifier">opts</span>[<span class="ruby-value">:views</span>] = <span class="ruby-identifier">app</span>.<span class="ruby-identifier">expand_path</span>(<span class="ruby-identifier">opts</span>[<span class="ruby-value">:views</span>]<span class="ruby-operator">||</span><span class="ruby-string">&quot;views&quot;</span>).<span class="ruby-identifier">freeze</span>
<span class="line-num">324</span>   <span class="ruby-identifier">opts</span>[<span class="ruby-value">:allowed_paths</span>] <span class="ruby-operator">||=</span> [<span class="ruby-identifier">opts</span>[<span class="ruby-value">:views</span>]].<span class="ruby-identifier">freeze</span>
<span class="line-num">325</span>   <span class="ruby-identifier">opts</span>[<span class="ruby-value">:allowed_paths</span>] = <span class="ruby-identifier">opts</span>[<span class="ruby-value">:allowed_paths</span>].<span class="ruby-identifier">map</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">f</span><span class="ruby-operator">|</span> <span class="ruby-identifier">app</span>.<span class="ruby-identifier">expand_path</span>(<span class="ruby-identifier">f</span>, <span class="ruby-keyword">nil</span>)}.<span class="ruby-identifier">uniq</span>.<span class="ruby-identifier">freeze</span>
<span class="line-num">326</span>   <span class="ruby-identifier">opts</span>[<span class="ruby-value">:check_paths</span>] = <span class="ruby-keyword">true</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">has_key?</span>(<span class="ruby-value">:check_paths</span>)
<span class="line-num">327</span> 
<span class="line-num">328</span>   <span class="ruby-keyword">unless</span> <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">has_key?</span>(<span class="ruby-value">:check_template_mtime</span>)
<span class="line-num">329</span>     <span class="ruby-identifier">opts</span>[<span class="ruby-value">:check_template_mtime</span>] = <span class="ruby-keyword">if</span> <span class="ruby-identifier">opts</span>[<span class="ruby-value">:cache</span>] <span class="ruby-operator">==</span> <span class="ruby-keyword">false</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">opts</span>[<span class="ruby-value">:explicit_cache</span>]
<span class="line-num">330</span>       <span class="ruby-keyword">true</span>
<span class="line-num">331</span>     <span class="ruby-keyword">else</span>
<span class="line-num">332</span>       <span class="ruby-constant">ENV</span>[<span class="ruby-string">&#39;RACK_ENV&#39;</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&#39;development&#39;</span>
<span class="line-num">333</span>     <span class="ruby-keyword">end</span>
<span class="line-num">334</span>   <span class="ruby-keyword">end</span>
<span class="line-num">335</span> 
<span class="line-num">336</span>   <span class="ruby-keyword">begin</span>
<span class="line-num">337</span>     <span class="ruby-identifier">app</span>.<span class="ruby-identifier">const_get</span>(<span class="ruby-value">:RodaCompiledTemplates</span>, <span class="ruby-keyword">false</span>)
<span class="line-num">338</span>   <span class="ruby-keyword">rescue</span> <span class="ruby-constant">NameError</span>
<span class="line-num">339</span>     <span class="ruby-identifier">compiled_templates_module</span> = <span class="ruby-constant">Module</span>.<span class="ruby-identifier">new</span>
<span class="line-num">340</span>     <span class="ruby-identifier">app</span>.<span class="ruby-identifier">send</span>(<span class="ruby-value">:include</span>, <span class="ruby-identifier">compiled_templates_module</span>)
<span class="line-num">341</span>     <span class="ruby-identifier">app</span>.<span class="ruby-identifier">const_set</span>(<span class="ruby-value">:RodaCompiledTemplates</span>, <span class="ruby-identifier">compiled_templates_module</span>)
<span class="line-num">342</span>   <span class="ruby-keyword">end</span>
<span class="line-num">343</span>   <span class="ruby-identifier">opts</span>[<span class="ruby-value">:template_method_cache</span>] = <span class="ruby-identifier">orig_method_cache</span> <span class="ruby-operator">||</span> (<span class="ruby-identifier">opts</span>[<span class="ruby-value">:cache_class</span>] <span class="ruby-operator">||</span> <span class="ruby-constant">RodaCache</span>).<span class="ruby-identifier">new</span>
<span class="line-num">344</span>   <span class="ruby-identifier">opts</span>[<span class="ruby-value">:template_method_cache</span>][<span class="ruby-value">:_roda_layout</span>] = <span class="ruby-keyword">nil</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">opts</span>[<span class="ruby-value">:template_method_cache</span>][<span class="ruby-value">:_roda_layout</span>]
<span class="line-num">345</span>   <span class="ruby-identifier">opts</span>[<span class="ruby-value">:cache</span>] = <span class="ruby-identifier">orig_cache</span> <span class="ruby-operator">||</span> (<span class="ruby-identifier">opts</span>[<span class="ruby-value">:cache_class</span>] <span class="ruby-operator">||</span> <span class="ruby-constant">RodaCache</span>).<span class="ruby-identifier">new</span>
<span class="line-num">346</span> 
<span class="line-num">347</span>   <span class="ruby-identifier">opts</span>[<span class="ruby-value">:layout_opts</span>] = (<span class="ruby-identifier">opts</span>[<span class="ruby-value">:layout_opts</span>] <span class="ruby-operator">||</span> {}).<span class="ruby-identifier">dup</span>
<span class="line-num">348</span>   <span class="ruby-identifier">opts</span>[<span class="ruby-value">:layout_opts</span>][<span class="ruby-value">:_is_layout</span>] = <span class="ruby-keyword">true</span>
<span class="line-num">349</span>   <span class="ruby-keyword">if</span> <span class="ruby-identifier">opts</span>[<span class="ruby-value">:layout_opts</span>][<span class="ruby-value">:views</span>]
<span class="line-num">350</span>     <span class="ruby-identifier">opts</span>[<span class="ruby-value">:layout_opts</span>][<span class="ruby-value">:views</span>] = <span class="ruby-identifier">app</span>.<span class="ruby-identifier">expand_path</span>(<span class="ruby-identifier">opts</span>[<span class="ruby-value">:layout_opts</span>][<span class="ruby-value">:views</span>]).<span class="ruby-identifier">freeze</span>
<span class="line-num">351</span>   <span class="ruby-keyword">end</span>
<span class="line-num">352</span> 
<span class="line-num">353</span>   <span class="ruby-keyword">if</span> <span class="ruby-identifier">layout</span> = <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">fetch</span>(<span class="ruby-value">:layout</span>, <span class="ruby-keyword">true</span>)
<span class="line-num">354</span>     <span class="ruby-identifier">opts</span>[<span class="ruby-value">:layout</span>] = <span class="ruby-keyword">true</span>
<span class="line-num">355</span> 
<span class="line-num">356</span>     <span class="ruby-keyword">case</span> <span class="ruby-identifier">layout</span>
<span class="line-num">357</span>     <span class="ruby-keyword">when</span> <span class="ruby-constant">Hash</span>
<span class="line-num">358</span>       <span class="ruby-identifier">opts</span>[<span class="ruby-value">:layout_opts</span>].<span class="ruby-identifier">merge!</span>(<span class="ruby-identifier">layout</span>)
<span class="line-num">359</span>     <span class="ruby-keyword">when</span> <span class="ruby-keyword">true</span>
<span class="line-num">360</span>       <span class="ruby-identifier">opts</span>[<span class="ruby-value">:layout_opts</span>][<span class="ruby-value">:template</span>] <span class="ruby-operator">||=</span> <span class="ruby-string">&#39;layout&#39;</span>
<span class="line-num">361</span>     <span class="ruby-keyword">else</span>
<span class="line-num">362</span>       <span class="ruby-identifier">opts</span>[<span class="ruby-value">:layout_opts</span>][<span class="ruby-value">:template</span>] = <span class="ruby-identifier">layout</span>
<span class="line-num">363</span>     <span class="ruby-keyword">end</span>
<span class="line-num">364</span> 
<span class="line-num">365</span>     <span class="ruby-identifier">opts</span>[<span class="ruby-value">:optimize_layout</span>] = (<span class="ruby-identifier">opts</span>[<span class="ruby-value">:layout_opts</span>][<span class="ruby-value">:template</span>] <span class="ruby-keyword">if</span> <span class="ruby-identifier">opts</span>[<span class="ruby-value">:layout_opts</span>].<span class="ruby-identifier">keys</span>.<span class="ruby-identifier">sort</span> <span class="ruby-operator">==</span> [<span class="ruby-value">:_is_layout</span>, <span class="ruby-value">:template</span>])
<span class="line-num">366</span>   <span class="ruby-keyword">end</span>
<span class="line-num">367</span>   <span class="ruby-identifier">opts</span>[<span class="ruby-value">:layout_opts</span>].<span class="ruby-identifier">freeze</span>
<span class="line-num">368</span> 
<span class="line-num">369</span>   <span class="ruby-identifier">template_opts</span> = <span class="ruby-identifier">opts</span>[<span class="ruby-value">:template_opts</span>] = (<span class="ruby-identifier">opts</span>[<span class="ruby-value">:template_opts</span>] <span class="ruby-operator">||</span> {}).<span class="ruby-identifier">dup</span>
<span class="line-num">370</span>   <span class="ruby-identifier">template_opts</span>[<span class="ruby-value">:outvar</span>] <span class="ruby-operator">||=</span> <span class="ruby-string">&#39;@_out_buf&#39;</span>
<span class="line-num">371</span>   <span class="ruby-keyword">unless</span> <span class="ruby-identifier">template_opts</span>.<span class="ruby-identifier">has_key?</span>(<span class="ruby-value">:default_encoding</span>)
<span class="line-num">372</span>     <span class="ruby-identifier">template_opts</span>[<span class="ruby-value">:default_encoding</span>] = <span class="ruby-constant">Encoding</span>.<span class="ruby-identifier">default_external</span>
<span class="line-num">373</span>   <span class="ruby-keyword">end</span>
<span class="line-num">374</span> 
<span class="line-num">375</span>   <span class="ruby-identifier">engine_opts</span> = <span class="ruby-identifier">opts</span>[<span class="ruby-value">:engine_opts</span>] = (<span class="ruby-identifier">opts</span>[<span class="ruby-value">:engine_opts</span>] <span class="ruby-operator">||</span> {}).<span class="ruby-identifier">dup</span>
<span class="line-num">376</span>   <span class="ruby-identifier">engine_opts</span>.<span class="ruby-identifier">to_a</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">k</span>,<span class="ruby-identifier">v</span><span class="ruby-operator">|</span>
<span class="line-num">377</span>     <span class="ruby-identifier">engine_opts</span>[<span class="ruby-identifier">k</span>] = <span class="ruby-identifier">v</span>.<span class="ruby-identifier">dup</span>.<span class="ruby-identifier">freeze</span>
<span class="line-num">378</span>   <span class="ruby-keyword">end</span>
<span class="line-num">379</span> 
<span class="line-num">380</span>   <span class="ruby-keyword">if</span> <span class="ruby-identifier">escape</span> = <span class="ruby-identifier">opts</span>[<span class="ruby-value">:escape</span>]
<span class="line-num">381</span>     <span class="ruby-identifier">require</span> <span class="ruby-string">&#39;tilt/erubi&#39;</span>
<span class="line-num">382</span> 
<span class="line-num">383</span>     <span class="ruby-keyword">case</span> <span class="ruby-identifier">escape</span>
<span class="line-num">384</span>     <span class="ruby-keyword">when</span> <span class="ruby-constant">String</span>, <span class="ruby-constant">Array</span>
<span class="line-num">385</span>       <span class="ruby-constant">Array</span>(<span class="ruby-identifier">escape</span>).<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">engine</span><span class="ruby-operator">|</span>
<span class="line-num">386</span>         <span class="ruby-identifier">engine_opts</span>[<span class="ruby-identifier">engine</span>] = (<span class="ruby-identifier">engine_opts</span>[<span class="ruby-identifier">engine</span>] <span class="ruby-operator">||</span> {}).<span class="ruby-identifier">merge</span>(<span class="ruby-value">:escape</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-keyword">true</span>).<span class="ruby-identifier">freeze</span>
<span class="line-num">387</span>       <span class="ruby-keyword">end</span>
<span class="line-num">388</span>     <span class="ruby-keyword">else</span>
<span class="line-num">389</span>       <span class="ruby-identifier">template_opts</span>[<span class="ruby-value">:escape</span>] = <span class="ruby-keyword">true</span>
<span class="line-num">390</span>     <span class="ruby-keyword">end</span>
<span class="line-num">391</span>   <span class="ruby-keyword">end</span>
<span class="line-num">392</span> 
<span class="line-num">393</span>   <span class="ruby-identifier">template_opts</span>.<span class="ruby-identifier">freeze</span>
<span class="line-num">394</span>   <span class="ruby-identifier">engine_opts</span>.<span class="ruby-identifier">freeze</span>
<span class="line-num">395</span>   <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">freeze</span>
<span class="line-num">396</span> <span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method public-class' id='method-method-c-tilt_template_compiled_method'>
<a name='method-c-tilt_template_compiled_method'></a>
<div class='synopsis'>
<span class='name'>tilt_template_compiled_method</span><span class='arguments'>(template, locals_keys, scope_class)</span>

</div>
<div class='description'>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-c-tilt_template_compiled_method-source&#39;); return false'>
[show source]
</a>
<pre id='method-c-tilt_template_compiled_method-source'>    <span class="ruby-comment"># File lib/roda/plugins/render.rb</span>
<span class="line-num">300</span> <span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier ruby-title">tilt_template_compiled_method</span>(<span class="ruby-identifier">template</span>, <span class="ruby-identifier">locals_keys</span>, <span class="ruby-identifier">scope_class</span>)
<span class="line-num">301</span>   <span class="ruby-identifier">template</span>.<span class="ruby-identifier">send</span>(<span class="ruby-value">:compiled_method</span>, <span class="ruby-identifier">locals_keys</span>, <span class="ruby-identifier">scope_class</span>)
<span class="line-num">302</span> <span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method public-class' id='method-method-c-tilt_template_fixed_locals-3F'>
<a name='method-c-tilt_template_fixed_locals-3F'></a>
<div class='synopsis'>
<span class='name'>tilt_template_fixed_locals?</span><span class='arguments'>(template)</span>

</div>
<div class='description'>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-c-tilt_template_fixed_locals-3F-source&#39;); return false'>
[show source]
</a>
<pre id='method-c-tilt_template_fixed_locals-3F-source'>    <span class="ruby-comment"># File lib/roda/plugins/render.rb</span>
<span class="line-num">288</span> <span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier ruby-title">tilt_template_fixed_locals?</span>(<span class="ruby-identifier">template</span>)
<span class="line-num">289</span>   <span class="ruby-identifier">template</span>.<span class="ruby-identifier">fixed_locals?</span>
<span class="line-num">290</span> <span class="ruby-keyword">end</span></pre>
</div>
</div>
</div>
</div>

</div>
</div>

<div id='footer-push'></div>
</div>
<div id='footer'>
<a href="https://github.com/jeremyevans/hanna"><strong>Hanna</strong> RDoc template</a>
</div>
</body>
</html>
