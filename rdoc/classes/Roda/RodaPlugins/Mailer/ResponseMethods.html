<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html lang='en'>
<head>
<title>Roda::RodaPlugins::Mailer::ResponseMethods</title>
<meta content='text/html; charset=UTF-8' http-equiv='Content-Type'>
<link href='../../../../css/style.css' media='screen' rel='stylesheet' type='text/css'>
<script type='text/javascript'>
  function popupCode(url) {
    window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
  }
  
  function toggleCode(id) {
    var code = document.getElementById(id)
  
    code.style.display = code.style.display != 'block' ? 'block' : 'none'
    return true
  }
  
  // Make codeblocks hidden by default
  document.writeln('<' + 'style type="text/css">.method .source pre { display: none }<\/style>')
</script>
</head>
<body class='page'>
<div class='class' id='wrapper'>
<div class='header'>
<h1 class='name'><span class='type'>module</span>
Roda::RodaPlugins::Mailer::ResponseMethods
</h1>
<ol class='paths'>
<li>
<a href="../../../../files/lib/roda/plugins/mailer_rb.html">lib/roda/plugins/mailer.rb</a>
</li>
</ol>
</div>
<div id='content'>
<div id='text'>
<div id='description'></div>
<div id='method-list'>
<h2>Methods</h2>
<h3>Public Instance</h3>
<ol>
<li><a href="#method-i-finish">finish</a></li>
<li><a href="#attribute-i-mail">mail</a></li>
<li><a href="#method-i-mail_attachments">mail_attachments</a></li>
</ol>
</div>
<div id='context'>
</div>
<div id='section'>
<div id='attribute-list'>
<h2 class='section-bar'>Attributes</h2>
<div class='name-list'>
<table>
<tr class='top-aligned-row context-row'>
<td class='context-item-name'>
<a name='attribute-i-mail'>mail</a>
</td>
<td class='context-item-value'>[RW]</td>
<td class='context-item-desc'>
<p>The mail object related to the current request.</p>
</td>
</tr>
</table>
</div>
</div>
<div id='methods'>
<h2>Public Instance methods</h2>
<div class='method public-instance' id='method-method-i-finish'>
<a name='method-i-finish'></a>
<div class='synopsis'>
<span class='name'>finish</span>
<span class='arguments'>()</span>

</div>
<div class='description'>

<p>If the related request was an email request, add any response headers to the email, as well as adding the response body to the email. Return the email unless no body was set for it, which would indicate that the routing tree did not handle the request.</p>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-finish-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-finish-source'>    <span class="ruby-comment"># File lib/roda/plugins/mailer.rb</span>&#x000A;<span class="line-num">181</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">finish</span>&#x000A;<span class="line-num">182</span>   <span class="ruby-keyword">if</span> <span class="ruby-identifier">m</span> = <span class="ruby-identifier">mail</span>&#x000A;<span class="line-num">183</span>     <span class="ruby-identifier">header_content_type</span> = <span class="ruby-ivar">@headers</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-string">&#39;Content-Type&#39;</span>)&#x000A;<span class="line-num">184</span>     <span class="ruby-identifier">m</span>.<span class="ruby-identifier">headers</span>(<span class="ruby-ivar">@headers</span>)&#x000A;<span class="line-num">185</span>     <span class="ruby-identifier">m</span>.<span class="ruby-identifier">body</span>(<span class="ruby-ivar">@body</span>.<span class="ruby-identifier">join</span>) <span class="ruby-keyword">unless</span> <span class="ruby-ivar">@body</span>.<span class="ruby-identifier">empty?</span>&#x000A;<span class="line-num">186</span>     <span class="ruby-identifier">mail_attachments</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">a</span>, <span class="ruby-identifier">block</span><span class="ruby-operator">|</span>&#x000A;<span class="line-num">187</span>       <span class="ruby-identifier">m</span>.<span class="ruby-identifier">add_file</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">a</span>)&#x000A;<span class="line-num">188</span>       <span class="ruby-identifier">block</span>.<span class="ruby-identifier">call</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">block</span>&#x000A;<span class="line-num">189</span>     <span class="ruby-keyword">end</span>&#x000A;<span class="line-num">190</span> &#x000A;<span class="line-num">191</span>     <span class="ruby-keyword">if</span> <span class="ruby-identifier">content_type</span> = <span class="ruby-identifier">header_content_type</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">roda_class</span>.<span class="ruby-identifier">opts</span>[<span class="ruby-value">:mailer</span>][<span class="ruby-value">:content_type</span>]&#x000A;<span class="line-num">192</span>       <span class="ruby-keyword">if</span> <span class="ruby-identifier">mail</span>.<span class="ruby-identifier">multipart?</span>&#x000A;<span class="line-num">193</span>         <span class="ruby-keyword">if</span> <span class="ruby-identifier">mail</span>.<span class="ruby-identifier">content_type</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp">/multipart\/mixed/</span> <span class="ruby-operator">&amp;&amp;</span>&#x000A;<span class="line-num">194</span>            <span class="ruby-identifier">mail</span>.<span class="ruby-identifier">parts</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;=</span> <span class="ruby-value">2</span> <span class="ruby-operator">&amp;&amp;</span>&#x000A;<span class="line-num">195</span>            (<span class="ruby-identifier">part</span> = <span class="ruby-identifier">mail</span>.<span class="ruby-identifier">parts</span>.<span class="ruby-identifier">find</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">p</span><span class="ruby-operator">|</span> <span class="ruby-operator">!</span><span class="ruby-identifier">p</span>.<span class="ruby-identifier">attachment</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">p</span>.<span class="ruby-identifier">content_type</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;text/plain&quot;</span>})&#x000A;<span class="line-num">196</span>           <span class="ruby-identifier">part</span>.<span class="ruby-identifier">content_type</span> = <span class="ruby-identifier">content_type</span>&#x000A;<span class="line-num">197</span>         <span class="ruby-keyword">end</span>&#x000A;<span class="line-num">198</span>       <span class="ruby-keyword">else</span>&#x000A;<span class="line-num">199</span>         <span class="ruby-identifier">mail</span>.<span class="ruby-identifier">content_type</span> = <span class="ruby-identifier">content_type</span>&#x000A;<span class="line-num">200</span>       <span class="ruby-keyword">end</span>&#x000A;<span class="line-num">201</span>     <span class="ruby-keyword">end</span>&#x000A;<span class="line-num">202</span> &#x000A;<span class="line-num">203</span>     <span class="ruby-keyword">unless</span> <span class="ruby-identifier">m</span>.<span class="ruby-identifier">body</span>.<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">empty?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">m</span>.<span class="ruby-identifier">parts</span>.<span class="ruby-identifier">empty?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@body</span>.<span class="ruby-identifier">empty?</span>&#x000A;<span class="line-num">204</span>       <span class="ruby-identifier">m</span>&#x000A;<span class="line-num">205</span>     <span class="ruby-keyword">end</span>&#x000A;<span class="line-num">206</span>   <span class="ruby-keyword">else</span>&#x000A;<span class="line-num">207</span>     <span class="ruby-keyword">super</span>&#x000A;<span class="line-num">208</span>   <span class="ruby-keyword">end</span>&#x000A;<span class="line-num">209</span> <span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method public-instance' id='method-method-i-mail_attachments'>
<a name='method-i-mail_attachments'></a>
<div class='synopsis'>
<span class='name'>mail_attachments</span>
<span class='arguments'>()</span>

</div>
<div class='description'>

<p>The attachments related to the current mail.</p>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-mail_attachments-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-mail_attachments-source'>    <span class="ruby-comment"># File lib/roda/plugins/mailer.rb</span>&#x000A;<span class="line-num">212</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">mail_attachments</span>&#x000A;<span class="line-num">213</span>   <span class="ruby-ivar">@mail_attachments</span> <span class="ruby-operator">||=</span> []&#x000A;<span class="line-num">214</span> <span class="ruby-keyword">end</span></pre>
</div>
</div>
</div>
</div>

</div>
</div>

<div id='footer-push'></div>
</div>
<div id='footer'>
<a href="https://github.com/rdoc/hanna-nouveau"><strong>Hanna Nouveau</strong> RDoc template</a>
</div>
</body>
</html>
