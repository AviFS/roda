<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html lang='en'>
<head>
<title>Roda::RodaPlugins::Sessions::RequestMethods</title>
<meta content='text/html; charset=UTF-8' http-equiv='Content-Type'>
<link href='../../../../css/style.css' media='screen' rel='stylesheet' type='text/css'>
<script type='text/javascript'>
  function popupCode(url) {
    window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
  }
  
  function toggleCode(id) {
    var code = document.getElementById(id)
  
    code.style.display = code.style.display != 'block' ? 'block' : 'none'
    return true
  }
  
  // Make codeblocks hidden by default
  document.writeln('<' + 'style type="text/css">.method .source pre { display: none }<\/style>')
</script>
</head>
<body class='page'>
<div class='class' id='wrapper'>
<div class='header'>
<h1 class='name'><span class='type'>module</span>
Roda::RodaPlugins::Sessions::RequestMethods
</h1>
<ol class='paths'>
<li>
<a href="../../../../files/lib/roda/plugins/sessions_rb.html">lib/roda/plugins/sessions.rb</a>
</li>
</ol>
</div>
<div id='content'>
<div id='text'>
<div id='description'></div>
<div id='method-list'>
<h2>Methods</h2>
<h3>Public Instance</h3>
<ol>
<li><a href="#method-i-persist_session">persist_session</a></li>
<li><a href="#method-i-session">session</a></li>
</ol>
</div>
<div id='context'>
</div>
<div id='section'>
<div id='methods'>
<h2>Public Instance methods</h2>
<div class='method public-instance' id='method-method-i-persist_session'>
<a name='method-i-persist_session'></a>
<div class='synopsis'>
<span class='name'>persist_session</span>
<span class='arguments'>(headers, session)</span>

</div>
<div class='description'>

<p>Persist the session data as a cookie.  If transparently upgrading from
Rack::Session::Cookie, mark the related cookie for expiration so it
isn&#39;t sent in the future.</p>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-persist_session-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-persist_session-source'><span class="ruby-comment"># File lib/roda/plugins/sessions.rb, line 231</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">persist_session</span>(<span class="ruby-identifier">headers</span>, <span class="ruby-identifier">session</span>)&#x000A;  <span class="ruby-identifier">opts</span> = <span class="ruby-identifier">roda_class</span>.<span class="ruby-identifier">opts</span>[<span class="ruby-value">:sessions</span>]&#x000A;&#x000A;  <span class="ruby-keyword">if</span> <span class="ruby-identifier">session</span>.<span class="ruby-identifier">empty?</span>&#x000A;    <span class="ruby-keyword">if</span> <span class="ruby-identifier">env</span>[<span class="ruby-constant">SESSION_SERIALIZED</span>]&#x000A;      <span class="ruby-comment"># If session was submitted and is now empty, remove the cookie</span>&#x000A;      <span class="ruby-constant">Rack</span><span class="ruby-operator">::</span><span class="ruby-constant">Utils</span>.<span class="ruby-identifier">delete_cookie_header!</span>(<span class="ruby-identifier">headers</span>, <span class="ruby-identifier">opts</span>[<span class="ruby-value">:key</span>])&#x000A;    <span class="ruby-comment"># else</span>&#x000A;      <span class="ruby-comment"># If no session was submitted, and the session is empty</span>&#x000A;      <span class="ruby-comment"># then there is no need to do anything</span>&#x000A;    <span class="ruby-keyword">end</span>&#x000A;  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">cookie_value</span> = <span class="ruby-identifier">_serialize_session</span>(<span class="ruby-identifier">session</span>)&#x000A;    <span class="ruby-identifier">cookie</span> = <span class="ruby-constant">Hash</span>[<span class="ruby-identifier">opts</span>[<span class="ruby-value">:cookie_options</span>]]&#x000A;    <span class="ruby-identifier">cookie</span>[<span class="ruby-value">:value</span>] = <span class="ruby-identifier">cookie_value</span>&#x000A;    <span class="ruby-identifier">cookie</span>[<span class="ruby-value">:secure</span>] = <span class="ruby-keyword">true</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">cookie</span>.<span class="ruby-identifier">has_key?</span>(<span class="ruby-value">:secure</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">ssl?</span>&#x000A;    <span class="ruby-constant">Rack</span><span class="ruby-operator">::</span><span class="ruby-constant">Utils</span>.<span class="ruby-identifier">set_cookie_header!</span>(<span class="ruby-identifier">headers</span>, <span class="ruby-identifier">opts</span>[<span class="ruby-value">:key</span>], <span class="ruby-identifier">cookie</span>)&#x000A;  <span class="ruby-keyword">end</span>&#x000A;  &#x000A;  <span class="ruby-keyword">if</span> <span class="ruby-identifier">env</span>[<span class="ruby-constant">SESSION_DELETE_RACK_COOKIE</span>]&#x000A;    <span class="ruby-constant">Rack</span><span class="ruby-operator">::</span><span class="ruby-constant">Utils</span>.<span class="ruby-identifier">delete_cookie_header!</span>(<span class="ruby-identifier">headers</span>, <span class="ruby-identifier">opts</span>[<span class="ruby-value">:upgrade_from_rack_session_cookie_key</span>], <span class="ruby-identifier">opts</span>[<span class="ruby-value">:upgrade_from_rack_session_cookie_options</span>])&#x000A;  <span class="ruby-keyword">end</span>&#x000A;&#x000A;  <span class="ruby-keyword">nil</span>&#x000A;<span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method public-instance' id='method-method-i-session'>
<a name='method-i-session'></a>
<div class='synopsis'>
<span class='name'>session</span>
<span class='arguments'>()</span>

</div>
<div class='description'>

<p>Load the session information from the cookie.  With the sessions plugin,
you must call this method to get the session, instead of trying to access
the session directly through the request environment. For maximum
compatibility with other software that uses rack sessions, this method
stores the session in &#39;rack.session&#39; in the request environment,
but that does not happen until this method is called.</p>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-session-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-session-source'><span class="ruby-comment"># File lib/roda/plugins/sessions.rb, line 224</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">session</span>&#x000A;  <span class="ruby-ivar">@env</span>[<span class="ruby-string">&#39;rack.session&#39;</span>] <span class="ruby-operator">||=</span> <span class="ruby-identifier">_load_session</span>&#x000A;<span class="ruby-keyword">end</span></pre>
</div>
</div>
</div>
</div>

</div>
</div>

<div id='footer-push'></div>
</div>
<div id='footer'>
<a href="https://github.com/rdoc/hanna-nouveau"><strong>Hanna Nouveau</strong> RDoc template</a>
</div>
</body>
</html>
