<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html lang='en'>
<head>
<title>Roda::RodaPlugins::ExceptionPage::InstanceMethods</title>
<meta content='text/html; charset=UTF-8' http-equiv='Content-Type'>
<link href='../../../../css/style.css' media='screen' rel='stylesheet' type='text/css'>
<script type='text/javascript'>
  function popupCode(url) {
    window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
  }
  
  function toggleCode(id) {
    var code = document.getElementById(id)
  
    code.style.display = code.style.display != 'block' ? 'block' : 'none'
    return true
  }
  
  // Make codeblocks hidden by default
  document.writeln('<' + 'style type="text/css">.method .source pre { display: none }<\/style>')
</script>
</head>
<body class='page'>
<div class='class' id='wrapper'>
<div class='header'>
<h1 class='name'><span class='type'>module</span>
Roda::RodaPlugins::ExceptionPage::InstanceMethods
</h1>
<ol class='paths'>
<li>
<a href="../../../../files/lib/roda/plugins/exception_page_rb.html">lib/roda/plugins/exception_page.rb</a>
</li>
</ol>
</div>
<div id='content'>
<div id='text'>
<div id='description'></div>
<div id='method-list'>
<h2>Methods</h2>
<h3>Public Instance</h3>
<ol>
<li><a href="#method-i-exception_page">exception_page</a></li>
</ol>
</div>
<div id='context'>
</div>
<div id='section'>
<div id='methods'>
<h2>Public Instance methods</h2>
<div class='method public-instance' id='method-method-i-exception_page'>
<a name='method-i-exception_page'></a>
<div class='synopsis'>
<span class='name'>exception_page</span><span class='arguments'>(exception, opts=OPTS)</span>

</div>
<div class='description'>

<p>Return a HTML page showing the exception, allowing a developer more information for debugging.  Designed to be called inside an exception handler, passing in the received exception. Sets the Content-Type header in the response, and returns the string used for the body.  If the Accept request header is present and text/html is accepted, return an HTML page with the backtrace with the ability to see the context for each backtrace line, as well as the GET, POST, cookie, and rack environment data.  If text/html is not accepted, then just show a plain text page with the exception class, message, and backtrace.</p>

<p>Options:</p>
<table class="rdoc-list note-list"><tbody><tr><td class='label'>:assets </td><td>
<p>If <code>true</code>, sets :css_file to <code>/exception_page.css</code> and :js_file to <code>/exception_page.js</code>, assuming that <code>r.exception_page_assets</code> is called in the route block to serve the exception page assets.  If a String, uses the string as a prefix, assuming that <code>r.exception_page_assets</code> is called in a nested block inside the route block. If false, doesn&#39;t use any CSS or JS.</p>
</td></tr><tr><td class='label'>:context </td><td>
<p>The number of context lines before and after each line in the backtrace (default: 7).</p>
</td></tr><tr><td class='label'>:css_file </td><td>
<p>A path to the external CSS file for the HTML exception page. If false, doesn&#39;t use any CSS.</p>
</td></tr><tr><td class='label'>:js_file </td><td>
<p>A path to the external javascript file for the HTML exception page. If false, doesn&#39;t use any JS.</p>
</td></tr><tr><td class='label'>:json </td><td>
<p>Return a hash of exception information.  The hash will have a single key, “exception”, with a value being a hash with three keys, “class”, “message”, and “backtrace”, which contain information derived from the given exception. Designed to be used with the <code>json</code> exception, which will automatically convert the hash to JSON format.</p>
</td></tr></tbody></table>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-exception_page-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-exception_page-source'>    <span class="ruby-comment"># File lib/roda/plugins/exception_page.rb</span>&#x000A;<span class="line-num">198</span>         <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">exception_page</span>(<span class="ruby-identifier">exception</span>, <span class="ruby-identifier">opts</span>=<span class="ruby-constant">OPTS</span>)&#x000A;<span class="line-num">199</span>           <span class="ruby-keyword">if</span> <span class="ruby-identifier">opts</span>[<span class="ruby-value">:json</span>]&#x000A;<span class="line-num">200</span>             <span class="ruby-ivar">@_response</span>[<span class="ruby-string">&#39;Content-Type&#39;</span>] = <span class="ruby-string">&quot;application/json&quot;</span>&#x000A;<span class="line-num">201</span>             {&#x000A;<span class="line-num">202</span>               <span class="ruby-string">&quot;exception&quot;</span><span class="ruby-operator">=&gt;</span>{&#x000A;<span class="line-num">203</span>                 <span class="ruby-string">&quot;class&quot;</span><span class="ruby-operator">=&gt;</span><span class="ruby-identifier">exception</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">to_s</span>,&#x000A;<span class="line-num">204</span>                 <span class="ruby-string">&quot;message&quot;</span><span class="ruby-operator">=&gt;</span><span class="ruby-identifier">exception</span>.<span class="ruby-identifier">message</span>.<span class="ruby-identifier">to_s</span>,&#x000A;<span class="line-num">205</span>                 <span class="ruby-string">&quot;backtrace&quot;</span><span class="ruby-operator">=&gt;</span><span class="ruby-identifier">exception</span>.<span class="ruby-identifier">backtrace</span>.<span class="ruby-identifier">map</span>(<span class="ruby-operator">&amp;</span><span class="ruby-value">:to_s</span>)&#x000A;<span class="line-num">206</span>               }&#x000A;<span class="line-num">207</span>             }&#x000A;<span class="line-num">208</span>           <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">env</span>[<span class="ruby-string">&#39;HTTP_ACCEPT&#39;</span>] <span class="ruby-operator">=~</span> <span class="ruby-regexp">/text\/html/</span>&#x000A;<span class="line-num">209</span>             <span class="ruby-ivar">@_response</span>[<span class="ruby-string">&#39;Content-Type&#39;</span>] = <span class="ruby-string">&quot;text/html&quot;</span>&#x000A;<span class="line-num">210</span> &#x000A;<span class="line-num">211</span>             <span class="ruby-identifier">context</span> = <span class="ruby-identifier">opts</span>[<span class="ruby-value">:context</span>] <span class="ruby-operator">||</span> <span class="ruby-value">7</span>&#x000A;<span class="line-num">212</span>             <span class="ruby-identifier">css_file</span> = <span class="ruby-identifier">opts</span>[<span class="ruby-value">:css_file</span>]&#x000A;<span class="line-num">213</span>             <span class="ruby-identifier">js_file</span> = <span class="ruby-identifier">opts</span>[<span class="ruby-value">:js_file</span>]&#x000A;<span class="line-num">214</span> &#x000A;<span class="line-num">215</span>             <span class="ruby-keyword">case</span> <span class="ruby-identifier">prefix</span> = <span class="ruby-identifier">opts</span>[<span class="ruby-value">:assets</span>]&#x000A;<span class="line-num">216</span>             <span class="ruby-keyword">when</span> <span class="ruby-keyword">false</span>&#x000A;<span class="line-num">217</span>               <span class="ruby-identifier">css_file</span> = <span class="ruby-keyword">false</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">css_file</span>.<span class="ruby-identifier">nil?</span>&#x000A;<span class="line-num">218</span>               <span class="ruby-identifier">js_file</span> = <span class="ruby-keyword">false</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">js_file</span>.<span class="ruby-identifier">nil?</span>&#x000A;<span class="line-num">219</span>             <span class="ruby-keyword">when</span> <span class="ruby-keyword">nil</span>&#x000A;<span class="line-num">220</span>               <span class="ruby-comment"># nothing</span>&#x000A;<span class="line-num">221</span>             <span class="ruby-keyword">else</span>&#x000A;<span class="line-num">222</span>               <span class="ruby-identifier">prefix</span> = <span class="ruby-string">&#39;&#39;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">prefix</span> <span class="ruby-operator">==</span> <span class="ruby-keyword">true</span>&#x000A;<span class="line-num">223</span>               <span class="ruby-identifier">css_file</span> <span class="ruby-operator">||=</span> <span class="ruby-node">&quot;#{prefix}/exception_page.css&quot;</span>&#x000A;<span class="line-num">224</span>               <span class="ruby-identifier">js_file</span> <span class="ruby-operator">||=</span> <span class="ruby-node">&quot;#{prefix}/exception_page.js&quot;</span>&#x000A;<span class="line-num">225</span>             <span class="ruby-keyword">end</span>&#x000A;<span class="line-num">226</span> &#x000A;<span class="line-num">227</span>             <span class="ruby-identifier">css</span> = <span class="ruby-keyword">case</span> <span class="ruby-identifier">css_file</span>&#x000A;<span class="line-num">228</span>             <span class="ruby-keyword">when</span> <span class="ruby-keyword">nil</span>&#x000A;<span class="line-num">229</span>               <span class="ruby-node">&quot;&lt;style type=\&quot;text/css\&quot;&gt;#{ExceptionPage.css}&lt;/style&gt;&quot;</span>&#x000A;<span class="line-num">230</span>             <span class="ruby-keyword">when</span> <span class="ruby-keyword">false</span>&#x000A;<span class="line-num">231</span>               <span class="ruby-comment"># :nothing</span>&#x000A;<span class="line-num">232</span>             <span class="ruby-keyword">else</span>&#x000A;<span class="line-num">233</span>               <span class="ruby-node">&quot;&lt;link rel=\&quot;stylesheet\&quot; href=\&quot;#{h css_file}\&quot; /&gt;&quot;</span>&#x000A;<span class="line-num">234</span>             <span class="ruby-keyword">end</span>&#x000A;<span class="line-num">235</span> &#x000A;<span class="line-num">236</span>             <span class="ruby-identifier">js</span> = <span class="ruby-keyword">case</span> <span class="ruby-identifier">js_file</span>&#x000A;<span class="line-num">237</span>             <span class="ruby-keyword">when</span> <span class="ruby-keyword">nil</span>&#x000A;<span class="line-num">238</span>               <span class="ruby-node">&quot;&lt;script type=\&quot;text/javascript\&quot;&gt;\n//&lt;!--\n#{ExceptionPage.js}\n//--&gt;\n&lt;/script&gt;&quot;</span>&#x000A;<span class="line-num">239</span>             <span class="ruby-keyword">when</span> <span class="ruby-keyword">false</span>&#x000A;<span class="line-num">240</span>               <span class="ruby-comment"># :nothing</span>&#x000A;<span class="line-num">241</span>             <span class="ruby-keyword">else</span>&#x000A;<span class="line-num">242</span>               <span class="ruby-node">&quot;&lt;script type=\&quot;text/javascript\&quot; src=\&quot;#{h js_file}\&quot;&gt;&lt;/script&gt;&quot;</span>&#x000A;<span class="line-num">243</span>             <span class="ruby-keyword">end</span>&#x000A;<span class="line-num">244</span> &#x000A;<span class="line-num">245</span>             <span class="ruby-identifier">frames</span> = <span class="ruby-identifier">exception</span>.<span class="ruby-identifier">backtrace</span>.<span class="ruby-identifier">map</span>.<span class="ruby-identifier">with_index</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">line</span>, <span class="ruby-identifier">i</span><span class="ruby-operator">|</span>&#x000A;<span class="line-num">246</span>               <span class="ruby-identifier">frame</span> = {<span class="ruby-value">:id</span><span class="ruby-operator">=&gt;</span><span class="ruby-identifier">i</span>}&#x000A;<span class="line-num">247</span>               <span class="ruby-keyword">if</span> <span class="ruby-identifier">line</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp">/\A(.*?):(\d+)(?::in `(.*)&#39;)?\Z/</span>&#x000A;<span class="line-num">248</span>                 <span class="ruby-identifier">filename</span> = <span class="ruby-identifier">frame</span>[<span class="ruby-value">:filename</span>] = <span class="ruby-node">$1</span>&#x000A;<span class="line-num">249</span>                 <span class="ruby-identifier">lineno</span> = <span class="ruby-identifier">frame</span>[<span class="ruby-value">:lineno</span>] = <span class="ruby-node">$2</span>.<span class="ruby-identifier">to_i</span>&#x000A;<span class="line-num">250</span>                 <span class="ruby-identifier">frame</span>[<span class="ruby-value">:function</span>] = <span class="ruby-node">$3</span>&#x000A;<span class="line-num">251</span> &#x000A;<span class="line-num">252</span>                 <span class="ruby-keyword">begin</span>&#x000A;<span class="line-num">253</span>                   <span class="ruby-identifier">lineno</span> <span class="ruby-operator">-=</span> <span class="ruby-value">1</span>&#x000A;<span class="line-num">254</span>                   <span class="ruby-identifier">lines</span> = <span class="ruby-operator">::</span><span class="ruby-constant">File</span>.<span class="ruby-identifier">readlines</span>(<span class="ruby-identifier">filename</span>)&#x000A;<span class="line-num">255</span>                   <span class="ruby-keyword">if</span> <span class="ruby-identifier">line</span> = <span class="ruby-identifier">lines</span>[<span class="ruby-identifier">lineno</span>]&#x000A;<span class="line-num">256</span>                     <span class="ruby-identifier">pre_lineno</span> = [<span class="ruby-identifier">lineno</span><span class="ruby-operator">-</span><span class="ruby-identifier">context</span>, <span class="ruby-value">0</span>].<span class="ruby-identifier">max</span>&#x000A;<span class="line-num">257</span>                     <span class="ruby-keyword">if</span> (<span class="ruby-identifier">pre_context</span> = <span class="ruby-identifier">lines</span>[<span class="ruby-identifier">pre_lineno</span><span class="ruby-operator">...</span><span class="ruby-identifier">lineno</span>]) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">pre_context</span>.<span class="ruby-identifier">empty?</span>&#x000A;<span class="line-num">258</span>                       <span class="ruby-identifier">frame</span>[<span class="ruby-value">:pre_context_lineno</span>] = <span class="ruby-identifier">pre_lineno</span>&#x000A;<span class="line-num">259</span>                       <span class="ruby-identifier">frame</span>[<span class="ruby-value">:pre_context</span>] = <span class="ruby-identifier">pre_context</span>&#x000A;<span class="line-num">260</span>                     <span class="ruby-keyword">end</span>&#x000A;<span class="line-num">261</span> &#x000A;<span class="line-num">262</span>                     <span class="ruby-identifier">post_lineno</span> = [<span class="ruby-identifier">lineno</span><span class="ruby-operator">+</span><span class="ruby-identifier">context</span>, <span class="ruby-identifier">lines</span>.<span class="ruby-identifier">size</span>].<span class="ruby-identifier">min</span>&#x000A;<span class="line-num">263</span>                     <span class="ruby-keyword">if</span> (<span class="ruby-identifier">post_context</span> = <span class="ruby-identifier">lines</span>[<span class="ruby-identifier">lineno</span><span class="ruby-value">+1</span><span class="ruby-operator">..</span><span class="ruby-identifier">post_lineno</span>]) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">post_context</span>.<span class="ruby-identifier">empty?</span>&#x000A;<span class="line-num">264</span>                       <span class="ruby-identifier">frame</span>[<span class="ruby-value">:post_context_lineno</span>] = <span class="ruby-identifier">post_lineno</span>&#x000A;<span class="line-num">265</span>                       <span class="ruby-identifier">frame</span>[<span class="ruby-value">:post_context</span>] = <span class="ruby-identifier">post_context</span>&#x000A;<span class="line-num">266</span>                     <span class="ruby-keyword">end</span>&#x000A;<span class="line-num">267</span> &#x000A;<span class="line-num">268</span>                     <span class="ruby-identifier">frame</span>[<span class="ruby-value">:context_line</span>] = <span class="ruby-identifier">line</span>.<span class="ruby-identifier">chomp</span>&#x000A;<span class="line-num">269</span>                   <span class="ruby-keyword">end</span>&#x000A;<span class="line-num">270</span>                 <span class="ruby-keyword">rescue</span>&#x000A;<span class="line-num">271</span>                 <span class="ruby-keyword">end</span>&#x000A;<span class="line-num">272</span> &#x000A;<span class="line-num">273</span>                 <span class="ruby-identifier">frame</span>&#x000A;<span class="line-num">274</span>               <span class="ruby-keyword">end</span>&#x000A;<span class="line-num">275</span>             <span class="ruby-keyword">end</span>.<span class="ruby-identifier">compact</span>&#x000A;<span class="line-num">276</span> &#x000A;<span class="line-num">277</span>             <span class="ruby-identifier">r</span> = <span class="ruby-ivar">@_request</span>&#x000A;<span class="line-num">278</span>             <span class="ruby-keyword">begin</span> &#x000A;<span class="line-num">279</span>               <span class="ruby-identifier">post_data</span> = <span class="ruby-identifier">r</span>.<span class="ruby-constant">POST</span>&#x000A;<span class="line-num">280</span>               <span class="ruby-identifier">missing_post</span> = <span class="ruby-string">&quot;No POST data&quot;</span>&#x000A;<span class="line-num">281</span>             <span class="ruby-keyword">rescue</span>&#x000A;<span class="line-num">282</span>               <span class="ruby-identifier">missing_post</span> = <span class="ruby-string">&quot;Invalid POST data&quot;</span>&#x000A;<span class="line-num">283</span>             <span class="ruby-keyword">end</span>&#x000A;<span class="line-num">284</span>             <span class="ruby-identifier">info</span> = <span class="ruby-identifier">lambda</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">title</span>, <span class="ruby-identifier">id</span>, <span class="ruby-identifier">var</span>, <span class="ruby-identifier">none</span><span class="ruby-operator">|</span>&#x000A;<span class="line-num">285</span>               <span class="ruby-identifier">&lt;&lt;END</span>&#x000A;<span class="line-num">286</span> <span class="ruby-value">  &lt;h3 id=&quot;#{id}&quot;&gt;#{title}&lt;/h3&gt;&#x000A;<span class="line-num">287</span>   #{(var &amp;&amp; !var.empty?) ? (&lt;&lt;END1) : &quot;&lt;p&gt;#{none}&lt;/p&gt;&quot;&#x000A;<span class="line-num">288</span>     &lt;table class=&quot;req&quot;&gt;&#x000A;<span class="line-num">289</span>       &lt;thead&gt;&#x000A;<span class="line-num">290</span>         &lt;tr&gt;&#x000A;<span class="line-num">291</span>           &lt;th&gt;Variable&lt;/th&gt;&#x000A;<span class="line-num">292</span>           &lt;th&gt;Value&lt;/th&gt;&#x000A;<span class="line-num">293</span>         &lt;/tr&gt;&#x000A;<span class="line-num">294</span>       &lt;/thead&gt;&#x000A;<span class="line-num">295</span>       &lt;tbody&gt;&#x000A;<span class="line-num">296</span>           #{var.sort_by{|k, _| k.to_s}.map{|key, val| (&lt;&lt;END2)}.join&#x000A;<span class="line-num">297</span>           &lt;tr&gt;&#x000A;<span class="line-num">298</span>             &lt;td&gt;#{h key}&lt;/td&gt;&#x000A;<span class="line-num">299</span>             &lt;td class=&quot;code&quot;&gt;&lt;div&gt;#{h val.inspect}&lt;/div&gt;&lt;/td&gt;&#x000A;<span class="line-num">300</span>           &lt;/tr&gt;&#x000A;<span class="line-num">301</span> END2&#x000A;<span class="line-num">302</span> }&#x000A;<span class="line-num">303</span>       &lt;/tbody&gt;&#x000A;<span class="line-num">304</span>     &lt;/table&gt;&#x000A;<span class="line-num">305</span> END1&#x000A;<span class="line-num">306</span> }&#x000A;<span class="line-num">307</span> </span><span class="ruby-identifier">END</span>&#x000A;<span class="line-num">308</span>             <span class="ruby-keyword">end</span>&#x000A;<span class="line-num">309</span> &#x000A;<span class="line-num">310</span>             <span class="ruby-identifier">&lt;&lt;END</span>&#x000A;<span class="line-num">311</span> <span class="ruby-value">&lt;!DOCTYPE html&gt;&#x000A;<span class="line-num">312</span> &lt;html lang=&quot;en&quot;&gt;&#x000A;<span class="line-num">313</span> &lt;head&gt;&#x000A;<span class="line-num">314</span>   &lt;meta http-equiv=&quot;content-type&quot; content=&quot;text/html; charset=utf-8&quot; /&gt;&#x000A;<span class="line-num">315</span>   &lt;title&gt;#{h exception.class} at #{h r.path}&lt;/title&gt;&#x000A;<span class="line-num">316</span>   #{css}&#x000A;<span class="line-num">317</span> &lt;/head&gt;&#x000A;<span class="line-num">318</span> &lt;body&gt;&#x000A;<span class="line-num">319</span> &#x000A;<span class="line-num">320</span> &lt;div id=&quot;summary&quot;&gt;&#x000A;<span class="line-num">321</span>   &lt;h1&gt;#{h exception.class} at #{h r.path}&lt;/h1&gt;&#x000A;<span class="line-num">322</span>   &lt;h2&gt;#{h exception.message}&lt;/h2&gt;&#x000A;<span class="line-num">323</span>   &lt;table&gt;&lt;tr&gt;&#x000A;<span class="line-num">324</span>     &lt;th&gt;Ruby&lt;/th&gt;&#x000A;<span class="line-num">325</span>     &lt;td&gt;&#x000A;<span class="line-num">326</span> #{(first = frames.first) ? &quot;&lt;code&gt;#{h first[:filename]}&lt;/code&gt;: in &lt;code&gt;#{h first[:function]}&lt;/code&gt;, line #{first[:lineno]}&quot; : &quot;unknown location&quot;}&#x000A;<span class="line-num">327</span>     &lt;/td&gt;&#x000A;<span class="line-num">328</span>   &lt;/tr&gt;&lt;tr&gt;&#x000A;<span class="line-num">329</span>     &lt;th&gt;Web&lt;/th&gt;&#x000A;<span class="line-num">330</span>     &lt;td&gt;&lt;code&gt;#{r.request_method} #{h r.host}#{h r.path}&lt;/code&gt;&lt;/td&gt;&#x000A;<span class="line-num">331</span>   &lt;/tr&gt;&lt;/table&gt;&#x000A;<span class="line-num">332</span> &#x000A;<span class="line-num">333</span>   &lt;h3&gt;Jump to:&lt;/h3&gt;&#x000A;<span class="line-num">334</span>   &lt;ul id=&quot;quicklinks&quot;&gt;&#x000A;<span class="line-num">335</span>     &lt;li&gt;&lt;a href=&quot;#get-info&quot;&gt;GET&lt;/a&gt;&lt;/li&gt;&#x000A;<span class="line-num">336</span>     &lt;li&gt;&lt;a href=&quot;#post-info&quot;&gt;POST&lt;/a&gt;&lt;/li&gt;&#x000A;<span class="line-num">337</span>     &lt;li&gt;&lt;a href=&quot;#cookie-info&quot;&gt;Cookies&lt;/a&gt;&lt;/li&gt;&#x000A;<span class="line-num">338</span>     &lt;li&gt;&lt;a href=&quot;#env-info&quot;&gt;ENV&lt;/a&gt;&lt;/li&gt;&#x000A;<span class="line-num">339</span>   &lt;/ul&gt;&#x000A;<span class="line-num">340</span> &lt;/div&gt;&#x000A;<span class="line-num">341</span> &#x000A;<span class="line-num">342</span> &lt;div id=&quot;traceback&quot;&gt;&#x000A;<span class="line-num">343</span>   &lt;h2&gt;Traceback &lt;span&gt;(innermost first)&lt;/span&gt;&lt;/h2&gt;&#x000A;<span class="line-num">344</span>   &lt;ul class=&quot;traceback&quot;&gt;&#x000A;<span class="line-num">345</span> #{frames.map{|frame| id = frame[:id]; (&lt;&lt;END1)}.join&#x000A;<span class="line-num">346</span>       &lt;li class=&quot;frame&quot;&gt;&#x000A;<span class="line-num">347</span>         &lt;code&gt;#{h frame[:filename]}:#{frame[:lineno]}&lt;/code&gt; in &lt;code&gt;#{h frame[:function]}&lt;/code&gt;&#x000A;<span class="line-num">348</span> &#x000A;<span class="line-num">349</span>           #{frame[:context_line] ? (&lt;&lt;END2) : &#39;&lt;/li&gt;&#39;&#x000A;<span class="line-num">350</span>           &lt;div class=&quot;context&quot; id=&quot;c#{id}&quot;&gt;&#x000A;<span class="line-num">351</span>             #{frame[:pre_context] ? (&lt;&lt;END3) : &#39;&#39;&#x000A;<span class="line-num">352</span>             &lt;ol start=&quot;#{frame[:pre_context_lineno]+1}&quot; id=&quot;bc#{id}&quot;&gt;&#x000A;<span class="line-num">353</span>               #{frame[:pre_context].map{|line| &quot;&lt;li&gt;#{h line}&lt;/li&gt;&quot;}.join}&#x000A;<span class="line-num">354</span>             &lt;/ol&gt;&#x000A;<span class="line-num">355</span> END3&#x000A;<span class="line-num">356</span> }&#x000A;<span class="line-num">357</span> &#x000A;<span class="line-num">358</span>             &lt;ol start=&quot;#{frame[:lineno]}&quot; class=&quot;context-line&quot;&gt;&#x000A;<span class="line-num">359</span>               &lt;li&gt;#{h frame[:context_line]}&lt;span&gt;...&lt;/span&gt;&lt;/li&gt;&#x000A;<span class="line-num">360</span>             &lt;/ol&gt;&#x000A;<span class="line-num">361</span> &#x000A;<span class="line-num">362</span>             #{frame[:post_context] ? (&lt;&lt;END4) : &#39;&#39;&#x000A;<span class="line-num">363</span>             &lt;ol start=&#39;#{frame[:lineno]+1}&#39; id=&quot;ac#{id}&quot;&gt;&#x000A;<span class="line-num">364</span>               #{frame[:post_context].map{|line| &quot;&lt;li&gt;#{h line}&lt;/li&gt;&quot;}.join}&#x000A;<span class="line-num">365</span>             &lt;/ol&gt;&#x000A;<span class="line-num">366</span> END4&#x000A;<span class="line-num">367</span> }&#x000A;<span class="line-num">368</span>           &lt;/div&gt;&#x000A;<span class="line-num">369</span> END2&#x000A;<span class="line-num">370</span> }&#x000A;<span class="line-num">371</span> END1&#x000A;<span class="line-num">372</span> }&#x000A;<span class="line-num">373</span>   &lt;/ul&gt;&#x000A;<span class="line-num">374</span> &lt;/div&gt;&#x000A;<span class="line-num">375</span> &#x000A;<span class="line-num">376</span> &lt;div id=&quot;requestinfo&quot;&gt;&#x000A;<span class="line-num">377</span>   &lt;h2&gt;Request information&lt;/h2&gt;&#x000A;<span class="line-num">378</span> &#x000A;<span class="line-num">379</span>   #{info.call(&#39;GET&#39;, &#39;get-info&#39;, r.GET, &#39;No GET data&#39;)}&#x000A;<span class="line-num">380</span>   #{info.call(&#39;POST&#39;, &#39;post-info&#39;, post_data, missing_post)}&#x000A;<span class="line-num">381</span>   #{info.call(&#39;Cookies&#39;, &#39;cookie-info&#39;, r.cookies, &#39;No cookie data&#39;)}&#x000A;<span class="line-num">382</span>   #{info.call(&#39;Rack ENV&#39;, &#39;env-info&#39;, r.env, &#39;No Rack env?&#39;)}&#x000A;<span class="line-num">383</span> &lt;/div&gt;&#x000A;<span class="line-num">384</span> &#x000A;<span class="line-num">385</span> &lt;div id=&quot;explanation&quot;&gt;&#x000A;<span class="line-num">386</span>   &lt;p&gt;&#x000A;<span class="line-num">387</span>     You&#39;re seeing this error because you use the Roda exception_page plugin.&#x000A;<span class="line-num">388</span>   &lt;/p&gt;&#x000A;<span class="line-num">389</span> &lt;/div&gt;&#x000A;<span class="line-num">390</span> &#x000A;<span class="line-num">391</span> #{js}&#x000A;<span class="line-num">392</span> &lt;/body&gt;&#x000A;<span class="line-num">393</span> &lt;/html&gt;&#x000A;<span class="line-num">394</span> </span><span class="ruby-identifier">END</span>&#x000A;<span class="line-num">395</span>           <span class="ruby-keyword">else</span>&#x000A;<span class="line-num">396</span>             <span class="ruby-ivar">@_response</span>[<span class="ruby-string">&#39;Content-Type&#39;</span>] = <span class="ruby-string">&quot;text/plain&quot;</span>&#x000A;<span class="line-num">397</span>             <span class="ruby-node">&quot;#{exception.class}: #{exception.message}\n#{exception.backtrace.map{|l| &quot;\t#{l}&quot;}.join(&quot;\n&quot;)}&quot;</span>&#x000A;<span class="line-num">398</span>           <span class="ruby-keyword">end</span>&#x000A;<span class="line-num">399</span>         <span class="ruby-keyword">end</span></pre>
</div>
</div>
</div>
</div>

</div>
</div>

<div id='footer-push'></div>
</div>
<div id='footer'>
<a href="https://github.com/rdoc/hanna-nouveau"><strong>Hanna Nouveau</strong> RDoc template</a>
</div>
</body>
</html>
