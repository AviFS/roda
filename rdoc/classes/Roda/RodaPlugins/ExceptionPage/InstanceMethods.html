<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html lang='en'>
<head>
<title>Roda::RodaPlugins::ExceptionPage::InstanceMethods</title>
<meta content='text/html; charset=UTF-8' http-equiv='Content-Type'>
<link href='../../../../css/style.css' media='screen' rel='stylesheet' type='text/css'>
<script type='text/javascript'>
  function popupCode(url) {
    window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
  }
  
  function toggleCode(id) {
    var code = document.getElementById(id)
  
    code.style.display = code.style.display != 'block' ? 'block' : 'none'
    return true
  }
  
  // Make codeblocks hidden by default
  document.writeln('<' + 'style type="text/css">.method .source pre { display: none }<\/style>')
</script>
</head>
<body class='page'>
<div class='class' id='wrapper'>
<div class='header'>
<h1 class='name'><span class='type'>module</span>
Roda::RodaPlugins::ExceptionPage::InstanceMethods
</h1>
<ol class='paths'>
<li>
<a href="../../../../files/lib/roda/plugins/exception_page_rb.html">lib/roda/plugins/exception_page.rb</a>
</li>
</ol>
</div>
<div id='content'>
<div id='text'>
<div id='description'></div>
<div id='method-list'>
<h2>Methods</h2>
<h3>Public Instance</h3>
<ol>
<li><a href="#method-i-exception_page">exception_page</a></li>
</ol>
</div>
<div id='context'>
</div>
<div id='section'>
<div id='methods'>
<h2>Public Instance methods</h2>
<div class='method public-instance' id='method-method-i-exception_page'>
<a name='method-i-exception_page'></a>
<div class='synopsis'>
<span class='name'>exception_page</span>
<span class='arguments'>(exception, opts=OPTS)</span>

</div>
<div class='description'>

<p>Return a HTML page showing the exception, allowing a developer more
information for debugging.  Designed to be called inside an exception
handler, passing in the received exception. Sets the Content-Type header in
the response, and returns the string used for the body.  If the Accept
request header is present and text/html is accepted, return an HTML page
with the backtrace with the ability to see the context for each backtrace
line, as well as the GET, POST, cookie, and rack environment data.  If
text/html is not accepted, then just show a plain text page with the
exception class, message, and backtrace.</p>

<p>Options:</p>
<table class="rdoc-list note-list"><tbody><tr><td class='label'>:assets </td><td>
<p>If <code>true</code>, sets :css_file to <code>/exception_page.css</code>
and :js_file to <code>/exception_page.js</code>, assuming that
<code>r.exception_page_assets</code> is called in the route block to serve
the exception page assets.  If a String, uses the string as a prefix,
assuming that <code>r.exception_page_assets</code> is called in a nested
block inside the route block. If false, doesn&#39;t use any CSS or JS.</p>
</td></tr><tr><td class='label'>:context </td><td>
<p>The number of context lines before and after each line in the backtrace
(default: 7).</p>
</td></tr><tr><td class='label'>:css_file </td><td>
<p>A path to the external CSS file for the HTML exception page. If false,
doesn&#39;t use any CSS.</p>
</td></tr><tr><td class='label'>:js_file </td><td>
<p>A path to the external javascript file for the HTML exception page. If
false, doesn&#39;t use any JS.</p>
</td></tr><tr><td class='label'>:json </td><td>
<p>Return a hash of exception information.  The hash will have a single key,
“exception”, with a value being a hash with three keys, “class”, “message”,
and “backtrace”, which contain information derived from the given
exception. Designed to be used with the <code>json</code> exception, which
will automatically convert the hash to JSON format.</p>
</td></tr></tbody></table>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-exception_page-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-exception_page-source'><span class="ruby-comment"># File lib/roda/plugins/exception_page.rb, line 197</span>&#x000A;        <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">exception_page</span>(<span class="ruby-identifier">exception</span>, <span class="ruby-identifier">opts</span>=<span class="ruby-constant">OPTS</span>)&#x000A;          <span class="ruby-keyword">if</span> <span class="ruby-identifier">opts</span>[<span class="ruby-value">:json</span>]&#x000A;            <span class="ruby-ivar">@_response</span>[<span class="ruby-string">&#39;Content-Type&#39;</span>] = <span class="ruby-string">&quot;application/json&quot;</span>&#x000A;            {&#x000A;              <span class="ruby-string">&quot;exception&quot;</span><span class="ruby-operator">=&gt;</span>{&#x000A;                <span class="ruby-string">&quot;class&quot;</span><span class="ruby-operator">=&gt;</span><span class="ruby-identifier">exception</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">to_s</span>,&#x000A;                <span class="ruby-string">&quot;message&quot;</span><span class="ruby-operator">=&gt;</span><span class="ruby-identifier">exception</span>.<span class="ruby-identifier">message</span>.<span class="ruby-identifier">to_s</span>,&#x000A;                <span class="ruby-string">&quot;backtrace&quot;</span><span class="ruby-operator">=&gt;</span><span class="ruby-identifier">exception</span>.<span class="ruby-identifier">backtrace</span>.<span class="ruby-identifier">map</span>(<span class="ruby-operator">&amp;</span><span class="ruby-value">:to_s</span>)&#x000A;              }&#x000A;            }&#x000A;          <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">env</span>[<span class="ruby-string">&#39;HTTP_ACCEPT&#39;</span>] <span class="ruby-operator">=~</span> <span class="ruby-regexp">/text\/html/</span>&#x000A;            <span class="ruby-ivar">@_response</span>[<span class="ruby-string">&#39;Content-Type&#39;</span>] = <span class="ruby-string">&quot;text/html&quot;</span>&#x000A;&#x000A;            <span class="ruby-identifier">context</span> = <span class="ruby-identifier">opts</span>[<span class="ruby-value">:context</span>] <span class="ruby-operator">||</span> <span class="ruby-value">7</span>&#x000A;            <span class="ruby-identifier">css_file</span> = <span class="ruby-identifier">opts</span>[<span class="ruby-value">:css_file</span>]&#x000A;            <span class="ruby-identifier">js_file</span> = <span class="ruby-identifier">opts</span>[<span class="ruby-value">:js_file</span>]&#x000A;&#x000A;            <span class="ruby-keyword">case</span> <span class="ruby-identifier">prefix</span> = <span class="ruby-identifier">opts</span>[<span class="ruby-value">:assets</span>]&#x000A;            <span class="ruby-keyword">when</span> <span class="ruby-keyword">false</span>&#x000A;              <span class="ruby-identifier">css_file</span> = <span class="ruby-keyword">false</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">css_file</span>.<span class="ruby-identifier">nil?</span>&#x000A;              <span class="ruby-identifier">js_file</span> = <span class="ruby-keyword">false</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">js_file</span>.<span class="ruby-identifier">nil?</span>&#x000A;            <span class="ruby-keyword">when</span> <span class="ruby-keyword">nil</span>&#x000A;              <span class="ruby-comment"># nothing</span>&#x000A;            <span class="ruby-keyword">else</span>&#x000A;              <span class="ruby-identifier">prefix</span> = <span class="ruby-string">&#39;&#39;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">prefix</span> <span class="ruby-operator">==</span> <span class="ruby-keyword">true</span>&#x000A;              <span class="ruby-identifier">css_file</span> <span class="ruby-operator">||=</span> <span class="ruby-node">&quot;#{prefix}/exception_page.css&quot;</span>&#x000A;              <span class="ruby-identifier">js_file</span> <span class="ruby-operator">||=</span> <span class="ruby-node">&quot;#{prefix}/exception_page.js&quot;</span>&#x000A;            <span class="ruby-keyword">end</span>&#x000A;&#x000A;            <span class="ruby-identifier">css</span> = <span class="ruby-keyword">case</span> <span class="ruby-identifier">css_file</span>&#x000A;            <span class="ruby-keyword">when</span> <span class="ruby-keyword">nil</span>&#x000A;              <span class="ruby-node">&quot;&lt;style type=\&quot;text/css\&quot;&gt;#{ExceptionPage.css}&lt;/style&gt;&quot;</span>&#x000A;            <span class="ruby-keyword">when</span> <span class="ruby-keyword">false</span>&#x000A;              <span class="ruby-comment"># :nothing</span>&#x000A;            <span class="ruby-keyword">else</span>&#x000A;              <span class="ruby-node">&quot;&lt;link rel=\&quot;stylesheet\&quot; href=\&quot;#{h css_file}\&quot; /&gt;&quot;</span>&#x000A;            <span class="ruby-keyword">end</span>&#x000A;&#x000A;            <span class="ruby-identifier">js</span> = <span class="ruby-keyword">case</span> <span class="ruby-identifier">js_file</span>&#x000A;            <span class="ruby-keyword">when</span> <span class="ruby-keyword">nil</span>&#x000A;              <span class="ruby-node">&quot;&lt;script type=\&quot;text/javascript\&quot;&gt;\n//&lt;!--\n#{ExceptionPage.js}\n//--&gt;\n&lt;/script&gt;&quot;</span>&#x000A;            <span class="ruby-keyword">when</span> <span class="ruby-keyword">false</span>&#x000A;              <span class="ruby-comment"># :nothing</span>&#x000A;            <span class="ruby-keyword">else</span>&#x000A;              <span class="ruby-node">&quot;&lt;script type=\&quot;text/javascript\&quot; src=\&quot;#{h js_file}\&quot;&gt;&lt;/script&gt;&quot;</span>&#x000A;            <span class="ruby-keyword">end</span>&#x000A;&#x000A;            <span class="ruby-identifier">frames</span> = <span class="ruby-identifier">exception</span>.<span class="ruby-identifier">backtrace</span>.<span class="ruby-identifier">map</span>.<span class="ruby-identifier">with_index</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">line</span>, <span class="ruby-identifier">i</span><span class="ruby-operator">|</span>&#x000A;              <span class="ruby-identifier">frame</span> = {<span class="ruby-value">:id</span><span class="ruby-operator">=&gt;</span><span class="ruby-identifier">i</span>}&#x000A;              <span class="ruby-keyword">if</span> <span class="ruby-identifier">line</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp">/(.*?):(\d+)(:in `(.*)&#39;)?/</span>&#x000A;                <span class="ruby-identifier">filename</span> = <span class="ruby-identifier">frame</span>[<span class="ruby-value">:filename</span>] = <span class="ruby-node">$1</span>&#x000A;                <span class="ruby-identifier">lineno</span> = <span class="ruby-identifier">frame</span>[<span class="ruby-value">:lineno</span>] = <span class="ruby-node">$2</span>.<span class="ruby-identifier">to_i</span>&#x000A;                <span class="ruby-identifier">frame</span>[<span class="ruby-value">:function</span>] = <span class="ruby-node">$4</span>&#x000A;&#x000A;                <span class="ruby-keyword">begin</span>&#x000A;                  <span class="ruby-identifier">lineno</span> <span class="ruby-operator">-=</span> <span class="ruby-value">1</span>&#x000A;                  <span class="ruby-identifier">lines</span> = <span class="ruby-operator">::</span><span class="ruby-constant">File</span>.<span class="ruby-identifier">readlines</span>(<span class="ruby-identifier">filename</span>)&#x000A;                  <span class="ruby-identifier">pre_lineno</span> = <span class="ruby-identifier">frame</span>[<span class="ruby-value">:pre_context_lineno</span>] = [<span class="ruby-identifier">lineno</span><span class="ruby-operator">-</span><span class="ruby-identifier">context</span>, <span class="ruby-value">0</span>].<span class="ruby-identifier">max</span>&#x000A;                  <span class="ruby-identifier">frame</span>[<span class="ruby-value">:pre_context</span>] = <span class="ruby-identifier">lines</span>[<span class="ruby-identifier">pre_lineno</span><span class="ruby-operator">...</span><span class="ruby-identifier">lineno</span>]&#x000A;                  <span class="ruby-identifier">frame</span>[<span class="ruby-value">:context_line</span>] = <span class="ruby-identifier">lines</span>[<span class="ruby-identifier">lineno</span>].<span class="ruby-identifier">chomp</span>&#x000A;                  <span class="ruby-identifier">post_lineno</span> = <span class="ruby-identifier">frame</span>[<span class="ruby-value">:post_context_lineno</span>] = [<span class="ruby-identifier">lineno</span><span class="ruby-operator">+</span><span class="ruby-identifier">context</span>, <span class="ruby-identifier">lines</span>.<span class="ruby-identifier">size</span>].<span class="ruby-identifier">min</span>&#x000A;                  <span class="ruby-identifier">frame</span>[<span class="ruby-value">:post_context</span>] = <span class="ruby-identifier">lines</span>[<span class="ruby-identifier">lineno</span><span class="ruby-value">+1</span><span class="ruby-operator">..</span><span class="ruby-identifier">post_lineno</span>]&#x000A;                <span class="ruby-keyword">rescue</span>&#x000A;                <span class="ruby-keyword">end</span>&#x000A;&#x000A;                <span class="ruby-identifier">frame</span>&#x000A;              <span class="ruby-keyword">else</span>&#x000A;                <span class="ruby-keyword">nil</span>&#x000A;              <span class="ruby-keyword">end</span>&#x000A;            <span class="ruby-keyword">end</span>.<span class="ruby-identifier">compact</span>&#x000A;&#x000A;            <span class="ruby-identifier">r</span> = <span class="ruby-ivar">@_request</span>&#x000A;            <span class="ruby-identifier">info</span> = <span class="ruby-identifier">lambda</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">title</span>, <span class="ruby-identifier">id</span>, <span class="ruby-identifier">var</span>, <span class="ruby-identifier">none</span><span class="ruby-operator">|</span>&#x000A;              <span class="ruby-identifier">&lt;&lt;END</span>&#x000A;<span class="ruby-value">  &lt;h3 id=&quot;#{id}&quot;&gt;#{title}&lt;/h3&gt;&#x000A;  #{(var &amp;&amp; !var.empty?) ? (&lt;&lt;END1) : &quot;&lt;p&gt;#{none}&lt;/p&gt;&quot;&#x000A;    &lt;table class=&quot;req&quot;&gt;&#x000A;      &lt;thead&gt;&#x000A;        &lt;tr&gt;&#x000A;          &lt;th&gt;Variable&lt;/th&gt;&#x000A;          &lt;th&gt;Value&lt;/th&gt;&#x000A;        &lt;/tr&gt;&#x000A;      &lt;/thead&gt;&#x000A;      &lt;tbody&gt;&#x000A;          #{var.sort_by{|k, _| k.to_s}.map{|key, val| (&lt;&lt;END2)}.join&#x000A;          &lt;tr&gt;&#x000A;            &lt;td&gt;#{h key}&lt;/td&gt;&#x000A;            &lt;td class=&quot;code&quot;&gt;&lt;div&gt;#{h val.inspect}&lt;/div&gt;&lt;/td&gt;&#x000A;          &lt;/tr&gt;&#x000A;END2&#x000A;}&#x000A;      &lt;/tbody&gt;&#x000A;    &lt;/table&gt;&#x000A;END1&#x000A;}&#x000A;</span><span class="ruby-identifier">END</span>&#x000A;            <span class="ruby-keyword">end</span>&#x000A;&#x000A;            <span class="ruby-identifier">&lt;&lt;END</span>&#x000A;<span class="ruby-value">&lt;!DOCTYPE html&gt;&#x000A;&lt;html lang=&quot;en&quot;&gt;&#x000A;&lt;head&gt;&#x000A;  &lt;meta http-equiv=&quot;content-type&quot; content=&quot;text/html; charset=utf-8&quot; /&gt;&#x000A;  &lt;title&gt;#{h exception.class} at #{h r.path}&lt;/title&gt;&#x000A;  #{css}&#x000A;&lt;/head&gt;&#x000A;&lt;body&gt;&#x000A;&#x000A;&lt;div id=&quot;summary&quot;&gt;&#x000A;  &lt;h1&gt;#{h exception.class} at #{h r.path}&lt;/h1&gt;&#x000A;  &lt;h2&gt;#{h exception.message}&lt;/h2&gt;&#x000A;  &lt;table&gt;&lt;tr&gt;&#x000A;    &lt;th&gt;Ruby&lt;/th&gt;&#x000A;    &lt;td&gt;&#x000A;#{(first = frames.first) ? &quot;&lt;code&gt;#{h first[:filename]}&lt;/code&gt;: in &lt;code&gt;#{h first[:function]}&lt;/code&gt;, line #{first[:lineno]}&quot; : &quot;unknown location&quot;}&#x000A;    &lt;/td&gt;&#x000A;  &lt;/tr&gt;&lt;tr&gt;&#x000A;    &lt;th&gt;Web&lt;/th&gt;&#x000A;    &lt;td&gt;&lt;code&gt;#{r.request_method} #{h r.host}#{h r.path}&lt;/code&gt;&lt;/td&gt;&#x000A;  &lt;/tr&gt;&lt;/table&gt;&#x000A;&#x000A;  &lt;h3&gt;Jump to:&lt;/h3&gt;&#x000A;  &lt;ul id=&quot;quicklinks&quot;&gt;&#x000A;    &lt;li&gt;&lt;a href=&quot;#get-info&quot;&gt;GET&lt;/a&gt;&lt;/li&gt;&#x000A;    &lt;li&gt;&lt;a href=&quot;#post-info&quot;&gt;POST&lt;/a&gt;&lt;/li&gt;&#x000A;    &lt;li&gt;&lt;a href=&quot;#cookie-info&quot;&gt;Cookies&lt;/a&gt;&lt;/li&gt;&#x000A;    &lt;li&gt;&lt;a href=&quot;#env-info&quot;&gt;ENV&lt;/a&gt;&lt;/li&gt;&#x000A;  &lt;/ul&gt;&#x000A;&lt;/div&gt;&#x000A;&#x000A;&lt;div id=&quot;traceback&quot;&gt;&#x000A;  &lt;h2&gt;Traceback &lt;span&gt;(innermost first)&lt;/span&gt;&lt;/h2&gt;&#x000A;  &lt;ul class=&quot;traceback&quot;&gt;&#x000A;#{frames.map{|frame| id = frame[:id]; (&lt;&lt;END1)}.join&#x000A;      &lt;li class=&quot;frame&quot;&gt;&#x000A;        &lt;code&gt;#{h frame[:filename]}&lt;/code&gt;: in &lt;code&gt;#{h frame[:function]}&lt;/code&gt;&#x000A;&#x000A;          #{frame[:context_line] ? (&lt;&lt;END2) : &#39;&lt;/li&gt;&#39;&#x000A;          &lt;div class=&quot;context&quot; id=&quot;c#{id}&quot;&gt;&#x000A;            #{frame[:pre_context] ? (&lt;&lt;END3) : &#39;&#39;&#x000A;            &lt;ol start=&quot;#{frame[:pre_context_lineno]+1}&quot; id=&quot;bc#{id}&quot;&gt;&#x000A;              #{frame[:pre_context].map{|line| &quot;&lt;li&gt;#{h line}&lt;/li&gt;&quot;}.join}&#x000A;            &lt;/ol&gt;&#x000A;END3&#x000A;}&#x000A;&#x000A;            &lt;ol start=&quot;#{frame[:lineno]}&quot; class=&quot;context-line&quot;&gt;&#x000A;              &lt;li&gt;#{h frame[:context_line]}&lt;span&gt;...&lt;/span&gt;&lt;/li&gt;&#x000A;            &lt;/ol&gt;&#x000A;&#x000A;            #{frame[:post_context] ? (&lt;&lt;END4) : &#39;&#39;&#x000A;            &lt;ol start=&#39;#{frame[:lineno]+1}&#39; id=&quot;ac#{id}&quot;&gt;&#x000A;              #{frame[:post_context].map{|line| &quot;&lt;li&gt;#{h line}&lt;/li&gt;&quot;}.join}&#x000A;            &lt;/ol&gt;&#x000A;END4&#x000A;}&#x000A;          &lt;/div&gt;&#x000A;END2&#x000A;}&#x000A;END1&#x000A;}&#x000A;  &lt;/ul&gt;&#x000A;&lt;/div&gt;&#x000A;&#x000A;&lt;div id=&quot;requestinfo&quot;&gt;&#x000A;  &lt;h2&gt;Request information&lt;/h2&gt;&#x000A;&#x000A;  #{info.call(&#39;GET&#39;, &#39;get-info&#39;, r.GET, &#39;No GET data&#39;)}&#x000A;  #{info.call(&#39;POST&#39;, &#39;post-info&#39;, r.POST, &#39;No POST data&#39;)}&#x000A;  #{info.call(&#39;Cookies&#39;, &#39;cookie-info&#39;, r.cookies, &#39;No cookie data&#39;)}&#x000A;  #{info.call(&#39;Rack ENV&#39;, &#39;env-info&#39;, r.env, &#39;No Rack env?&#39;)}&#x000A;&lt;/div&gt;&#x000A;&#x000A;&lt;div id=&quot;explanation&quot;&gt;&#x000A;  &lt;p&gt;&#x000A;    You&#39;re seeing this error because you use the Roda exception_page plugin.&#x000A;  &lt;/p&gt;&#x000A;&lt;/div&gt;&#x000A;&#x000A;#{js}&#x000A;&lt;/body&gt;&#x000A;&lt;/html&gt;&#x000A;</span><span class="ruby-identifier">END</span>&#x000A;          <span class="ruby-keyword">else</span>&#x000A;            <span class="ruby-ivar">@_response</span>[<span class="ruby-string">&#39;Content-Type&#39;</span>] = <span class="ruby-string">&quot;text/plain&quot;</span>&#x000A;            <span class="ruby-node">&quot;#{exception.class}: #{exception.message}\n#{exception.backtrace.map{|l| &quot;\t#{l}&quot;}.join(&quot;\n&quot;)}&quot;</span>&#x000A;          <span class="ruby-keyword">end</span>&#x000A;        <span class="ruby-keyword">end</span></pre>
</div>
</div>
</div>
</div>

</div>
</div>

<div id='footer-push'></div>
</div>
<div id='footer'>
<a href="https://github.com/rdoc/hanna-nouveau"><strong>Hanna Nouveau</strong> RDoc template</a>
</div>
</body>
</html>
