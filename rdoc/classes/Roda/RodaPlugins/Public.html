<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html lang='en'>
<head>
<title>Roda::RodaPlugins::Public</title>
<meta name='viewport' content='width=device-width, initial-scale=1'>
<meta content='text/html; charset=UTF-8' http-equiv='Content-Type'>
<link href='../../../css/style.css' media='screen' rel='stylesheet' type='text/css'>
<script type='text/javascript'>
  function popupCode(url) {
    window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
  }
  
  function toggleCode(id) {
    var code = document.getElementById(id)
  
    code.style.display = code.style.display != 'block' ? 'block' : 'none'
    return true
  }
  
  // Make codeblocks hidden by default
  document.writeln('<' + 'style type="text/css">.method .source pre { display: none }<\/style>')
</script>
</head>
<body class='page'>
<div class='class' id='wrapper'>
<div class='header'>
<h1 class='name'><span class='type'>module</span>
Roda::RodaPlugins::Public
</h1>
<ol class='paths'>
<li>
<a href="../../../files/lib/roda/plugins/public_rb.html">lib/roda/plugins/public.rb</a>
</li>
</ol>
</div>
<div id='content'>
<div id='text'>
<div id='description'>
<p>The public plugin adds a <code>r.public</code> routing method to serve static files from a directory.</p>

<p>The public plugin recognizes the application’s :root option, and defaults to using the <code>public</code> subfolder of the application’s <code>:root</code> option.  If the application’s :root option is not set, it defaults to the <code>public</code> folder in the working directory.  Additionally, if a relative path is provided as the <code>:root</code> option to the plugin, it will be considered relative to the application’s <code>:root</code> option.</p>

<p>Examples:</p>

<pre class="ruby"><span class="ruby-comment"># Use public folder as location of files</span>
<span class="ruby-identifier">plugin</span> <span class="ruby-value">:public</span>

<span class="ruby-comment"># Use /path/to/app/static as location of files</span>
<span class="ruby-identifier">opts</span>[<span class="ruby-value">:root</span>] = <span class="ruby-string">&#39;/path/to/app&#39;</span>
<span class="ruby-identifier">plugin</span> <span class="ruby-value">:public</span>, <span class="ruby-value">root:</span> <span class="ruby-string">&#39;static&#39;</span>

<span class="ruby-comment"># Assuming public is the location of files</span>
<span class="ruby-identifier">route</span> <span class="ruby-keyword">do</span>
  <span class="ruby-comment"># Make GET /images/foo.png look for public/images/foo.png</span>
  <span class="ruby-identifier">r</span>.<span class="ruby-identifier">public</span>

  <span class="ruby-comment"># Make GET /static/images/foo.png look for public/images/foo.png</span>
  <span class="ruby-identifier">r</span>.<span class="ruby-identifier">on</span>(<span class="ruby-value">:static</span>) <span class="ruby-keyword">do</span>
    <span class="ruby-identifier">r</span>.<span class="ruby-identifier">public</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span>
</pre>
</div>
<div id='method-list'>
<h2>Methods</h2>
<h3>Public Class</h3>
<ol>
<li><a href="#method-c-configure">configure</a></li>
</ol>
</div>
<div id='context'>
</div>
<div id='class-list'>
<h2>Classes and Modules</h2>
<ol>
<li><a href="Public/RequestMethods.html">Roda::RodaPlugins::Public::RequestMethods</a></li>
</ol>
</div>
<div id='section'>
<div id='constants-list'>
<h2>Constants</h2>
<div class='name-list'>
<table summary='Constants'>
<tr class='top-aligned-row context-row'>
<td class='context-item-name'>ENCODING_EXTENSIONS</td>
<td>=</td>
<td class='context-item-value'>{'br'=>'.br', 'gzip'=>'.gz', 'zstd'=>'.zst'}.freeze</td>
<td>&nbsp;</td>
<td class='context-item-desc'></td>
</tr>
<tr class='top-aligned-row context-row'>
<td class='context-item-name'>ENCODING_MAP</td>
<td>=</td>
<td class='context-item-value'>{:zstd=>'zstd', :brotli=>'br', :gzip=>'gzip'}.freeze</td>
<td>&nbsp;</td>
<td class='context-item-desc'></td>
</tr>
<tr class='top-aligned-row context-row'>
<td class='context-item-name'>MATCH_METHOD</td>
<td>=</td>
<td class='context-item-value'>RUBY_VERSION >= '2.4' ? :match? : :match</td>
<td>&nbsp;</td>
<td class='context-item-desc'></td>
</tr>
<tr class='top-aligned-row context-row'>
<td class='context-item-name'>PARSER</td>
<td>=</td>
<td class='context-item-value'>defined?(::URI::RFC2396_PARSER) ? ::URI::RFC2396_PARSER : ::URI::DEFAULT_PARSER</td>
<td>&nbsp;</td>
<td class='context-item-desc'>
<p>:nocov:</p>
</td>
</tr>
<tr class='top-aligned-row context-row'>
<td class='context-item-name'>RACK_FILES</td>
<td>=</td>
<td class='context-item-value'>defined?(Rack::Files) ? Rack::Files : Rack::File</td>
<td>&nbsp;</td>
<td class='context-item-desc'></td>
</tr>
<tr class='top-aligned-row context-row'>
<td class='context-item-name'>SPLIT</td>
<td>=</td>
<td class='context-item-value'>Regexp.union(*[File::SEPARATOR, File::ALT_SEPARATOR].compact)</td>
<td>&nbsp;</td>
<td class='context-item-desc'></td>
</tr>
</table>
</div>
</div>
<div id='methods'>
<h2>Public Class methods</h2>
<div class='method public-class' id='method-method-c-configure'>
<a name='method-c-configure'></a>
<div class='synopsis'>
<span class='name'>configure</span><span class='arguments'>(app, opts={})</span>

</div>
<div class='description'>

<p>Use options given to setup a Rack::File instance for serving files. Options:</p>
<table class="rdoc-list note-list"><tbody><tr><td class='label'>:brotli </td><td>
<p>Whether to serve already brotli-compressed files with a .br extension for clients supporting “br” transfer encoding.</p>
</td></tr><tr><td class='label'>:default_mime </td><td>
<p>The default mime type to use if the mime type is not recognized.</p>
</td></tr><tr><td class='label'>:encodings </td><td>
<p>An enumerable of pairs to handle accepted encodings.  The first element of the pair is the accepted encoding name (e.g. ‘gzip’), and the second element of the pair is the file extension (e.g. ‘.gz’). This allows configuration of the order in which encodings are tried, to prefer brotli to zstd for example, or to support encodings other than zstd, brotli, and gzip. This takes precedence over the :brotli, :gzip, and :zstd options if given.</p>
</td></tr><tr><td class='label'>:gzip </td><td>
<p>Whether to serve already gzipped files with a .gz extension for clients supporting “gzip” transfer encoding.</p>
</td></tr><tr><td class='label'>:headers </td><td>
<p>A hash of headers to use for statically served files</p>
</td></tr><tr><td class='label'>:root </td><td>
<p>Use this option for the root of the public directory (default: “public”)</p>
</td></tr><tr><td class='label'>:zstd </td><td>
<p>Whether to serve already zstd-compressed files with a .zst extension for clients supporting “zstd” transfer encoding.</p>
</td></tr></tbody></table>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-c-configure-source&#39;); return false'>
[show source]
</a>
<pre id='method-c-configure-source'>   <span class="ruby-comment"># File lib/roda/plugins/public.rb</span>
<span class="line-num">71</span> <span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier ruby-title">configure</span>(<span class="ruby-identifier">app</span>, <span class="ruby-identifier">opts</span>={})
<span class="line-num">72</span>   <span class="ruby-keyword">if</span> <span class="ruby-identifier">opts</span>[<span class="ruby-value">:root</span>]
<span class="line-num">73</span>     <span class="ruby-identifier">app</span>.<span class="ruby-identifier">opts</span>[<span class="ruby-value">:public_root</span>] = <span class="ruby-identifier">app</span>.<span class="ruby-identifier">expand_path</span>(<span class="ruby-identifier">opts</span>[<span class="ruby-value">:root</span>])
<span class="line-num">74</span>   <span class="ruby-keyword">elsif</span> <span class="ruby-operator">!</span><span class="ruby-identifier">app</span>.<span class="ruby-identifier">opts</span>[<span class="ruby-value">:public_root</span>]
<span class="line-num">75</span>     <span class="ruby-identifier">app</span>.<span class="ruby-identifier">opts</span>[<span class="ruby-value">:public_root</span>] = <span class="ruby-identifier">app</span>.<span class="ruby-identifier">expand_path</span>(<span class="ruby-string">&quot;public&quot;</span>)
<span class="line-num">76</span>   <span class="ruby-keyword">end</span>
<span class="line-num">77</span>   <span class="ruby-identifier">app</span>.<span class="ruby-identifier">opts</span>[<span class="ruby-value">:public_server</span>] = <span class="ruby-constant">RACK_FILES</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">app</span>.<span class="ruby-identifier">opts</span>[<span class="ruby-value">:public_root</span>], <span class="ruby-identifier">opts</span>[<span class="ruby-value">:headers</span>]<span class="ruby-operator">||</span>{}, <span class="ruby-identifier">opts</span>[<span class="ruby-value">:default_mime</span>] <span class="ruby-operator">||</span> <span class="ruby-string">&#39;text/plain&#39;</span>)
<span class="line-num">78</span> 
<span class="line-num">79</span>   <span class="ruby-keyword">unless</span> <span class="ruby-identifier">encodings</span> = <span class="ruby-identifier">opts</span>[<span class="ruby-value">:encodings</span>]
<span class="line-num">80</span>     <span class="ruby-keyword">if</span> <span class="ruby-constant">ENCODING_MAP</span>.<span class="ruby-identifier">any?</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">k</span>,<span class="ruby-operator">|</span> <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">has_key?</span>(<span class="ruby-identifier">k</span>)}
<span class="line-num">81</span>       <span class="ruby-identifier">encodings</span> = <span class="ruby-constant">ENCODING_MAP</span>.<span class="ruby-identifier">map</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">k</span>, <span class="ruby-identifier">v</span><span class="ruby-operator">|</span> [<span class="ruby-identifier">v</span>, <span class="ruby-constant">ENCODING_EXTENSIONS</span>[<span class="ruby-identifier">v</span>]] <span class="ruby-keyword">if</span> <span class="ruby-identifier">opts</span>[<span class="ruby-identifier">k</span>]}.<span class="ruby-identifier">compact</span>
<span class="line-num">82</span>     <span class="ruby-keyword">end</span>
<span class="line-num">83</span>   <span class="ruby-keyword">end</span>
<span class="line-num">84</span>   <span class="ruby-identifier">encodings</span> = (<span class="ruby-identifier">encodings</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">app</span>.<span class="ruby-identifier">opts</span>[<span class="ruby-value">:public_encodings</span>] <span class="ruby-operator">||</span> <span class="ruby-constant">EMPTY_ARRAY</span>).<span class="ruby-identifier">map</span>(<span class="ruby-operator">&amp;</span><span class="ruby-value">:dup</span>).<span class="ruby-identifier">freeze</span>
<span class="line-num">85</span>   <span class="ruby-identifier">encodings</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">a</span><span class="ruby-operator">|</span>
<span class="line-num">86</span>     <span class="ruby-identifier">a</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-regexp">/\b#{a[0]}\b/</span>
<span class="line-num">87</span>   <span class="ruby-keyword">end</span>
<span class="line-num">88</span>   <span class="ruby-identifier">encodings</span>.<span class="ruby-identifier">each</span>(<span class="ruby-operator">&amp;</span><span class="ruby-value">:freeze</span>)
<span class="line-num">89</span>   <span class="ruby-identifier">app</span>.<span class="ruby-identifier">opts</span>[<span class="ruby-value">:public_encodings</span>] = <span class="ruby-identifier">encodings</span>
<span class="line-num">90</span> <span class="ruby-keyword">end</span></pre>
</div>
</div>
</div>
</div>

</div>
</div>

<div id='footer-push'></div>
</div>
<div id='footer'>
<a href="https://github.com/jeremyevans/hanna"><strong>Hanna</strong> RDoc template</a>
</div>
</body>
</html>
