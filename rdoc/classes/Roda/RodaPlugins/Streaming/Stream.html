<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html lang='en'>
  <head>
    <title>Roda::RodaPlugins::Streaming::Stream</title>
    <meta content='text/html; charset=UTF-8' http-equiv='Content-Type'>
    <link href='../../../../css/style.css' media='screen' rel='stylesheet' type='text/css'>
    <script type='text/javascript'>
      function popupCode(url) {
        window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
      }
      
      function toggleCode(id) {
        var code = document.getElementById(id)
      
        code.style.display = code.style.display != 'block' ? 'block' : 'none'
        return true
      }
      
      // Make codeblocks hidden by default
      document.writeln('<' + 'style type="text/css">.method .source pre { display: none }<\/style>')
    </script>
  </head>
  <body class='page'>
    <div class='class' id='wrapper'>
      <div class='header'>
        <h1 class='name'>
          <span class='type'>class</span>
          Roda::RodaPlugins::Streaming::Stream
        </h1>
        <ol class='paths'>
          <li>
            <a href="../../../../files/lib/roda/plugins/streaming_rb.html">lib/roda/plugins/streaming.rb</a>
          </li>
        </ol>
        <div class='parent'>
          Superclass:
          <strong>Object</strong>
        </div>
      </div>
      <div id='content'>
        <div id='text'>
          <div id='description'>
            
            <p>Class of the response body in case you use stream.</p>
            
            <p>Three things really matter: The front and back block (back being the block
            generating content, front the one sending it to the client) and the
            scheduler, integrating with whatever concurrency feature the Rack handler
            is using.</p>
            
            <p><a href="Stream/Scheduler.html">Scheduler</a> has to respond to defer and
            schedule.</p>
          </div>
          <div id='method-list'>
            <h2>Methods</h2>
            <h3>Public Class</h3>
            <ol>
              <li><a href="#method-c-new">new</a></li>
            </ol>
            <h3>Public Instance</h3>
            <ol>
              <li><a href="#method-i-3C-3C"><<</a></li>
              <li><a href="#method-i-callback">callback</a></li>
              <li><a href="#method-i-close">close</a></li>
              <li><a href="#method-i-closed-3F">closed?</a></li>
              <li><a href="#method-i-each">each</a></li>
              <li><a href="#method-i-write">write</a></li>
            </ol>
          </div>
          <div id='context'>
            <div id='includes'>
              <h2>Included modules</h2>
              <ol>
                <li>Enumerable</li>
              </ol>
            </div>
          </div>
          <div id='class-list'>
            <h2>Classes and Modules</h2>
            <ol>
              <li><a href="Stream/Scheduler.html">Roda::RodaPlugins::Streaming::Stream::Scheduler</a></li>
            </ol>
          </div>
          <div id='section'>
            <div id='aliases-list'>
              <h2>Public Instance Aliases</h2>
              <div class='name-list'>
                <table summary='Public Instance Aliases'>
                  <tr class='top-aligned-row context-row'>
                    <td class='context-item-name'>errback</td>
                    <td>-&gt;</td>
                    <td class='context-item-value'><a href="#method-i-callback">callback</a></td>
                    <td class='context-item-desc'>
                      
                      <p>Alias to callback for EventMachine compatibility.</p>
                    </td>
                  </tr>
                </table>
              </div>
            </div>
            <div id='methods'>
              <h2>Public Class methods</h2>
              <div class='method public-class' id='method-method-c-new'>
                <a name='method-c-new'></a>
                <div class='synopsis'>
                  <span class='name'>new</span>
                  <span class='arguments'>(opts=OPTS, &back)</span>
                </div>
                <div class='description'>
                  
                  <p>Handle streaming options, see <a href="../Streaming.html">Streaming</a> for
                  details.</p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('method-c-new-source'); return false">
                    [show source]
                  </a>
                  <pre id='method-c-new-source'><span class="ruby-comment"># File lib/roda/plugins/streaming.rb, line 111</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-identifier">initialize</span>(<span class="ruby-identifier">opts</span>=<span class="ruby-constant">OPTS</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">back</span>)&#x000A;  <span class="ruby-ivar">@scheduler</span> = <span class="ruby-identifier">opts</span>[<span class="ruby-value">:scheduler</span>] <span class="ruby-operator">||</span> <span class="ruby-constant">Scheduler</span>.<span class="ruby-identifier">new</span>(<span class="ruby-keyword">self</span>)&#x000A;  <span class="ruby-ivar">@back</span> = <span class="ruby-identifier">back</span>.<span class="ruby-identifier">to_proc</span>&#x000A;  <span class="ruby-ivar">@keep_open</span> = <span class="ruby-identifier">opts</span>[<span class="ruby-value">:keep_open</span>]&#x000A;  <span class="ruby-ivar">@callbacks</span> = []&#x000A;  <span class="ruby-ivar">@closed</span> = <span class="ruby-keyword">false</span>&#x000A;&#x000A;  <span class="ruby-keyword">if</span> <span class="ruby-identifier">opts</span>[<span class="ruby-value">:callback</span>]&#x000A;    <span class="ruby-identifier">callback</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">opts</span>[<span class="ruby-value">:callback</span>])&#x000A;  <span class="ruby-keyword">end</span>&#x000A;<span class="ruby-keyword">end</span></pre>
                </div>
              </div>
              <h2>Public Instance methods</h2>
              <div class='method public-instance' id='method-method-i-3C-3C'>
                <a name='method-i-3C-3C'></a>
                <div class='synopsis'>
                  <span class='name'><<</span>
                  <span class='arguments'>(data)</span>
                </div>
                <div class='description'>
                  
                  <p>Alias for <code>write</code>.</p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('method-i-3C-3C-source'); return false">
                    [show source]
                  </a>
                  <pre id='method-i-3C-3C-source'><span class="ruby-comment"># File lib/roda/plugins/streaming.rb, line 130</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-operator">&lt;&lt;</span>(<span class="ruby-identifier">data</span>)&#x000A;  <span class="ruby-identifier">write</span>(<span class="ruby-identifier">data</span>)&#x000A;<span class="ruby-keyword">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-method-i-callback'>
                <a name='method-i-callback'></a>
                <div class='synopsis'>
                  <span class='name'>callback</span>
                  <span class='arguments'>(&block)</span>
                </div>
                <div class='description'>
                  
                  <p>Add the given block as a callback to call when the block closes.</p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('method-i-callback-source'); return false">
                    [show source]
                  </a>
                  <pre id='method-i-callback-source'><span class="ruby-comment"># File lib/roda/plugins/streaming.rb, line 135</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-identifier">callback</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)&#x000A;  <span class="ruby-keyword">return</span> <span class="ruby-keyword">yield</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">closed?</span>&#x000A;  <span class="ruby-ivar">@callbacks</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">block</span>&#x000A;<span class="ruby-keyword">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-method-i-close'>
                <a name='method-i-close'></a>
                <div class='synopsis'>
                  <span class='name'>close</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='description'>
                  
                  <p>If not already closed, close the connection, and call any callbacks.</p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('method-i-close-source'); return false">
                    [show source]
                  </a>
                  <pre id='method-i-close-source'><span class="ruby-comment"># File lib/roda/plugins/streaming.rb, line 145</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-identifier">close</span>&#x000A;  <span class="ruby-keyword">return</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">closed?</span>&#x000A;  <span class="ruby-ivar">@closed</span> = <span class="ruby-keyword">true</span>&#x000A;  <span class="ruby-ivar">@scheduler</span>.<span class="ruby-identifier">schedule</span>{<span class="ruby-ivar">@callbacks</span>.<span class="ruby-identifier">each</span>(<span class="ruby-operator">&amp;</span><span class="ruby-value">:call</span>)}&#x000A;<span class="ruby-keyword">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-method-i-closed-3F'>
                <a name='method-i-closed-3F'></a>
                <div class='synopsis'>
                  <span class='name'>closed?</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='description'>
                  
                  <p>Whether the connection has already been closed.</p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('method-i-closed-3F-source'); return false">
                    [show source]
                  </a>
                  <pre id='method-i-closed-3F-source'><span class="ruby-comment"># File lib/roda/plugins/streaming.rb, line 152</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-identifier">closed?</span>&#x000A;  <span class="ruby-ivar">@closed</span>&#x000A;<span class="ruby-keyword">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-method-i-each'>
                <a name='method-i-each'></a>
                <div class='synopsis'>
                  <span class='name'>each</span>
                  <span class='arguments'>(&front)</span>
                </div>
                <div class='description'>
                  
                  <p>Yield values to the block as they are passed in via <a
                  href="Stream.html#method-i-3C-3C"><<</a>.</p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('method-i-each-source'); return false">
                    [show source]
                  </a>
                  <pre id='method-i-each-source'><span class="ruby-comment"># File lib/roda/plugins/streaming.rb, line 157</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-identifier">each</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">front</span>)&#x000A;  <span class="ruby-ivar">@front</span> = <span class="ruby-identifier">front</span>&#x000A;  <span class="ruby-ivar">@scheduler</span>.<span class="ruby-identifier">defer</span> <span class="ruby-keyword">do</span>&#x000A;    <span class="ruby-keyword">begin</span>&#x000A;      <span class="ruby-ivar">@back</span>.<span class="ruby-identifier">call</span>(<span class="ruby-keyword">self</span>)&#x000A;    <span class="ruby-keyword">rescue</span> <span class="ruby-constant">Exception</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">e</span>&#x000A;      <span class="ruby-ivar">@scheduler</span>.<span class="ruby-identifier">schedule</span>{<span class="ruby-identifier">raise</span> <span class="ruby-identifier">e</span>}&#x000A;    <span class="ruby-keyword">end</span>&#x000A;    <span class="ruby-identifier">close</span> <span class="ruby-keyword">unless</span> <span class="ruby-ivar">@keep_open</span>&#x000A;  <span class="ruby-keyword">end</span>&#x000A;<span class="ruby-keyword">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-method-i-write'>
                <a name='method-i-write'></a>
                <div class='synopsis'>
                  <span class='name'>write</span>
                  <span class='arguments'>(data)</span>
                </div>
                <div class='description'>
                  
                  <p>Add output to the streaming response body.</p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('method-i-write-source'); return false">
                    [show source]
                  </a>
                  <pre id='method-i-write-source'><span class="ruby-comment"># File lib/roda/plugins/streaming.rb, line 124</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-identifier">write</span>(<span class="ruby-identifier">data</span>)&#x000A;  <span class="ruby-ivar">@scheduler</span>.<span class="ruby-identifier">schedule</span>{<span class="ruby-ivar">@front</span>.<span class="ruby-identifier">call</span>(<span class="ruby-identifier">data</span>.<span class="ruby-identifier">to_s</span>)}&#x000A;  <span class="ruby-keyword">self</span>&#x000A;<span class="ruby-keyword">end</span></pre>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div id='footer-push'></div>
    </div>
    <div id='footer'>
      <a href="https://github.com/rdoc/hanna-nouveau"><strong>Hanna Nouveau</strong> RDoc template</a>
    </div>
  </body>
</html>
