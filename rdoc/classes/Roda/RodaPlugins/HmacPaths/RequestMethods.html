<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html lang='en'>
<head>
<title>Roda::RodaPlugins::HmacPaths::RequestMethods</title>
<meta name='viewport' content='width=device-width, initial-scale=1'>
<meta content='text/html; charset=UTF-8' http-equiv='Content-Type'>
<link href='../../../../css/style.css' media='screen' rel='stylesheet' type='text/css'>
<script type='text/javascript'>
  function popupCode(url) {
    window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
  }
  
  function toggleCode(id) {
    var code = document.getElementById(id)
  
    code.style.display = code.style.display != 'block' ? 'block' : 'none'
    return true
  }
  
  // Make codeblocks hidden by default
  document.writeln('<' + 'style type="text/css">.method .source pre { display: none }<\/style>')
</script>
</head>
<body class='page'>
<div class='class' id='wrapper'>
<div class='header'>
<h1 class='name'><span class='type'>module</span>
Roda::RodaPlugins::HmacPaths::RequestMethods
</h1>
<ol class='paths'>
<li>
<a href="../../../../files/lib/roda/plugins/hmac_paths_rb.html">lib/roda/plugins/hmac_paths.rb</a>
</li>
</ol>
</div>
<div id='content'>
<div id='text'>
<div id='description'></div>
<div id='method-list'>
<h2>Methods</h2>
<h3>Public Instance</h3>
<ol>
<li><a href="#method-i-hmac_path">hmac_path</a></li>
</ol>
</div>
<div id='context'>
</div>
<div id='section'>
<div id='methods'>
<h2>Public Instance methods</h2>
<div class='method public-instance' id='method-method-i-hmac_path'>
<a name='method-i-hmac_path'></a>
<div class='synopsis'>
<span class='name'>hmac_path</span><span class='arguments'>(opts=OPTS, &block)</span>

</div>
<div class='description'>

<p>Looks at the first segment of the remaining path, and if it contains a valid HMAC for the rest of the path considering the flags in the second segment and the given options, the block matches and is yielded to, and the result of the block is returned. Otherwise, the block does not matches and routing continues after the call.</p>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-hmac_path-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-hmac_path-source'>    <span class="ruby-comment"># File lib/roda/plugins/hmac_paths.rb</span>
<span class="line-num">340</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">hmac_path</span>(<span class="ruby-identifier">opts</span>=<span class="ruby-constant">OPTS</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
<span class="line-num">341</span>   <span class="ruby-identifier">orig_path</span> = <span class="ruby-identifier">remaining_path</span>
<span class="line-num">342</span>   <span class="ruby-identifier">mpath</span> = <span class="ruby-identifier">matched_path</span>
<span class="line-num">343</span> 
<span class="line-num">344</span>   <span class="ruby-identifier">on</span> <span class="ruby-constant">String</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">submitted_hmac</span><span class="ruby-operator">|</span>
<span class="line-num">345</span>     <span class="ruby-identifier">rpath</span> = <span class="ruby-identifier">remaining_path</span>
<span class="line-num">346</span> 
<span class="line-num">347</span>     <span class="ruby-keyword">if</span> <span class="ruby-identifier">submitted_hmac</span>.<span class="ruby-identifier">bytesize</span> <span class="ruby-operator">==</span> <span class="ruby-value">64</span>
<span class="line-num">348</span>       <span class="ruby-identifier">on</span> <span class="ruby-constant">String</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">flags</span><span class="ruby-operator">|</span>
<span class="line-num">349</span>         <span class="ruby-keyword">if</span> <span class="ruby-identifier">flags</span>.<span class="ruby-identifier">bytesize</span> <span class="ruby-operator">&gt;=</span> <span class="ruby-value">1</span>
<span class="line-num">350</span>           <span class="ruby-keyword">if</span> <span class="ruby-identifier">flags</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-string">&#39;n&#39;</span>) <span class="ruby-operator">^</span> <span class="ruby-operator">!</span><span class="ruby-identifier">scope</span>.<span class="ruby-identifier">hmac_path_namespace</span>(<span class="ruby-identifier">opts</span>).<span class="ruby-identifier">nil?</span>
<span class="line-num">351</span>             <span class="ruby-comment"># Namespace required and not provided, or provided and not required.</span>
<span class="line-num">352</span>             <span class="ruby-comment"># Bail early to avoid unnecessary HMAC calculation.</span>
<span class="line-num">353</span>             <span class="ruby-ivar">@remaining_path</span> = <span class="ruby-identifier">orig_path</span>
<span class="line-num">354</span>             <span class="ruby-keyword">return</span>
<span class="line-num">355</span>           <span class="ruby-keyword">end</span>
<span class="line-num">356</span> 
<span class="line-num">357</span>           <span class="ruby-keyword">if</span> <span class="ruby-identifier">flags</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-string">&#39;m&#39;</span>)
<span class="line-num">358</span>             <span class="ruby-identifier">rpath</span> = <span class="ruby-node">&quot;#{env[&#39;REQUEST_METHOD&#39;].to_s.upcase}:#{rpath}&quot;</span>
<span class="line-num">359</span>           <span class="ruby-keyword">end</span>
<span class="line-num">360</span> 
<span class="line-num">361</span>           <span class="ruby-keyword">if</span> <span class="ruby-identifier">flags</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-string">&#39;p&#39;</span>)
<span class="line-num">362</span>             <span class="ruby-identifier">rpath</span> = <span class="ruby-node">&quot;#{rpath}?#{env[&quot;QUERY_STRING&quot;]}&quot;</span>
<span class="line-num">363</span>           <span class="ruby-keyword">end</span>
<span class="line-num">364</span> 
<span class="line-num">365</span>           <span class="ruby-keyword">if</span> <span class="ruby-identifier">hmac_path_valid?</span>(<span class="ruby-identifier">mpath</span>, <span class="ruby-identifier">rpath</span>, <span class="ruby-identifier">submitted_hmac</span>, <span class="ruby-identifier">opts</span>)
<span class="line-num">366</span>             <span class="ruby-keyword">if</span> <span class="ruby-identifier">flags</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-string">&#39;t&#39;</span>)
<span class="line-num">367</span>               <span class="ruby-identifier">on</span> <span class="ruby-constant">Integer</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">int</span><span class="ruby-operator">|</span>
<span class="line-num">368</span>                 <span class="ruby-keyword">if</span> <span class="ruby-identifier">int</span> <span class="ruby-operator">&gt;=</span> <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>.<span class="ruby-identifier">to_i</span>
<span class="line-num">369</span>                   <span class="ruby-identifier">always</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
<span class="line-num">370</span>                 <span class="ruby-keyword">else</span>
<span class="line-num">371</span>                   <span class="ruby-comment"># Return from method without matching</span>
<span class="line-num">372</span>                   <span class="ruby-ivar">@remaining_path</span> = <span class="ruby-identifier">orig_path</span>
<span class="line-num">373</span>                   <span class="ruby-keyword">return</span>
<span class="line-num">374</span>                 <span class="ruby-keyword">end</span>
<span class="line-num">375</span>               <span class="ruby-keyword">end</span>
<span class="line-num">376</span>             <span class="ruby-keyword">else</span>
<span class="line-num">377</span>               <span class="ruby-identifier">always</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
<span class="line-num">378</span>             <span class="ruby-keyword">end</span>
<span class="line-num">379</span>           <span class="ruby-keyword">end</span>
<span class="line-num">380</span>         <span class="ruby-keyword">end</span>
<span class="line-num">381</span> 
<span class="line-num">382</span>         <span class="ruby-comment"># Return from method without matching</span>
<span class="line-num">383</span>         <span class="ruby-ivar">@remaining_path</span> = <span class="ruby-identifier">orig_path</span>
<span class="line-num">384</span>         <span class="ruby-keyword">return</span>
<span class="line-num">385</span>       <span class="ruby-keyword">end</span>
<span class="line-num">386</span>     <span class="ruby-keyword">end</span>
<span class="line-num">387</span> 
<span class="line-num">388</span>     <span class="ruby-comment"># Return from method without matching</span>
<span class="line-num">389</span>     <span class="ruby-ivar">@remaining_path</span> = <span class="ruby-identifier">orig_path</span>
<span class="line-num">390</span>     <span class="ruby-keyword">return</span>
<span class="line-num">391</span>   <span class="ruby-keyword">end</span>
<span class="line-num">392</span> <span class="ruby-keyword">end</span></pre>
</div>
</div>
</div>
</div>

</div>
</div>

<div id='footer-push'></div>
</div>
<div id='footer'>
<a href="https://github.com/jeremyevans/hanna"><strong>Hanna</strong> RDoc template</a>
</div>
</body>
</html>
