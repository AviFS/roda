<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html lang='en'>
<head>
<title>Roda::RodaPlugins::Base::RequestMethods</title>
<meta content='text/html; charset=UTF-8' http-equiv='Content-Type'>
<link href='../../../../css/style.css' media='screen' rel='stylesheet' type='text/css'>
<script type='text/javascript'>
  function popupCode(url) {
    window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
  }
  
  function toggleCode(id) {
    var code = document.getElementById(id)
  
    code.style.display = code.style.display != 'block' ? 'block' : 'none'
    return true
  }
  
  // Make codeblocks hidden by default
  document.writeln('<' + 'style type="text/css">.method .source pre { display: none }<\/style>')
</script>
</head>
<body class='page'>
<div class='class' id='wrapper'>
<div class='header'>
<h1 class='name'><span class='type'>module</span>
Roda::RodaPlugins::Base::RequestMethods
</h1>
<ol class='paths'>
<li>
<a href="../../../../files/lib/roda_rb.html">lib/roda.rb</a>
</li>
</ol>
</div>
<div id='content'>
<div id='text'>
<div id='description'>
<p>Instance methods for <a href="../../RodaRequest.html"><code>RodaRequest</code></a>, mostly related to handling routing for the request.</p>
</div>
<div id='method-list'>
<h2>Methods</h2>
<h3>Public Class</h3>
<ol>
<li><a href="#method-c-new">new</a></li>
</ol>
<h3>Public Instance</h3>
<ol>
<li><a href="#method-i-block_result">block_result</a></li>
<li><a href="#attribute-i-captures">captures</a></li>
<li><a href="#method-i-get">get</a></li>
<li><a href="#method-i-halt">halt</a></li>
<li><a href="#method-i-inspect">inspect</a></li>
<li><a href="#method-i-is">is</a></li>
<li><a href="#method-i-is_get-3F">is_get?</a></li>
<li><a href="#method-i-matched_path">matched_path</a></li>
<li><a href="#method-i-on">on</a></li>
<li><a href="#method-i-path">path</a></li>
<li><a href="#method-i-post">post</a></li>
<li><a href="#method-i-real_remaining_path">real_remaining_path</a></li>
<li><a href="#method-i-redirect">redirect</a></li>
<li><a href="#attribute-i-remaining_path">remaining_path</a></li>
<li><a href="#method-i-response">response</a></li>
<li><a href="#method-i-roda_class">roda_class</a></li>
<li><a href="#method-i-root">root</a></li>
<li><a href="#method-i-run">run</a></li>
<li><a href="#attribute-i-scope">scope</a></li>
<li><a href="#method-i-session">session</a></li>
</ol>
</div>
<div id='context'>
</div>
<div id='section'>
<div id='constants-list'>
<h2>Constants</h2>
<div class='name-list'>
<table summary='Constants'>
<tr class='top-aligned-row context-row'>
<td class='context-item-name'>TERM</td>
<td>=</td>
<td class='context-item-value'>Object.new</td>
<td>&nbsp;</td>
<td class='context-item-desc'></td>
</tr>
</table>
</div>
</div>
<div id='attribute-list'>
<h2 class='section-bar'>Attributes</h2>
<div class='name-list'>
<table>
<tr class='top-aligned-row context-row'>
<td class='context-item-name'>
<a name='attribute-i-captures'>captures</a>
</td>
<td class='context-item-value'>[R]</td>
<td class='context-item-desc'>
<p>The current captures for the request.  This gets modified as routing occurs.</p>
</td>
</tr>
<tr class='top-aligned-row context-row'>
<td class='context-item-name'>
<a name='attribute-i-remaining_path'>remaining_path</a>
</td>
<td class='context-item-value'>[R]</td>
<td class='context-item-desc'>
<p>The current path to match requests against.</p>
</td>
</tr>
<tr class='top-aligned-row context-row'>
<td class='context-item-name'>
<a name='attribute-i-scope'>scope</a>
</td>
<td class='context-item-value'>[R]</td>
<td class='context-item-desc'>
<p>The <a href="../../../Roda.html"><code>Roda</code></a> instance related to this request object.  Useful if routing methods need access to the scope of the <a href="../../../Roda.html"><code>Roda</code></a> route block.</p>
</td>
</tr>
</table>
</div>
</div>
<div id='methods'>
<h2>Public Class methods</h2>
<div class='method public-class' id='method-method-c-new'>
<a name='method-c-new'></a>
<div class='synopsis'>
<span class='name'>new</span>
<span class='arguments'>(scope, env)</span>

</div>
<div class='description'>

<p>Store the roda instance and environment.</p>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-c-new-source&#39;); return false'>
[show source]
</a>
<pre id='method-c-new-source'>    <span class="ruby-comment"># File lib/roda.rb</span>&#x000A;<span class="line-num">688</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">initialize</span>(<span class="ruby-identifier">scope</span>, <span class="ruby-identifier">env</span>)&#x000A;<span class="line-num">689</span>   <span class="ruby-ivar">@scope</span> = <span class="ruby-identifier">scope</span>&#x000A;<span class="line-num">690</span>   <span class="ruby-ivar">@captures</span> = []&#x000A;<span class="line-num">691</span>   <span class="ruby-ivar">@remaining_path</span> = <span class="ruby-identifier">_remaining_path</span>(<span class="ruby-identifier">env</span>)&#x000A;<span class="line-num">692</span>   <span class="ruby-ivar">@env</span> = <span class="ruby-identifier">env</span>&#x000A;<span class="line-num">693</span> <span class="ruby-keyword">end</span></pre>
</div>
</div>
<h2>Public Instance methods</h2>
<div class='method public-instance' id='method-method-i-block_result'>
<a name='method-i-block_result'></a>
<div class='synopsis'>
<span class='name'>block_result</span>
<span class='arguments'>(result)</span>

</div>
<div class='description'>

<p>Handle match block return values.  By default, if a string is given and the response is empty, use the string as the response body.</p>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-block_result-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-block_result-source'>    <span class="ruby-comment"># File lib/roda.rb</span>&#x000A;<span class="line-num">697</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">block_result</span>(<span class="ruby-identifier">result</span>)&#x000A;<span class="line-num">698</span>   <span class="ruby-identifier">res</span> = <span class="ruby-identifier">response</span>&#x000A;<span class="line-num">699</span>   <span class="ruby-keyword">if</span> <span class="ruby-identifier">res</span>.<span class="ruby-identifier">empty?</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">body</span> = <span class="ruby-identifier">block_result_body</span>(<span class="ruby-identifier">result</span>))&#x000A;<span class="line-num">700</span>     <span class="ruby-identifier">res</span>.<span class="ruby-identifier">write</span>(<span class="ruby-identifier">body</span>)&#x000A;<span class="line-num">701</span>   <span class="ruby-keyword">end</span>&#x000A;<span class="line-num">702</span> <span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method public-instance' id='method-method-i-get'>
<a name='method-i-get'></a>
<div class='synopsis'>
<span class='name'>get</span>
<span class='arguments'>(*args, &block)</span>

</div>
<div class='description'>

<p>Match GET requests.  If no arguments are provided, matches all GET requests, otherwise, matches only GET requests where the arguments given fully consume the path.</p>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-get-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-get-source'>    <span class="ruby-comment"># File lib/roda.rb</span>&#x000A;<span class="line-num">707</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">get</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">args</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)&#x000A;<span class="line-num">708</span>   <span class="ruby-identifier">_verb</span>(<span class="ruby-identifier">args</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">is_get?</span>&#x000A;<span class="line-num">709</span> <span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method public-instance' id='method-method-i-halt'>
<a name='method-i-halt'></a>
<div class='synopsis'>
<span class='name'>halt</span>
<span class='arguments'>(res=response.finish)</span>

</div>
<div class='description'>

<p>Immediately stop execution of the route block and return the given rack response array of status, headers, and body.  If no argument is given, uses the current response.</p>

<pre class="ruby"><span class="ruby-identifier">r</span>.<span class="ruby-identifier">halt</span> [<span class="ruby-value">200</span>, {<span class="ruby-string">&#39;Content-Type&#39;</span><span class="ruby-operator">=&gt;</span><span class="ruby-string">&#39;text/html&#39;</span>}, [<span class="ruby-string">&#39;Hello World!&#39;</span>]]&#x000A;&#x000A;<span class="ruby-identifier">response</span>.<span class="ruby-identifier">status</span> = <span class="ruby-value">200</span>&#x000A;<span class="ruby-identifier">response</span>[<span class="ruby-string">&#39;Content-Type&#39;</span>] = <span class="ruby-string">&#39;text/html&#39;</span>&#x000A;<span class="ruby-identifier">response</span>.<span class="ruby-identifier">write</span> <span class="ruby-string">&#39;Hello World!&#39;</span>&#x000A;<span class="ruby-identifier">r</span>.<span class="ruby-identifier">halt</span></pre>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-halt-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-halt-source'>    <span class="ruby-comment"># File lib/roda.rb</span>&#x000A;<span class="line-num">721</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">halt</span>(<span class="ruby-identifier">res</span>=<span class="ruby-identifier">response</span>.<span class="ruby-identifier">finish</span>)&#x000A;<span class="line-num">722</span>   <span class="ruby-identifier">throw</span> <span class="ruby-value">:halt</span>, <span class="ruby-identifier">res</span>&#x000A;<span class="line-num">723</span> <span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method public-instance' id='method-method-i-inspect'>
<a name='method-i-inspect'></a>
<div class='synopsis'>
<span class='name'>inspect</span>
<span class='arguments'>()</span>

</div>
<div class='description'>

<p>Show information about current request, including request class, request method and full path.</p>

<pre class="ruby"><span class="ruby-identifier">r</span>.<span class="ruby-identifier">inspect</span>&#x000A;<span class="ruby-comment"># =&gt; &#39;#&lt;Roda::RodaRequest GET /foo/bar&gt;&#39;</span></pre>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-inspect-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-inspect-source'>    <span class="ruby-comment"># File lib/roda.rb</span>&#x000A;<span class="line-num">730</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">inspect</span>&#x000A;<span class="line-num">731</span>   <span class="ruby-node">&quot;#&lt;#{self.class.inspect} #{@env[&quot;REQUEST_METHOD&quot;]} #{path}&gt;&quot;</span>&#x000A;<span class="line-num">732</span> <span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method public-instance' id='method-method-i-is'>
<a name='method-i-is'></a>
<div class='synopsis'>
<span class='name'>is</span>
<span class='arguments'>(*args, &block)</span>

</div>
<div class='description'>

<p>Does a terminal match on the current path, matching only if the arguments have fully matched the path.  If it matches, the match block is executed, and when the match block returns, the rack response is returned.</p>

<pre class="ruby"><span class="ruby-identifier">r</span>.<span class="ruby-identifier">remaining_path</span>&#x000A;<span class="ruby-comment"># =&gt; &quot;/foo/bar&quot;</span>&#x000A;&#x000A;<span class="ruby-identifier">r</span>.<span class="ruby-identifier">is</span> <span class="ruby-string">&#39;foo&#39;</span> <span class="ruby-keyword">do</span>&#x000A;  <span class="ruby-comment"># does not match, as path isn&#39;t fully matched (/bar remaining)</span>&#x000A;<span class="ruby-keyword">end</span>&#x000A;&#x000A;<span class="ruby-identifier">r</span>.<span class="ruby-identifier">is</span> <span class="ruby-string">&#39;foo/bar&#39;</span> <span class="ruby-keyword">do</span>&#x000A;  <span class="ruby-comment"># matches as path is empty after matching</span>&#x000A;<span class="ruby-keyword">end</span></pre>

<p>If no arguments are given, matches if the path is already fully matched.</p>

<pre class="ruby"><span class="ruby-identifier">r</span>.<span class="ruby-identifier">on</span> <span class="ruby-string">&#39;foo/bar&#39;</span> <span class="ruby-keyword">do</span>&#x000A;  <span class="ruby-identifier">r</span>.<span class="ruby-identifier">is</span> <span class="ruby-keyword">do</span>&#x000A;    <span class="ruby-comment"># matches as path is already empty</span>&#x000A;  <span class="ruby-keyword">end</span>&#x000A;<span class="ruby-keyword">end</span></pre>

<p>Note that this matches only if the path after matching the arguments is empty, not if it still contains a trailing slash:</p>

<pre class="ruby"><span class="ruby-identifier">r</span>.<span class="ruby-identifier">remaining_path</span>&#x000A;<span class="ruby-comment"># =&gt;  &quot;/foo/bar/&quot;</span>&#x000A;&#x000A;<span class="ruby-identifier">r</span>.<span class="ruby-identifier">is</span> <span class="ruby-string">&#39;foo/bar&#39;</span> <span class="ruby-keyword">do</span>&#x000A;  <span class="ruby-comment"># does not match, as path isn&#39;t fully matched (/ remaining)</span>&#x000A;<span class="ruby-keyword">end</span>&#x000A;&#x000A;<span class="ruby-identifier">r</span>.<span class="ruby-identifier">is</span> <span class="ruby-string">&#39;foo/bar/&#39;</span> <span class="ruby-keyword">do</span>&#x000A;  <span class="ruby-comment"># matches as path is empty after matching</span>&#x000A;<span class="ruby-keyword">end</span>&#x000A;&#x000A;<span class="ruby-identifier">r</span>.<span class="ruby-identifier">on</span> <span class="ruby-string">&#39;foo/bar&#39;</span> <span class="ruby-keyword">do</span>&#x000A;  <span class="ruby-identifier">r</span>.<span class="ruby-identifier">is</span> <span class="ruby-string">&quot;&quot;</span> <span class="ruby-keyword">do</span>&#x000A;    <span class="ruby-comment"># matches as path is empty after matching</span>&#x000A;  <span class="ruby-keyword">end</span>&#x000A;<span class="ruby-keyword">end</span></pre>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-is-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-is-source'>    <span class="ruby-comment"># File lib/roda.rb</span>&#x000A;<span class="line-num">777</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">is</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">args</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)&#x000A;<span class="line-num">778</span>   <span class="ruby-keyword">if</span> <span class="ruby-identifier">args</span>.<span class="ruby-identifier">empty?</span>&#x000A;<span class="line-num">779</span>     <span class="ruby-keyword">if</span> <span class="ruby-identifier">empty_path?</span>&#x000A;<span class="line-num">780</span>       <span class="ruby-identifier">always</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)&#x000A;<span class="line-num">781</span>     <span class="ruby-keyword">end</span>&#x000A;<span class="line-num">782</span>   <span class="ruby-keyword">else</span>&#x000A;<span class="line-num">783</span>     <span class="ruby-identifier">args</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-constant">TERM</span>&#x000A;<span class="line-num">784</span>     <span class="ruby-identifier">if_match</span>(<span class="ruby-identifier">args</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)&#x000A;<span class="line-num">785</span>   <span class="ruby-keyword">end</span>&#x000A;<span class="line-num">786</span> <span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method public-instance' id='method-method-i-is_get-3F'>
<a name='method-i-is_get-3F'></a>
<div class='synopsis'>
<span class='name'>is_get?</span>
<span class='arguments'>()</span>

</div>
<div class='description'>

<p>Optimized method for whether this request is a <code>GET</code> request. Similar to the default Rack::Request get? method, but can be overridden without changing rack&#39;s behavior.</p>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-is_get-3F-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-is_get-3F-source'>    <span class="ruby-comment"># File lib/roda.rb</span>&#x000A;<span class="line-num">791</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">is_get?</span>&#x000A;<span class="line-num">792</span>   <span class="ruby-ivar">@env</span>[<span class="ruby-string">&quot;REQUEST_METHOD&quot;</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&#39;GET&#39;</span>&#x000A;<span class="line-num">793</span> <span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method public-instance' id='method-method-i-matched_path'>
<a name='method-i-matched_path'></a>
<div class='synopsis'>
<span class='name'>matched_path</span>
<span class='arguments'>()</span>

</div>
<div class='description'>

<p>The already matched part of the path, including the original SCRIPT_NAME.</p>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-matched_path-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-matched_path-source'>    <span class="ruby-comment"># File lib/roda.rb</span>&#x000A;<span class="line-num">831</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">matched_path</span>&#x000A;<span class="line-num">832</span>   <span class="ruby-identifier">e</span> = <span class="ruby-ivar">@env</span>&#x000A;<span class="line-num">833</span>   <span class="ruby-identifier">e</span>[<span class="ruby-string">&quot;SCRIPT_NAME&quot;</span>] <span class="ruby-operator">+</span> <span class="ruby-identifier">e</span>[<span class="ruby-string">&quot;PATH_INFO&quot;</span>].<span class="ruby-identifier">chomp</span>(<span class="ruby-ivar">@remaining_path</span>)&#x000A;<span class="line-num">834</span> <span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method public-instance' id='method-method-i-on'>
<a name='method-i-on'></a>
<div class='synopsis'>
<span class='name'>on</span>
<span class='arguments'>(*args, &block)</span>

</div>
<div class='description'>

<p>Does a match on the path, matching only if the arguments have matched the path.  Because this doesn&#39;t fully match the path, this is usually used to setup branches of the routing tree, not for final handling of the request.</p>

<pre class="ruby"><span class="ruby-identifier">r</span>.<span class="ruby-identifier">remaining_path</span>&#x000A;<span class="ruby-comment"># =&gt; &quot;/foo/bar&quot;</span>&#x000A;&#x000A;<span class="ruby-identifier">r</span>.<span class="ruby-identifier">on</span> <span class="ruby-string">&#39;foo&#39;</span> <span class="ruby-keyword">do</span>&#x000A;  <span class="ruby-comment"># matches, path is /bar after matching</span>&#x000A;<span class="ruby-keyword">end</span>&#x000A;&#x000A;<span class="ruby-identifier">r</span>.<span class="ruby-identifier">on</span> <span class="ruby-string">&#39;bar&#39;</span> <span class="ruby-keyword">do</span>&#x000A;  <span class="ruby-comment"># does not match</span>&#x000A;<span class="ruby-keyword">end</span></pre>

<p>Like other routing methods, If it matches, the match block is executed, and when the match block returns, the rack response is returned.  However, in general you will call another routing method inside the match block that fully matches the path and does the final handling for the request:</p>

<pre class="ruby"><span class="ruby-identifier">r</span>.<span class="ruby-identifier">on</span> <span class="ruby-string">&#39;foo&#39;</span> <span class="ruby-keyword">do</span>&#x000A;  <span class="ruby-identifier">r</span>.<span class="ruby-identifier">is</span> <span class="ruby-string">&#39;bar&#39;</span> <span class="ruby-keyword">do</span>&#x000A;    <span class="ruby-comment"># handle /foo/bar request</span>&#x000A;  <span class="ruby-keyword">end</span>&#x000A;<span class="ruby-keyword">end</span></pre>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-on-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-on-source'>    <span class="ruby-comment"># File lib/roda.rb</span>&#x000A;<span class="line-num">822</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">on</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">args</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)&#x000A;<span class="line-num">823</span>   <span class="ruby-keyword">if</span> <span class="ruby-identifier">args</span>.<span class="ruby-identifier">empty?</span>&#x000A;<span class="line-num">824</span>     <span class="ruby-identifier">always</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)&#x000A;<span class="line-num">825</span>   <span class="ruby-keyword">else</span>&#x000A;<span class="line-num">826</span>     <span class="ruby-identifier">if_match</span>(<span class="ruby-identifier">args</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)&#x000A;<span class="line-num">827</span>   <span class="ruby-keyword">end</span>&#x000A;<span class="line-num">828</span> <span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method public-instance' id='method-method-i-path'>
<a name='method-i-path'></a>
<div class='synopsis'>
<span class='name'>path</span>
<span class='arguments'>()</span>

</div>
<div class='description'>

<p>This an an optimized version of Rack::Request#path.</p>

<pre class="ruby"><span class="ruby-identifier">r</span>.<span class="ruby-identifier">env</span>[<span class="ruby-string">&#39;SCRIPT_NAME&#39;</span>] = <span class="ruby-string">&#39;/foo&#39;</span>&#x000A;<span class="ruby-identifier">r</span>.<span class="ruby-identifier">env</span>[<span class="ruby-string">&#39;PATH_INFO&#39;</span>] = <span class="ruby-string">&#39;/bar&#39;</span>&#x000A;<span class="ruby-identifier">r</span>.<span class="ruby-identifier">path</span>&#x000A;<span class="ruby-comment"># =&gt; &#39;/foo/bar&#39;</span></pre>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-path-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-path-source'>    <span class="ruby-comment"># File lib/roda.rb</span>&#x000A;<span class="line-num">842</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">path</span>&#x000A;<span class="line-num">843</span>   <span class="ruby-identifier">e</span> = <span class="ruby-ivar">@env</span>&#x000A;<span class="line-num">844</span>   <span class="ruby-node">&quot;#{e[&quot;SCRIPT_NAME&quot;]}#{e[&quot;PATH_INFO&quot;]}&quot;</span>&#x000A;<span class="line-num">845</span> <span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method public-instance' id='method-method-i-post'>
<a name='method-i-post'></a>
<div class='synopsis'>
<span class='name'>post</span>
<span class='arguments'>(*args, &block)</span>

</div>
<div class='description'>

<p>Match POST requests.  If no arguments are provided, matches all POST requests, otherwise, matches only POST requests where the arguments given fully consume the path.</p>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-post-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-post-source'>    <span class="ruby-comment"># File lib/roda.rb</span>&#x000A;<span class="line-num">859</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">post</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">args</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)&#x000A;<span class="line-num">860</span>   <span class="ruby-identifier">_verb</span>(<span class="ruby-identifier">args</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">post?</span>&#x000A;<span class="line-num">861</span> <span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method public-instance' id='method-method-i-real_remaining_path'>
<a name='method-i-real_remaining_path'></a>
<div class='synopsis'>
<span class='name'>real_remaining_path</span>
<span class='arguments'>()</span>

</div>
<div class='description'>

<p>An alias of remaining_path. If a plugin changes <a href="RequestMethods.html#attribute-i-remaining_path"><code>remaining_path</code></a> then it should override this method to return the untouched original.</p>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-real_remaining_path-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-real_remaining_path-source'>    <span class="ruby-comment"># File lib/roda.rb</span>&#x000A;<span class="line-num">852</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">real_remaining_path</span>&#x000A;<span class="line-num">853</span>   <span class="ruby-identifier">remaining_path</span>&#x000A;<span class="line-num">854</span> <span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method public-instance' id='method-method-i-redirect'>
<a name='method-i-redirect'></a>
<div class='synopsis'>
<span class='name'>redirect</span>
<span class='arguments'>(path=default_redirect_path, status=default_redirect_status)</span>

</div>
<div class='description'>

<p>Immediately redirect to the path using the status code.  This ends the processing of the request:</p>

<pre class="ruby"><span class="ruby-identifier">r</span>.<span class="ruby-identifier">redirect</span> <span class="ruby-string">&#39;/page1&#39;</span>, <span class="ruby-value">301</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">r</span>[<span class="ruby-string">&#39;param&#39;</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&#39;value1&#39;</span>&#x000A;<span class="ruby-identifier">r</span>.<span class="ruby-identifier">redirect</span> <span class="ruby-string">&#39;/page2&#39;</span> <span class="ruby-comment"># uses 302 status code</span>&#x000A;<span class="ruby-identifier">response</span>.<span class="ruby-identifier">status</span> = <span class="ruby-value">404</span> <span class="ruby-comment"># not reached</span></pre>

<p>If you do not provide a path, by default it will redirect to the same path if the request is not a <code>GET</code> request.  This is designed to make it easy to use where a <code>POST</code> request to a URL changes state, <code>GET</code> returns the current state, and you want to show the current state after changing:</p>

<pre class="ruby"><span class="ruby-identifier">r</span>.<span class="ruby-identifier">is</span> <span class="ruby-string">&quot;foo&quot;</span> <span class="ruby-keyword">do</span>&#x000A;  <span class="ruby-identifier">r</span>.<span class="ruby-identifier">get</span> <span class="ruby-keyword">do</span>&#x000A;    <span class="ruby-comment"># show state</span>&#x000A;  <span class="ruby-keyword">end</span>&#x000A;&#x000A;  <span class="ruby-identifier">r</span>.<span class="ruby-identifier">post</span> <span class="ruby-keyword">do</span>&#x000A;    <span class="ruby-comment"># change state</span>&#x000A;    <span class="ruby-identifier">r</span>.<span class="ruby-identifier">redirect</span>&#x000A;  <span class="ruby-keyword">end</span>&#x000A;<span class="ruby-keyword">end</span></pre>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-redirect-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-redirect-source'>    <span class="ruby-comment"># File lib/roda.rb</span>&#x000A;<span class="line-num">886</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">redirect</span>(<span class="ruby-identifier">path</span>=<span class="ruby-identifier">default_redirect_path</span>, <span class="ruby-identifier">status</span>=<span class="ruby-identifier">default_redirect_status</span>)&#x000A;<span class="line-num">887</span>   <span class="ruby-identifier">response</span>.<span class="ruby-identifier">redirect</span>(<span class="ruby-identifier">path</span>, <span class="ruby-identifier">status</span>)&#x000A;<span class="line-num">888</span>   <span class="ruby-identifier">throw</span> <span class="ruby-value">:halt</span>, <span class="ruby-identifier">response</span>.<span class="ruby-identifier">finish</span>&#x000A;<span class="line-num">889</span> <span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method public-instance' id='method-method-i-response'>
<a name='method-i-response'></a>
<div class='synopsis'>
<span class='name'>response</span>
<span class='arguments'>()</span>

</div>
<div class='description'>

<p>The response related to the current request.  See <a href="ResponseMethods.html"><code>ResponseMethods</code></a> for instance methods for the response, but in general the most common usage is to override the response status and headers:</p>

<pre class="ruby"><span class="ruby-identifier">response</span>.<span class="ruby-identifier">status</span> = <span class="ruby-value">200</span>&#x000A;<span class="ruby-identifier">response</span>[<span class="ruby-string">&#39;Header-Name&#39;</span>] = <span class="ruby-string">&#39;Header value&#39;</span></pre>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-response-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-response-source'>    <span class="ruby-comment"># File lib/roda.rb</span>&#x000A;<span class="line-num">897</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">response</span>&#x000A;<span class="line-num">898</span>   <span class="ruby-ivar">@scope</span>.<span class="ruby-identifier">response</span>&#x000A;<span class="line-num">899</span> <span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method public-instance' id='method-method-i-roda_class'>
<a name='method-i-roda_class'></a>
<div class='synopsis'>
<span class='name'>roda_class</span>
<span class='arguments'>()</span>

</div>
<div class='description'>

<p>Return the <a href="../../../Roda.html"><code>Roda</code></a> class related to this request.</p>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-roda_class-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-roda_class-source'>    <span class="ruby-comment"># File lib/roda.rb</span>&#x000A;<span class="line-num">902</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">roda_class</span>&#x000A;<span class="line-num">903</span>   <span class="ruby-keyword">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">roda_class</span>&#x000A;<span class="line-num">904</span> <span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method public-instance' id='method-method-i-root'>
<a name='method-i-root'></a>
<div class='synopsis'>
<span class='name'>root</span>
<span class='arguments'>(&block)</span>

</div>
<div class='description'>

<p>Match method that only matches <code>GET</code> requests where the current path is <code>/</code>.  If it matches, the match block is executed, and when the match block returns, the rack response is returned.</p>

<pre class="ruby">[<span class="ruby-identifier">r</span>.<span class="ruby-identifier">request_method</span>, <span class="ruby-identifier">r</span>.<span class="ruby-identifier">remaining_path</span>]&#x000A;<span class="ruby-comment"># =&gt; [&#39;GET&#39;, &#39;/&#39;]</span>&#x000A;&#x000A;<span class="ruby-identifier">r</span>.<span class="ruby-identifier">root</span> <span class="ruby-keyword">do</span>&#x000A;  <span class="ruby-comment"># matches</span>&#x000A;<span class="ruby-keyword">end</span></pre>

<p>This is usuable inside other match blocks:</p>

<pre class="ruby">[<span class="ruby-identifier">r</span>.<span class="ruby-identifier">request_method</span>, <span class="ruby-identifier">r</span>.<span class="ruby-identifier">remaining_path</span>]&#x000A;<span class="ruby-comment"># =&gt; [&#39;GET&#39;, &#39;/foo/&#39;]</span>&#x000A;&#x000A;<span class="ruby-identifier">r</span>.<span class="ruby-identifier">on</span> <span class="ruby-string">&#39;foo&#39;</span> <span class="ruby-keyword">do</span>&#x000A;  <span class="ruby-identifier">r</span>.<span class="ruby-identifier">root</span> <span class="ruby-keyword">do</span>&#x000A;    <span class="ruby-comment"># matches</span>&#x000A;  <span class="ruby-keyword">end</span>&#x000A;<span class="ruby-keyword">end</span></pre>

<p>Note that this does not match non-<code>GET</code> requests:</p>

<pre class="ruby">[<span class="ruby-identifier">r</span>.<span class="ruby-identifier">request_method</span>, <span class="ruby-identifier">r</span>.<span class="ruby-identifier">remaining_path</span>]&#x000A;<span class="ruby-comment"># =&gt; [&#39;POST&#39;, &#39;/&#39;]</span>&#x000A;&#x000A;<span class="ruby-identifier">r</span>.<span class="ruby-identifier">root</span> <span class="ruby-keyword">do</span>&#x000A;  <span class="ruby-comment"># does not match</span>&#x000A;<span class="ruby-keyword">end</span></pre>

<p>Use <code>r.post &quot;&quot;</code> for <code>POST</code> requests where the current path is <code>/</code>.</p>

<p>Nor does it match empty paths:</p>

<pre class="ruby">[<span class="ruby-identifier">r</span>.<span class="ruby-identifier">request_method</span>, <span class="ruby-identifier">r</span>.<span class="ruby-identifier">remaining_path</span>]&#x000A;<span class="ruby-comment"># =&gt; [&#39;GET&#39;, &#39;/foo&#39;]</span>&#x000A;&#x000A;<span class="ruby-identifier">r</span>.<span class="ruby-identifier">on</span> <span class="ruby-string">&#39;foo&#39;</span> <span class="ruby-keyword">do</span>&#x000A;  <span class="ruby-identifier">r</span>.<span class="ruby-identifier">root</span> <span class="ruby-keyword">do</span>&#x000A;    <span class="ruby-comment"># does not match</span>&#x000A;  <span class="ruby-keyword">end</span>&#x000A;<span class="ruby-keyword">end</span></pre>

<p>Use <code>r.get true</code> to handle <code>GET</code> requests where the current path is empty.</p>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-root-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-root-source'>    <span class="ruby-comment"># File lib/roda.rb</span>&#x000A;<span class="line-num">953</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">root</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)&#x000A;<span class="line-num">954</span>   <span class="ruby-keyword">if</span> <span class="ruby-identifier">remaining_path</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;/&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">is_get?</span>&#x000A;<span class="line-num">955</span>     <span class="ruby-identifier">always</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)&#x000A;<span class="line-num">956</span>   <span class="ruby-keyword">end</span>&#x000A;<span class="line-num">957</span> <span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method public-instance' id='method-method-i-run'>
<a name='method-i-run'></a>
<div class='synopsis'>
<span class='name'>run</span>
<span class='arguments'>(app)</span>

</div>
<div class='description'>

<p>Call the given rack app with the environment and return the response from the rack app as the response for this request.  This ends the processing of the request:</p>

<pre class="ruby"><span class="ruby-identifier">r</span>.<span class="ruby-identifier">run</span>(<span class="ruby-identifier">proc</span>{[<span class="ruby-value">403</span>, {}, []]}) <span class="ruby-keyword">unless</span> <span class="ruby-identifier">r</span>[<span class="ruby-string">&#39;letmein&#39;</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&#39;1&#39;</span>&#x000A;<span class="ruby-identifier">r</span>.<span class="ruby-identifier">run</span>(<span class="ruby-identifier">proc</span>{[<span class="ruby-value">404</span>, {}, []]})&#x000A;<span class="ruby-identifier">response</span>.<span class="ruby-identifier">status</span> = <span class="ruby-value">404</span> <span class="ruby-comment"># not reached</span></pre>

<p>This updates SCRIPT_NAME/PATH_INFO based on the current <a href="RequestMethods.html#attribute-i-remaining_path"><code>remaining_path</code></a> before dispatching to another rack app, so the app still works as a URL mapper.</p>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-run-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-run-source'>    <span class="ruby-comment"># File lib/roda.rb</span>&#x000A;<span class="line-num">970</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">run</span>(<span class="ruby-identifier">app</span>)&#x000A;<span class="line-num">971</span>   <span class="ruby-identifier">e</span> = <span class="ruby-ivar">@env</span>&#x000A;<span class="line-num">972</span>   <span class="ruby-identifier">path</span> = <span class="ruby-identifier">real_remaining_path</span>&#x000A;<span class="line-num">973</span>   <span class="ruby-identifier">sn</span> = <span class="ruby-string">&quot;SCRIPT_NAME&quot;</span>&#x000A;<span class="line-num">974</span>   <span class="ruby-identifier">pi</span> = <span class="ruby-string">&quot;PATH_INFO&quot;</span>&#x000A;<span class="line-num">975</span>   <span class="ruby-identifier">script_name</span> = <span class="ruby-identifier">e</span>[<span class="ruby-identifier">sn</span>]&#x000A;<span class="line-num">976</span>   <span class="ruby-identifier">path_info</span> = <span class="ruby-identifier">e</span>[<span class="ruby-identifier">pi</span>]&#x000A;<span class="line-num">977</span>   <span class="ruby-keyword">begin</span>&#x000A;<span class="line-num">978</span>     <span class="ruby-identifier">e</span>[<span class="ruby-identifier">sn</span>] <span class="ruby-operator">+=</span> <span class="ruby-identifier">path_info</span>.<span class="ruby-identifier">chomp</span>(<span class="ruby-identifier">path</span>)&#x000A;<span class="line-num">979</span>     <span class="ruby-identifier">e</span>[<span class="ruby-identifier">pi</span>] = <span class="ruby-identifier">path</span>&#x000A;<span class="line-num">980</span>     <span class="ruby-identifier">throw</span> <span class="ruby-value">:halt</span>, <span class="ruby-identifier">app</span>.<span class="ruby-identifier">call</span>(<span class="ruby-identifier">e</span>)&#x000A;<span class="line-num">981</span>   <span class="ruby-keyword">ensure</span>&#x000A;<span class="line-num">982</span>     <span class="ruby-identifier">e</span>[<span class="ruby-identifier">sn</span>] = <span class="ruby-identifier">script_name</span>&#x000A;<span class="line-num">983</span>     <span class="ruby-identifier">e</span>[<span class="ruby-identifier">pi</span>] = <span class="ruby-identifier">path_info</span>&#x000A;<span class="line-num">984</span>   <span class="ruby-keyword">end</span>&#x000A;<span class="line-num">985</span> <span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method public-instance' id='method-method-i-session'>
<a name='method-i-session'></a>
<div class='synopsis'>
<span class='name'>session</span>
<span class='arguments'>()</span>

</div>
<div class='description'>

<p>The session for the current request.  Raises a <a href="../../RodaError.html"><code>RodaError</code></a> if a session handler has not been loaded.</p>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-session-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-session-source'>    <span class="ruby-comment"># File lib/roda.rb</span>&#x000A;<span class="line-num">989</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">session</span>&#x000A;<span class="line-num">990</span>   <span class="ruby-ivar">@env</span>[<span class="ruby-string">&#39;rack.session&#39;</span>] <span class="ruby-operator">||</span> <span class="ruby-identifier">raise</span>(<span class="ruby-constant">RodaError</span>, <span class="ruby-string">&quot;You&#39;re missing a session handler, try using the sessions plugin.&quot;</span>)&#x000A;<span class="line-num">991</span> <span class="ruby-keyword">end</span></pre>
</div>
</div>
</div>
</div>

</div>
</div>

<div id='footer-push'></div>
</div>
<div id='footer'>
<a href="https://github.com/rdoc/hanna-nouveau"><strong>Hanna Nouveau</strong> RDoc template</a>
</div>
</body>
</html>
