<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html lang='en'>
<head>
<title>Roda::RodaPlugins::Base::ClassMethods</title>
<meta content='text/html; charset=UTF-8' http-equiv='Content-Type'>
<link href='../../../../css/style.css' media='screen' rel='stylesheet' type='text/css'>
<script type='text/javascript'>
  function popupCode(url) {
    window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
  }
  
  function toggleCode(id) {
    var code = document.getElementById(id)
  
    code.style.display = code.style.display != 'block' ? 'block' : 'none'
    return true
  }
  
  // Make codeblocks hidden by default
  document.writeln('<' + 'style type="text/css">.method .source pre { display: none }<\/style>')
</script>
</head>
<body class='page'>
<div class='class' id='wrapper'>
<div class='header'>
<h1 class='name'><span class='type'>module</span>
Roda::RodaPlugins::Base::ClassMethods
</h1>
<ol class='paths'>
<li>
<a href="../../../../files/lib/roda_rb.html">lib/roda.rb</a>
</li>
</ol>
</div>
<div id='content'>
<div id='text'>
<div id='description'>
<p>Class methods for the <a href="../../../Roda.html"><code>Roda</code></a> class.</p>
</div>
<div id='method-list'>
<h2>Methods</h2>
<h3>Public Instance</h3>
<ol>
<li><a href="#attribute-i-app">app</a></li>
<li><a href="#method-i-call">call</a></li>
<li><a href="#method-i-clear_middleware-21">clear_middleware!</a></li>
<li><a href="#method-i-expand_path">expand_path</a></li>
<li><a href="#method-i-freeze">freeze</a></li>
<li><a href="#attribute-i-inherit_middleware">inherit_middleware</a></li>
<li><a href="#method-i-inherited">inherited</a></li>
<li><a href="#attribute-i-opts">opts</a></li>
<li><a href="#method-i-plugin">plugin</a></li>
<li><a href="#method-i-route">route</a></li>
<li><a href="#attribute-i-route_block">route_block</a></li>
<li><a href="#method-i-use">use</a></li>
</ol>
</div>
<div id='context'>
</div>
<div id='section'>
<div id='attribute-list'>
<h2 class='section-bar'>Attributes</h2>
<div class='name-list'>
<table>
<tr class='top-aligned-row context-row'>
<td class='context-item-name'>
<a name='attribute-i-app'>app</a>
</td>
<td class='context-item-value'>[R]</td>
<td class='context-item-desc'>
<p>The rack application that this class uses.</p>
</td>
</tr>
<tr class='top-aligned-row context-row'>
<td class='context-item-name'>
<a name='attribute-i-inherit_middleware'>inherit_middleware</a>
</td>
<td class='context-item-value'>[RW]</td>
<td class='context-item-desc'>
<p>Whether middleware from the current class should be inherited by subclasses. True by default, should be set to false when using a design where the parent class accepts requests and uses run to dispatch the request to a subclass.</p>
</td>
</tr>
<tr class='top-aligned-row context-row'>
<td class='context-item-name'>
<a name='attribute-i-opts'>opts</a>
</td>
<td class='context-item-value'>[R]</td>
<td class='context-item-desc'>
<p>The settings/options hash for the current class.</p>
</td>
</tr>
<tr class='top-aligned-row context-row'>
<td class='context-item-name'>
<a name='attribute-i-route_block'>route_block</a>
</td>
<td class='context-item-value'>[R]</td>
<td class='context-item-desc'>
<p>The route block that this class uses.</p>
</td>
</tr>
</table>
</div>
</div>
<div id='methods'>
<h2>Public Instance methods</h2>
<div class='method public-instance' id='method-method-i-call'>
<a name='method-i-call'></a>
<div class='synopsis'>
<span class='name'>call</span>
<span class='arguments'>(env)</span>

</div>
<div class='description'>

<p>Call the internal rack application with the given environment. This allows the class itself to be used as a rack application. However, for performance, it&#39;s better to use <a href="ClassMethods.html#attribute-i-app"><code>app</code></a> to get direct access to the underlying rack app.</p>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-call-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-call-source'>    <span class="ruby-comment"># File lib/roda.rb</span>&#x000A;<span class="line-num">136</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">call</span>(<span class="ruby-identifier">env</span>)&#x000A;<span class="line-num">137</span>   <span class="ruby-identifier">app</span>.<span class="ruby-identifier">call</span>(<span class="ruby-identifier">env</span>)&#x000A;<span class="line-num">138</span> <span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method public-instance' id='method-method-i-clear_middleware-21'>
<a name='method-i-clear_middleware-21'></a>
<div class='synopsis'>
<span class='name'>clear_middleware!</span>
<span class='arguments'>()</span>

</div>
<div class='description'>

<p>Clear the middleware stack</p>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-clear_middleware-21-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-clear_middleware-21-source'>    <span class="ruby-comment"># File lib/roda.rb</span>&#x000A;<span class="line-num">141</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">clear_middleware!</span>&#x000A;<span class="line-num">142</span>   <span class="ruby-ivar">@middleware</span>.<span class="ruby-identifier">clear</span>&#x000A;<span class="line-num">143</span>   <span class="ruby-identifier">build_rack_app</span>&#x000A;<span class="line-num">144</span> <span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method public-instance' id='method-method-i-expand_path'>
<a name='method-i-expand_path'></a>
<div class='synopsis'>
<span class='name'>expand_path</span>
<span class='arguments'>(path, root=opts[:root])</span>

</div>
<div class='description'>

<p>Expand the given path, using the root argument as the base directory.</p>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-expand_path-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-expand_path-source'>    <span class="ruby-comment"># File lib/roda.rb</span>&#x000A;<span class="line-num">147</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">expand_path</span>(<span class="ruby-identifier">path</span>, <span class="ruby-identifier">root</span>=<span class="ruby-identifier">opts</span>[<span class="ruby-value">:root</span>])&#x000A;<span class="line-num">148</span>   <span class="ruby-operator">::</span><span class="ruby-constant">File</span>.<span class="ruby-identifier">expand_path</span>(<span class="ruby-identifier">path</span>, <span class="ruby-identifier">root</span>)&#x000A;<span class="line-num">149</span> <span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method public-instance' id='method-method-i-freeze'>
<a name='method-i-freeze'></a>
<div class='synopsis'>
<span class='name'>freeze</span>
<span class='arguments'>()</span>

</div>
<div class='description'>

<p>Freeze the internal state of the class, to avoid thread safety issues at runtime. It&#39;s optional to call this method, as nothing should be modifying the internal state at runtime anyway, but this makes sure an exception will be raised if you try to modify the internal state after calling this.</p>

<p>Note that freezing the class prevents you from subclassing it, mostly because it would cause some plugins to break.</p>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-freeze-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-freeze-source'>    <span class="ruby-comment"># File lib/roda.rb</span>&#x000A;<span class="line-num">158</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">freeze</span>&#x000A;<span class="line-num">159</span>   <span class="ruby-ivar">@opts</span>.<span class="ruby-identifier">freeze</span>&#x000A;<span class="line-num">160</span>   <span class="ruby-ivar">@middleware</span>.<span class="ruby-identifier">freeze</span>&#x000A;<span class="line-num">161</span>   <span class="ruby-keyword">super</span>&#x000A;<span class="line-num">162</span> <span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method public-instance' id='method-method-i-inherited'>
<a name='method-i-inherited'></a>
<div class='synopsis'>
<span class='name'>inherited</span>
<span class='arguments'>(subclass)</span>

</div>
<div class='description'>

<p>When inheriting <a href="../../../Roda.html"><code>Roda</code></a>, copy the shared data into the subclass, and setup the request and response subclasses.</p>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-inherited-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-inherited-source'>    <span class="ruby-comment"># File lib/roda.rb</span>&#x000A;<span class="line-num">166</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">inherited</span>(<span class="ruby-identifier">subclass</span>)&#x000A;<span class="line-num">167</span>   <span class="ruby-identifier">raise</span> <span class="ruby-constant">RodaError</span>, <span class="ruby-string">&quot;Cannot subclass a frozen Roda class&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">frozen?</span>&#x000A;<span class="line-num">168</span>   <span class="ruby-keyword">super</span>&#x000A;<span class="line-num">169</span>   <span class="ruby-identifier">subclass</span>.<span class="ruby-identifier">instance_variable_set</span>(<span class="ruby-value">:@inherit_middleware</span>, <span class="ruby-ivar">@inherit_middleware</span>)&#x000A;<span class="line-num">170</span>   <span class="ruby-identifier">subclass</span>.<span class="ruby-identifier">instance_variable_set</span>(<span class="ruby-value">:@middleware</span>, <span class="ruby-ivar">@inherit_middleware</span> <span class="ruby-operator">?</span> <span class="ruby-ivar">@middleware</span>.<span class="ruby-identifier">dup</span> <span class="ruby-operator">:</span> [])&#x000A;<span class="line-num">171</span>   <span class="ruby-identifier">subclass</span>.<span class="ruby-identifier">instance_variable_set</span>(<span class="ruby-value">:@opts</span>, <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">dup</span>)&#x000A;<span class="line-num">172</span>   <span class="ruby-identifier">subclass</span>.<span class="ruby-identifier">opts</span>.<span class="ruby-identifier">to_a</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">k</span>,<span class="ruby-identifier">v</span><span class="ruby-operator">|</span>&#x000A;<span class="line-num">173</span>     <span class="ruby-keyword">if</span> (<span class="ruby-identifier">v</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Array</span>) <span class="ruby-operator">||</span> <span class="ruby-identifier">v</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Hash</span>)) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">v</span>.<span class="ruby-identifier">frozen?</span>&#x000A;<span class="line-num">174</span>       <span class="ruby-identifier">subclass</span>.<span class="ruby-identifier">opts</span>[<span class="ruby-identifier">k</span>] = <span class="ruby-identifier">v</span>.<span class="ruby-identifier">dup</span>&#x000A;<span class="line-num">175</span>     <span class="ruby-keyword">end</span>&#x000A;<span class="line-num">176</span>   <span class="ruby-keyword">end</span>&#x000A;<span class="line-num">177</span>   <span class="ruby-identifier">subclass</span>.<span class="ruby-identifier">instance_variable_set</span>(<span class="ruby-value">:@route_block</span>, <span class="ruby-ivar">@route_block</span>)&#x000A;<span class="line-num">178</span>   <span class="ruby-identifier">subclass</span>.<span class="ruby-identifier">send</span>(<span class="ruby-value">:build_rack_app</span>)&#x000A;<span class="line-num">179</span>   &#x000A;<span class="line-num">180</span>   <span class="ruby-identifier">request_class</span> = <span class="ruby-constant">Class</span>.<span class="ruby-identifier">new</span>(<span class="ruby-keyword">self</span><span class="ruby-operator">::</span><span class="ruby-constant">RodaRequest</span>)&#x000A;<span class="line-num">181</span>   <span class="ruby-identifier">request_class</span>.<span class="ruby-identifier">roda_class</span> = <span class="ruby-identifier">subclass</span>&#x000A;<span class="line-num">182</span>   <span class="ruby-identifier">request_class</span>.<span class="ruby-identifier">match_pattern_cache</span> = <span class="ruby-constant">RodaCache</span>.<span class="ruby-identifier">new</span>&#x000A;<span class="line-num">183</span>   <span class="ruby-identifier">subclass</span>.<span class="ruby-identifier">const_set</span>(<span class="ruby-value">:RodaRequest</span>, <span class="ruby-identifier">request_class</span>)&#x000A;<span class="line-num">184</span> &#x000A;<span class="line-num">185</span>   <span class="ruby-identifier">response_class</span> = <span class="ruby-constant">Class</span>.<span class="ruby-identifier">new</span>(<span class="ruby-keyword">self</span><span class="ruby-operator">::</span><span class="ruby-constant">RodaResponse</span>)&#x000A;<span class="line-num">186</span>   <span class="ruby-identifier">response_class</span>.<span class="ruby-identifier">roda_class</span> = <span class="ruby-identifier">subclass</span>&#x000A;<span class="line-num">187</span>   <span class="ruby-identifier">subclass</span>.<span class="ruby-identifier">const_set</span>(<span class="ruby-value">:RodaResponse</span>, <span class="ruby-identifier">response_class</span>)&#x000A;<span class="line-num">188</span> <span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method public-instance' id='method-method-i-plugin'>
<a name='method-i-plugin'></a>
<div class='synopsis'>
<span class='name'>plugin</span>
<span class='arguments'>(plugin, *args, &block)</span>

</div>
<div class='description'>

<p>Load a new plugin into the current class.  A plugin can be a module which is used directly, or a symbol represented a registered plugin which will be required and then used. Returns nil.</p>

<pre class="ruby"><span class="ruby-constant">Roda</span>.<span class="ruby-identifier">plugin</span> <span class="ruby-constant">PluginModule</span>&#x000A;<span class="ruby-constant">Roda</span>.<span class="ruby-identifier">plugin</span> <span class="ruby-value">:csrf</span></pre>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-plugin-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-plugin-source'>    <span class="ruby-comment"># File lib/roda.rb</span>&#x000A;<span class="line-num">196</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">plugin</span>(<span class="ruby-identifier">plugin</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">args</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)&#x000A;<span class="line-num">197</span>   <span class="ruby-identifier">raise</span> <span class="ruby-constant">RodaError</span>, <span class="ruby-string">&quot;Cannot add a plugin to a frozen Roda class&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">frozen?</span>&#x000A;<span class="line-num">198</span>   <span class="ruby-identifier">plugin</span> = <span class="ruby-constant">RodaPlugins</span>.<span class="ruby-identifier">load_plugin</span>(<span class="ruby-identifier">plugin</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">plugin</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Symbol</span>)&#x000A;<span class="line-num">199</span>   <span class="ruby-identifier">plugin</span>.<span class="ruby-identifier">load_dependencies</span>(<span class="ruby-keyword">self</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">args</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">plugin</span>.<span class="ruby-identifier">respond_to?</span>(<span class="ruby-value">:load_dependencies</span>)&#x000A;<span class="line-num">200</span>   <span class="ruby-identifier">include</span>(<span class="ruby-identifier">plugin</span><span class="ruby-operator">::</span><span class="ruby-constant">InstanceMethods</span>) <span class="ruby-keyword">if</span> <span class="ruby-keyword">defined?</span>(<span class="ruby-identifier">plugin</span><span class="ruby-operator">::</span><span class="ruby-constant">InstanceMethods</span>)&#x000A;<span class="line-num">201</span>   <span class="ruby-identifier">extend</span>(<span class="ruby-identifier">plugin</span><span class="ruby-operator">::</span><span class="ruby-constant">ClassMethods</span>) <span class="ruby-keyword">if</span> <span class="ruby-keyword">defined?</span>(<span class="ruby-identifier">plugin</span><span class="ruby-operator">::</span><span class="ruby-constant">ClassMethods</span>)&#x000A;<span class="line-num">202</span>   <span class="ruby-keyword">self</span><span class="ruby-operator">::</span><span class="ruby-constant">RodaRequest</span>.<span class="ruby-identifier">send</span>(<span class="ruby-value">:include</span>, <span class="ruby-identifier">plugin</span><span class="ruby-operator">::</span><span class="ruby-constant">RequestMethods</span>) <span class="ruby-keyword">if</span> <span class="ruby-keyword">defined?</span>(<span class="ruby-identifier">plugin</span><span class="ruby-operator">::</span><span class="ruby-constant">RequestMethods</span>)&#x000A;<span class="line-num">203</span>   <span class="ruby-keyword">self</span><span class="ruby-operator">::</span><span class="ruby-constant">RodaRequest</span>.<span class="ruby-identifier">extend</span>(<span class="ruby-identifier">plugin</span><span class="ruby-operator">::</span><span class="ruby-constant">RequestClassMethods</span>) <span class="ruby-keyword">if</span> <span class="ruby-keyword">defined?</span>(<span class="ruby-identifier">plugin</span><span class="ruby-operator">::</span><span class="ruby-constant">RequestClassMethods</span>)&#x000A;<span class="line-num">204</span>   <span class="ruby-keyword">self</span><span class="ruby-operator">::</span><span class="ruby-constant">RodaResponse</span>.<span class="ruby-identifier">send</span>(<span class="ruby-value">:include</span>, <span class="ruby-identifier">plugin</span><span class="ruby-operator">::</span><span class="ruby-constant">ResponseMethods</span>) <span class="ruby-keyword">if</span> <span class="ruby-keyword">defined?</span>(<span class="ruby-identifier">plugin</span><span class="ruby-operator">::</span><span class="ruby-constant">ResponseMethods</span>)&#x000A;<span class="line-num">205</span>   <span class="ruby-keyword">self</span><span class="ruby-operator">::</span><span class="ruby-constant">RodaResponse</span>.<span class="ruby-identifier">extend</span>(<span class="ruby-identifier">plugin</span><span class="ruby-operator">::</span><span class="ruby-constant">ResponseClassMethods</span>) <span class="ruby-keyword">if</span> <span class="ruby-keyword">defined?</span>(<span class="ruby-identifier">plugin</span><span class="ruby-operator">::</span><span class="ruby-constant">ResponseClassMethods</span>)&#x000A;<span class="line-num">206</span>   <span class="ruby-identifier">plugin</span>.<span class="ruby-identifier">configure</span>(<span class="ruby-keyword">self</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">args</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">plugin</span>.<span class="ruby-identifier">respond_to?</span>(<span class="ruby-value">:configure</span>)&#x000A;<span class="line-num">207</span>   <span class="ruby-keyword">nil</span>&#x000A;<span class="line-num">208</span> <span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method public-instance' id='method-method-i-route'>
<a name='method-i-route'></a>
<div class='synopsis'>
<span class='name'>route</span>
<span class='arguments'>(&block)</span>

</div>
<div class='description'>

<p>Setup routing tree for the current <a href="../../../Roda.html"><code>Roda</code></a> application, and build the underlying rack application using the stored middleware. Requires a block, which is yielded the request.  By convention, the block argument should be named <code>r</code>.  Example:</p>

<pre class="ruby"><span class="ruby-constant">Roda</span>.<span class="ruby-identifier">route</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">r</span><span class="ruby-operator">|</span>&#x000A;  <span class="ruby-identifier">r</span>.<span class="ruby-identifier">root</span> <span class="ruby-keyword">do</span>&#x000A;    <span class="ruby-string">&quot;Root&quot;</span>&#x000A;  <span class="ruby-keyword">end</span>&#x000A;<span class="ruby-keyword">end</span></pre>

<p>This should only be called once per class, and if called multiple times will overwrite the previous routing.</p>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-route-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-route-source'>    <span class="ruby-comment"># File lib/roda.rb</span>&#x000A;<span class="line-num">223</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">route</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)&#x000A;<span class="line-num">224</span>   <span class="ruby-ivar">@route_block</span> = <span class="ruby-identifier">block</span>&#x000A;<span class="line-num">225</span>   <span class="ruby-identifier">build_rack_app</span>&#x000A;<span class="line-num">226</span> <span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method public-instance' id='method-method-i-use'>
<a name='method-i-use'></a>
<div class='synopsis'>
<span class='name'>use</span>
<span class='arguments'>(*args, &block)</span>

</div>
<div class='description'>

<p>Add a middleware to use for the rack application.  Must be called before calling <a href="ClassMethods.html#method-i-route"><code>route</code></a> to have an effect. Example:</p>

<pre class="ruby"><span class="ruby-constant">Roda</span>.<span class="ruby-identifier">use</span> <span class="ruby-constant">Rack</span><span class="ruby-operator">::</span><span class="ruby-constant">ShowExceptions</span></pre>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-use-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-use-source'>    <span class="ruby-comment"># File lib/roda.rb</span>&#x000A;<span class="line-num">232</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">use</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">args</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)&#x000A;<span class="line-num">233</span>   <span class="ruby-ivar">@middleware</span> <span class="ruby-operator">&lt;&lt;</span> [<span class="ruby-identifier">args</span>, <span class="ruby-identifier">block</span>].<span class="ruby-identifier">freeze</span>&#x000A;<span class="line-num">234</span>   <span class="ruby-identifier">build_rack_app</span>&#x000A;<span class="line-num">235</span> <span class="ruby-keyword">end</span></pre>
</div>
</div>
</div>
</div>

</div>
</div>

<div id='footer-push'></div>
</div>
<div id='footer'>
<a href="https://github.com/rdoc/hanna-nouveau"><strong>Hanna Nouveau</strong> RDoc template</a>
</div>
</body>
</html>
